(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.tdValidator=f()}})((function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n=e[i][1][r];return o(n||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){const jsonld=require("jsonld");const Ajv=require("ajv");function tdValidator(tdString,tdSchema,tdFullSchema,logFunc,{checkDefaults:checkDefaults=true,checkJsonLd:checkJsonLd=true}){return new Promise((res,rej)=>{if(typeof tdString!=="string"){rej("Thing Description input should be a String")}if(typeof tdSchema!=="string"){rej("TD Schema input value was no String")}if(typeof tdFullSchema!=="string"){rej("TD full Schema should be a string")}if(checkDefaults===undefined){checkDefaults=true}if(checkJsonLd===undefined){checkJsonLd=true}if(typeof logFunc!=="function"){rej("Expected logFunc to be a function")}const report={json:null,schema:null,defaults:null,jsonld:null,add:null};const details={enumConst:null,propItems:null,interactions:null,security:null};let tdJson;try{tdJson=JSON.parse(tdString);report.json="passed"}catch(err){report.json="failed";logFunc("X JSON validation failed:");logFunc(err);res({report:report,details:details})}if(tdJson.hasOwnProperty("properties")||tdJson.hasOwnProperty("actions")||tdJson.hasOwnProperty("events")){if(!tdJson.hasOwnProperty("base")){logFunc(":) Tip: Without base, each href should be an absolute URL")}}const schema=JSON.parse(tdSchema);const ajv=new Ajv;ajv.addSchema(schema,"td");const valid=ajv.validate("td",tdJson);if(valid){report.schema="passed";if(checkDefaults){const fullschema=JSON.parse(tdFullSchema);ajv.addSchema(fullschema,"fulltd");const fullValid=ajv.validate("fulltd",tdJson);if(fullValid){report.defaults="passed"}else{report.defaults="warning";logFunc("Optional validation failed:");logFunc("> "+ajv.errorsText())}}checkEnumConst(tdJson);checkPropItems(tdJson);checkInteractions(tdJson);checkSecurity(tdJson);report.add="passed";Object.keys(details).forEach(prop=>{if(details[prop]==="warning"&&report.add==="passed"){report.add="warning"}else if(details[prop]==="failed"&&report.add!=="failed"){report.add="failed"}})}else{report.schema="failed";logFunc("X JSON Schema validation failed:");logFunc("> "+ajv.errorsText())}if(checkJsonLd){jsonld.toRDF(tdJson,{format:"application/nquads"}).then(nquads=>{report.jsonld="passed";res({report:report,details:details})},err=>{report.jsonld="failed";logFunc("X JSON-LD validation failed:");logFunc("Hint: Make sure you have internet connection available.");logFunc("> "+err);res({report:report,details:details})})}else{res({report:report,details:details})}function checkEnumConst(td){details.enumConst="passed";if(td.hasOwnProperty("properties")){tdProperties=Object.keys(td.properties);for(let i=0;i<tdProperties.length;i++){const curPropertyName=tdProperties[i];const curProperty=td.properties[curPropertyName];if(curProperty.hasOwnProperty("enum")&&curProperty.hasOwnProperty("const")){details.enumConst="warning";logFunc("! Warning: In property "+curPropertyName+" enum and const are used at the same time, the values in enum"+" can never be valid in the received JSON value")}}}if(td.hasOwnProperty("actions")){tdActions=Object.keys(td.actions);for(let i=0;i<tdActions.length;i++){const curActionName=tdActions[i];const curAction=td.actions[curActionName];if(curAction.hasOwnProperty("input")){const curInput=curAction.input;if(curInput.hasOwnProperty("enum")&&curInput.hasOwnProperty("const")){details.enumConst="warning";logFunc("! Warning: In the input of action "+curActionName+" enum and const are used at the same time, the values in enum can"+" never be valid in the received JSON value")}}if(curAction.hasOwnProperty("output")){const curOutput=curAction.output;if(curOutput.hasOwnProperty("enum")&&curOutput.hasOwnProperty("const")){details.enumConst="warning";logFunc("! Warning: In the output of action "+curActionName+" enum and const are used at the same time, the values in enum can"+" never be valid in the received JSON value")}}}}if(td.hasOwnProperty("events")){tdEvents=Object.keys(td.events);for(let i=0;i<tdEvents.length;i++){const curEventName=tdEvents[i];const curEvent=td.events[curEventName];if(curEvent.hasOwnProperty("enum")&&curEvent.hasOwnProperty("const")){details.enumConst="warning";logFunc("! Warning: In event "+curEventName+" enum and const are used at the same time, the"+" values in enum can never be valid in the received JSON value")}}}return}function checkPropItems(td){details.propItems="passed";if(td.hasOwnProperty("properties")){tdProperties=Object.keys(td.properties);for(let i=0;i<tdProperties.length;i++){const curPropertyName=tdProperties[i];const curProperty=td.properties[curPropertyName];if(curProperty.hasOwnProperty("type")){if(curProperty.type==="object"&&!curProperty.hasOwnProperty("properties")){details.propItems="warning";logFunc("! Warning: In property "+curPropertyName+", the type is object but its properties are not specified")}if(curProperty.type==="array"&&!curProperty.hasOwnProperty("items")){details.propItems="warning";logFunc("! Warning: In property "+curPropertyName+", the type is array but its items are not specified")}}}}if(td.hasOwnProperty("actions")){tdActions=Object.keys(td.actions);for(let i=0;i<tdActions.length;i++){const curActionName=tdActions[i];const curAction=td.actions[curActionName];if(curAction.hasOwnProperty("input")){const curInput=curAction.input;if(curInput.hasOwnProperty("type")){if(curInput.type==="object"&&!curInput.hasOwnProperty("properties")){details.propItems="warning";logFunc("! Warning: In the input of action "+curActionName+", the type is object but its properties are not specified")}if(curInput.type==="array"&&!curInput.hasOwnProperty("items")){details.propItems="warning";logFunc("! Warning: In the output of action "+curActionName+", the type is array but its items are not specified")}}}if(curAction.hasOwnProperty("output")){const curOutput=curAction.output;if(curOutput.hasOwnProperty("type")){if(curOutput.type==="object"&&!curOutput.hasOwnProperty("properties")){details.propItems="warning";logFunc("! Warning: In the output of action "+curActionName+", the type is object but its properties are not specified")}if(curOutput.type==="array"&&!curOutput.hasOwnProperty("items")){details.propItems="warning";logFunc("! Warning: In the output of action "+curActionName+", the type is array but its items are not specified")}}}}}if(td.hasOwnProperty("events")){tdEvents=Object.keys(td.events);for(let i=0;i<tdEvents.length;i++){const curEventName=tdEvents[i];const curEvent=td.events[curEventName];if(curEvent.hasOwnProperty("type")){if(curEvent.type==="object"&&!curEvent.hasOwnProperty("properties")){details.propItems="warning";logFunc("! Warning: In event "+curEventName+", the type is object but its properties are not specified")}if(curEvent.type==="array"&&!curEvent.hasOwnProperty("items")){details.propItems="warning";logFunc("! Warning: In event "+curEventName+", the type is array but its items are not specified")}}}}return}function checkInteractions(td){details.interactions="passed";if(td.hasOwnProperty("interactions")){details.interactions="warning";logFunc("! Warning: interactions are from the previous TD Specification, "+"please use properties, actions, events instead")}if(td.hasOwnProperty("interaction")){details.interactions="warning";logFunc("! Warning: interaction are from the previous TD Specification, "+"please use properties, actions, events instead")}return}function securityContains(parent,child){if(typeof child=="string"){child=[child]}return child.every(elem=>parent.indexOf(elem)>-1)}function checkSecurity(td){details.security="passed";if(td.hasOwnProperty("securityDefinitions")){const securityDefinitionsObject=td.securityDefinitions;const securityDefinitions=Object.keys(securityDefinitionsObject);const rootSecurity=td.security;if(securityContains(securityDefinitions,rootSecurity)){}else{details.security="failed";logFunc("KO Error: Security key in the root of the TD"+"has security schemes not defined by the securityDefinitions")}if(td.hasOwnProperty("properties")){tdProperties=Object.keys(td.properties);for(let i=0;i<tdProperties.length;i++){const curPropertyName=tdProperties[i];const curProperty=td.properties[curPropertyName];const curForms=curProperty.forms;for(let j=0;j<curForms.length;j++){const curForm=curForms[j];if(curForm.hasOwnProperty("security")){const curSecurity=curForm.security;if(securityContains(securityDefinitions,curSecurity)){}else{details.security="failed";logFunc("KO Error: Security key in form "+j+" in property "+curPropertyName+"  has security schemes not defined by the securityDefinitions")}}}}}if(td.hasOwnProperty("actions")){tdActions=Object.keys(td.actions);for(let i=0;i<tdActions.length;i++){const curActionName=tdActions[i];const curAction=td.actions[curActionName];const curForms=curAction.forms;for(let j=0;j<curForms.length;j++){const curForm=curForms[j];if(curForm.hasOwnProperty("security")){const curSecurity=curForm.security;if(securityContains(securityDefinitions,curSecurity)){}else{details.security="failed";logFunc("KO Error: Security key in form "+j+" in action "+curActionName+"  has security schemes not defined by the securityDefinitions")}}}}}if(td.hasOwnProperty("events")){tdEvents=Object.keys(td.events);for(let i=0;i<tdEvents.length;i++){const curEventName=tdEvents[i];const curEvent=td.events[curEventName];const curForms=curEvent.forms;for(let j=0;j<curForms.length;j++){const curForm=curForms[j];if(curForm.hasOwnProperty("security")){const curSecurity=curForm.security;if(securityContains(securityDefinitions,curSecurity)){}else{details.security="failed";logFunc("KO Error: Security key in form "+j+" in event "+curEventName+"  has security schemes not defined by the securityDefinitions")}}}}}}else{details.security="failed";logFunc("KO Error: securityDefinitions is mandatory")}return}})}module.exports=tdValidator},{ajv:2,jsonld:66}],2:[function(require,module,exports){"use strict";var compileSchema=require("./compile"),resolve=require("./compile/resolve"),Cache=require("./cache"),SchemaObject=require("./compile/schema_obj"),stableStringify=require("fast-json-stable-stringify"),formats=require("./compile/formats"),rules=require("./compile/rules"),$dataMetaSchema=require("./data"),util=require("./compile/util");module.exports=Ajv;Ajv.prototype.validate=validate;Ajv.prototype.compile=compile;Ajv.prototype.addSchema=addSchema;Ajv.prototype.addMetaSchema=addMetaSchema;Ajv.prototype.validateSchema=validateSchema;Ajv.prototype.getSchema=getSchema;Ajv.prototype.removeSchema=removeSchema;Ajv.prototype.addFormat=addFormat;Ajv.prototype.errorsText=errorsText;Ajv.prototype._addSchema=_addSchema;Ajv.prototype._compile=_compile;Ajv.prototype.compileAsync=require("./compile/async");var customKeyword=require("./keyword");Ajv.prototype.addKeyword=customKeyword.add;Ajv.prototype.getKeyword=customKeyword.get;Ajv.prototype.removeKeyword=customKeyword.remove;Ajv.prototype.validateKeyword=customKeyword.validate;var errorClasses=require("./compile/error_classes");Ajv.ValidationError=errorClasses.Validation;Ajv.MissingRefError=errorClasses.MissingRef;Ajv.$dataMetaSchema=$dataMetaSchema;var META_SCHEMA_ID="http://json-schema.org/draft-07/schema";var META_IGNORE_OPTIONS=["removeAdditional","useDefaults","coerceTypes","strictDefaults"];var META_SUPPORT_DATA=["/properties"];function Ajv(opts){if(!(this instanceof Ajv))return new Ajv(opts);opts=this._opts=util.copy(opts)||{};setLogger(this);this._schemas={};this._refs={};this._fragments={};this._formats=formats(opts.format);this._cache=opts.cache||new Cache;this._loadingSchemas={};this._compilations=[];this.RULES=rules();this._getId=chooseGetId(opts);opts.loopRequired=opts.loopRequired||Infinity;if(opts.errorDataPath=="property")opts._errorDataPathProperty=true;if(opts.serialize===undefined)opts.serialize=stableStringify;this._metaOpts=getMetaSchemaOptions(this);if(opts.formats)addInitialFormats(this);if(opts.keywords)addInitialKeywords(this);addDefaultMetaSchema(this);if(typeof opts.meta=="object")this.addMetaSchema(opts.meta);if(opts.nullable)this.addKeyword("nullable",{metaSchema:{type:"boolean"}});addInitialSchemas(this)}function validate(schemaKeyRef,data){var v;if(typeof schemaKeyRef=="string"){v=this.getSchema(schemaKeyRef);if(!v)throw new Error('no schema with key or ref "'+schemaKeyRef+'"')}else{var schemaObj=this._addSchema(schemaKeyRef);v=schemaObj.validate||this._compile(schemaObj)}var valid=v(data);if(v.$async!==true)this.errors=v.errors;return valid}function compile(schema,_meta){var schemaObj=this._addSchema(schema,undefined,_meta);return schemaObj.validate||this._compile(schemaObj)}function addSchema(schema,key,_skipValidation,_meta){if(Array.isArray(schema)){for(var i=0;i<schema.length;i++)this.addSchema(schema[i],undefined,_skipValidation,_meta);return this}var id=this._getId(schema);if(id!==undefined&&typeof id!="string")throw new Error("schema id must be string");key=resolve.normalizeId(key||id);checkUnique(this,key);this._schemas[key]=this._addSchema(schema,_skipValidation,_meta,true);return this}function addMetaSchema(schema,key,skipValidation){this.addSchema(schema,key,skipValidation,true);return this}function validateSchema(schema,throwOrLogError){var $schema=schema.$schema;if($schema!==undefined&&typeof $schema!="string")throw new Error("$schema must be a string");$schema=$schema||this._opts.defaultMeta||defaultMeta(this);if(!$schema){this.logger.warn("meta-schema not available");this.errors=null;return true}var valid=this.validate($schema,schema);if(!valid&&throwOrLogError){var message="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(message);else throw new Error(message)}return valid}function defaultMeta(self){var meta=self._opts.meta;self._opts.defaultMeta=typeof meta=="object"?self._getId(meta)||meta:self.getSchema(META_SCHEMA_ID)?META_SCHEMA_ID:undefined;return self._opts.defaultMeta}function getSchema(keyRef){var schemaObj=_getSchemaObj(this,keyRef);switch(typeof schemaObj){case"object":return schemaObj.validate||this._compile(schemaObj);case"string":return this.getSchema(schemaObj);case"undefined":return _getSchemaFragment(this,keyRef)}}function _getSchemaFragment(self,ref){var res=resolve.schema.call(self,{schema:{}},ref);if(res){var schema=res.schema,root=res.root,baseId=res.baseId;var v=compileSchema.call(self,schema,root,undefined,baseId);self._fragments[ref]=new SchemaObject({ref:ref,fragment:true,schema:schema,root:root,baseId:baseId,validate:v});return v}}function _getSchemaObj(self,keyRef){keyRef=resolve.normalizeId(keyRef);return self._schemas[keyRef]||self._refs[keyRef]||self._fragments[keyRef]}function removeSchema(schemaKeyRef){if(schemaKeyRef instanceof RegExp){_removeAllSchemas(this,this._schemas,schemaKeyRef);_removeAllSchemas(this,this._refs,schemaKeyRef);return this}switch(typeof schemaKeyRef){case"undefined":_removeAllSchemas(this,this._schemas);_removeAllSchemas(this,this._refs);this._cache.clear();return this;case"string":var schemaObj=_getSchemaObj(this,schemaKeyRef);if(schemaObj)this._cache.del(schemaObj.cacheKey);delete this._schemas[schemaKeyRef];delete this._refs[schemaKeyRef];return this;case"object":var serialize=this._opts.serialize;var cacheKey=serialize?serialize(schemaKeyRef):schemaKeyRef;this._cache.del(cacheKey);var id=this._getId(schemaKeyRef);if(id){id=resolve.normalizeId(id);delete this._schemas[id];delete this._refs[id]}}return this}function _removeAllSchemas(self,schemas,regex){for(var keyRef in schemas){var schemaObj=schemas[keyRef];if(!schemaObj.meta&&(!regex||regex.test(keyRef))){self._cache.del(schemaObj.cacheKey);delete schemas[keyRef]}}}function _addSchema(schema,skipValidation,meta,shouldAddSchema){if(typeof schema!="object"&&typeof schema!="boolean")throw new Error("schema should be object or boolean");var serialize=this._opts.serialize;var cacheKey=serialize?serialize(schema):schema;var cached=this._cache.get(cacheKey);if(cached)return cached;shouldAddSchema=shouldAddSchema||this._opts.addUsedSchema!==false;var id=resolve.normalizeId(this._getId(schema));if(id&&shouldAddSchema)checkUnique(this,id);var willValidate=this._opts.validateSchema!==false&&!skipValidation;var recursiveMeta;if(willValidate&&!(recursiveMeta=id&&id==resolve.normalizeId(schema.$schema)))this.validateSchema(schema,true);var localRefs=resolve.ids.call(this,schema);var schemaObj=new SchemaObject({id:id,schema:schema,localRefs:localRefs,cacheKey:cacheKey,meta:meta});if(id[0]!="#"&&shouldAddSchema)this._refs[id]=schemaObj;this._cache.put(cacheKey,schemaObj);if(willValidate&&recursiveMeta)this.validateSchema(schema,true);return schemaObj}function _compile(schemaObj,root){if(schemaObj.compiling){schemaObj.validate=callValidate;callValidate.schema=schemaObj.schema;callValidate.errors=null;callValidate.root=root?root:callValidate;if(schemaObj.schema.$async===true)callValidate.$async=true;return callValidate}schemaObj.compiling=true;var currentOpts;if(schemaObj.meta){currentOpts=this._opts;this._opts=this._metaOpts}var v;try{v=compileSchema.call(this,schemaObj.schema,root,schemaObj.localRefs)}catch(e){delete schemaObj.validate;throw e}finally{schemaObj.compiling=false;if(schemaObj.meta)this._opts=currentOpts}schemaObj.validate=v;schemaObj.refs=v.refs;schemaObj.refVal=v.refVal;schemaObj.root=v.root;return v;function callValidate(){var _validate=schemaObj.validate;var result=_validate.apply(this,arguments);callValidate.errors=_validate.errors;return result}}function chooseGetId(opts){switch(opts.schemaId){case"auto":return _get$IdOrId;case"id":return _getId;default:return _get$Id}}function _getId(schema){if(schema.$id)this.logger.warn("schema $id ignored",schema.$id);return schema.id}function _get$Id(schema){if(schema.id)this.logger.warn("schema id ignored",schema.id);return schema.$id}function _get$IdOrId(schema){if(schema.$id&&schema.id&&schema.$id!=schema.id)throw new Error("schema $id is different from id");return schema.$id||schema.id}function errorsText(errors,options){errors=errors||this.errors;if(!errors)return"No errors";options=options||{};var separator=options.separator===undefined?", ":options.separator;var dataVar=options.dataVar===undefined?"data":options.dataVar;var text="";for(var i=0;i<errors.length;i++){var e=errors[i];if(e)text+=dataVar+e.dataPath+" "+e.message+separator}return text.slice(0,-separator.length)}function addFormat(name,format){if(typeof format=="string")format=new RegExp(format);this._formats[name]=format;return this}function addDefaultMetaSchema(self){var $dataSchema;if(self._opts.$data){$dataSchema=require("./refs/data.json");self.addMetaSchema($dataSchema,$dataSchema.$id,true)}if(self._opts.meta===false)return;var metaSchema=require("./refs/json-schema-draft-07.json");if(self._opts.$data)metaSchema=$dataMetaSchema(metaSchema,META_SUPPORT_DATA);self.addMetaSchema(metaSchema,META_SCHEMA_ID,true);self._refs["http://json-schema.org/schema"]=META_SCHEMA_ID}function addInitialSchemas(self){var optsSchemas=self._opts.schemas;if(!optsSchemas)return;if(Array.isArray(optsSchemas))self.addSchema(optsSchemas);else for(var key in optsSchemas)self.addSchema(optsSchemas[key],key)}function addInitialFormats(self){for(var name in self._opts.formats){var format=self._opts.formats[name];self.addFormat(name,format)}}function addInitialKeywords(self){for(var name in self._opts.keywords){var keyword=self._opts.keywords[name];self.addKeyword(name,keyword)}}function checkUnique(self,id){if(self._schemas[id]||self._refs[id])throw new Error('schema with key or id "'+id+'" already exists')}function getMetaSchemaOptions(self){var metaOpts=util.copy(self._opts);for(var i=0;i<META_IGNORE_OPTIONS.length;i++)delete metaOpts[META_IGNORE_OPTIONS[i]];return metaOpts}function setLogger(self){var logger=self._opts.logger;if(logger===false){self.logger={log:noop,warn:noop,error:noop}}else{if(logger===undefined)logger=console;if(!(typeof logger=="object"&&logger.log&&logger.warn&&logger.error))throw new Error("logger must implement log, warn and error methods");self.logger=logger}}function noop(){}},{"./cache":3,"./compile":7,"./compile/async":4,"./compile/error_classes":5,"./compile/formats":6,"./compile/resolve":8,"./compile/rules":9,"./compile/schema_obj":10,"./compile/util":12,"./data":13,"./keyword":41,"./refs/data.json":42,"./refs/json-schema-draft-07.json":43,"fast-json-stable-stringify":47}],3:[function(require,module,exports){"use strict";var Cache=module.exports=function Cache(){this._cache={}};Cache.prototype.put=function Cache_put(key,value){this._cache[key]=value};Cache.prototype.get=function Cache_get(key){return this._cache[key]};Cache.prototype.del=function Cache_del(key){delete this._cache[key]};Cache.prototype.clear=function Cache_clear(){this._cache={}}},{}],4:[function(require,module,exports){"use strict";var MissingRefError=require("./error_classes").MissingRef;module.exports=compileAsync;function compileAsync(schema,meta,callback){var self=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");if(typeof meta=="function"){callback=meta;meta=undefined}var p=loadMetaSchemaOf(schema).then((function(){var schemaObj=self._addSchema(schema,undefined,meta);return schemaObj.validate||_compileAsync(schemaObj)}));if(callback){p.then((function(v){callback(null,v)}),callback)}return p;function loadMetaSchemaOf(sch){var $schema=sch.$schema;return $schema&&!self.getSchema($schema)?compileAsync.call(self,{$ref:$schema},true):Promise.resolve()}function _compileAsync(schemaObj){try{return self._compile(schemaObj)}catch(e){if(e instanceof MissingRefError)return loadMissingSchema(e);throw e}function loadMissingSchema(e){var ref=e.missingSchema;if(added(ref))throw new Error("Schema "+ref+" is loaded but "+e.missingRef+" cannot be resolved");var schemaPromise=self._loadingSchemas[ref];if(!schemaPromise){schemaPromise=self._loadingSchemas[ref]=self._opts.loadSchema(ref);schemaPromise.then(removePromise,removePromise)}return schemaPromise.then((function(sch){if(!added(ref)){return loadMetaSchemaOf(sch).then((function(){if(!added(ref))self.addSchema(sch,ref,undefined,meta)}))}})).then((function(){return _compileAsync(schemaObj)}));function removePromise(){delete self._loadingSchemas[ref]}function added(ref){return self._refs[ref]||self._schemas[ref]}}}}},{"./error_classes":5}],5:[function(require,module,exports){"use strict";var resolve=require("./resolve");module.exports={Validation:errorSubclass(ValidationError),MissingRef:errorSubclass(MissingRefError)};function ValidationError(errors){this.message="validation failed";this.errors=errors;this.ajv=this.validation=true}MissingRefError.message=function(baseId,ref){return"can't resolve reference "+ref+" from id "+baseId};function MissingRefError(baseId,ref,message){this.message=message||MissingRefError.message(baseId,ref);this.missingRef=resolve.url(baseId,ref);this.missingSchema=resolve.normalizeId(resolve.fullPath(this.missingRef))}function errorSubclass(Subclass){Subclass.prototype=Object.create(Error.prototype);Subclass.prototype.constructor=Subclass;return Subclass}},{"./resolve":8}],6:[function(require,module,exports){"use strict";var util=require("./util");var DATE=/^(\d\d\d\d)-(\d\d)-(\d\d)$/;var DAYS=[0,31,28,31,30,31,30,31,31,30,31,30,31];var TIME=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;var HOSTNAME=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i;var URI=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;var URIREF=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;var URITEMPLATE=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i;var URL=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i;var UUID=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i;var JSON_POINTER=/^(?:\/(?:[^~/]|~0|~1)*)*$/;var JSON_POINTER_URI_FRAGMENT=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i;var RELATIVE_JSON_POINTER=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;module.exports=formats;function formats(mode){mode=mode=="full"?"full":"fast";return util.copy(formats[mode])}formats.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":URITEMPLATE,url:URL,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:HOSTNAME,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:regex,uuid:UUID,"json-pointer":JSON_POINTER,"json-pointer-uri-fragment":JSON_POINTER_URI_FRAGMENT,"relative-json-pointer":RELATIVE_JSON_POINTER};formats.full={date:date,time:time,"date-time":date_time,uri:uri,"uri-reference":URIREF,"uri-template":URITEMPLATE,url:URL,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:HOSTNAME,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:regex,uuid:UUID,"json-pointer":JSON_POINTER,"json-pointer-uri-fragment":JSON_POINTER_URI_FRAGMENT,"relative-json-pointer":RELATIVE_JSON_POINTER};function isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0)}function date(str){var matches=str.match(DATE);if(!matches)return false;var year=+matches[1];var month=+matches[2];var day=+matches[3];return month>=1&&month<=12&&day>=1&&day<=(month==2&&isLeapYear(year)?29:DAYS[month])}function time(str,full){var matches=str.match(TIME);if(!matches)return false;var hour=matches[1];var minute=matches[2];var second=matches[3];var timeZone=matches[5];return(hour<=23&&minute<=59&&second<=59||hour==23&&minute==59&&second==60)&&(!full||timeZone)}var DATE_TIME_SEPARATOR=/t|\s/i;function date_time(str){var dateTime=str.split(DATE_TIME_SEPARATOR);return dateTime.length==2&&date(dateTime[0])&&time(dateTime[1],true)}var NOT_URI_FRAGMENT=/\/|:/;function uri(str){return NOT_URI_FRAGMENT.test(str)&&URI.test(str)}var Z_ANCHOR=/[^\\]\\Z/;function regex(str){if(Z_ANCHOR.test(str))return false;try{new RegExp(str);return true}catch(e){return false}}},{"./util":12}],7:[function(require,module,exports){"use strict";var resolve=require("./resolve"),util=require("./util"),errorClasses=require("./error_classes"),stableStringify=require("fast-json-stable-stringify");var validateGenerator=require("../dotjs/validate");var ucs2length=util.ucs2length;var equal=require("fast-deep-equal");var ValidationError=errorClasses.Validation;module.exports=compile;function compile(schema,root,localRefs,baseId){var self=this,opts=this._opts,refVal=[undefined],refs={},patterns=[],patternsHash={},defaults=[],defaultsHash={},customRules=[];root=root||{schema:schema,refVal:refVal,refs:refs};var c=checkCompiling.call(this,schema,root,baseId);var compilation=this._compilations[c.index];if(c.compiling)return compilation.callValidate=callValidate;var formats=this._formats;var RULES=this.RULES;try{var v=localCompile(schema,root,localRefs,baseId);compilation.validate=v;var cv=compilation.callValidate;if(cv){cv.schema=v.schema;cv.errors=null;cv.refs=v.refs;cv.refVal=v.refVal;cv.root=v.root;cv.$async=v.$async;if(opts.sourceCode)cv.source=v.source}return v}finally{endCompiling.call(this,schema,root,baseId)}function callValidate(){var validate=compilation.validate;var result=validate.apply(this,arguments);callValidate.errors=validate.errors;return result}function localCompile(_schema,_root,localRefs,baseId){var isRoot=!_root||_root&&_root.schema==_schema;if(_root.schema!=root.schema)return compile.call(self,_schema,_root,localRefs,baseId);var $async=_schema.$async===true;var sourceCode=validateGenerator({isTop:true,schema:_schema,isRoot:isRoot,baseId:baseId,root:_root,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:errorClasses.MissingRef,RULES:RULES,validate:validateGenerator,util:util,resolve:resolve,resolveRef:resolveRef,usePattern:usePattern,useDefault:useDefault,useCustomRule:useCustomRule,opts:opts,formats:formats,logger:self.logger,self:self});sourceCode=vars(refVal,refValCode)+vars(patterns,patternCode)+vars(defaults,defaultCode)+vars(customRules,customRuleCode)+sourceCode;if(opts.processCode)sourceCode=opts.processCode(sourceCode);var validate;try{var makeValidate=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",sourceCode);validate=makeValidate(self,RULES,formats,root,refVal,defaults,customRules,equal,ucs2length,ValidationError);refVal[0]=validate}catch(e){self.logger.error("Error compiling schema, function code:",sourceCode);throw e}validate.schema=_schema;validate.errors=null;validate.refs=refs;validate.refVal=refVal;validate.root=isRoot?validate:_root;if($async)validate.$async=true;if(opts.sourceCode===true){validate.source={code:sourceCode,patterns:patterns,defaults:defaults}}return validate}function resolveRef(baseId,ref,isRoot){ref=resolve.url(baseId,ref);var refIndex=refs[ref];var _refVal,refCode;if(refIndex!==undefined){_refVal=refVal[refIndex];refCode="refVal["+refIndex+"]";return resolvedRef(_refVal,refCode)}if(!isRoot&&root.refs){var rootRefId=root.refs[ref];if(rootRefId!==undefined){_refVal=root.refVal[rootRefId];refCode=addLocalRef(ref,_refVal);return resolvedRef(_refVal,refCode)}}refCode=addLocalRef(ref);var v=resolve.call(self,localCompile,root,ref);if(v===undefined){var localSchema=localRefs&&localRefs[ref];if(localSchema){v=resolve.inlineRef(localSchema,opts.inlineRefs)?localSchema:compile.call(self,localSchema,root,localRefs,baseId)}}if(v===undefined){removeLocalRef(ref)}else{replaceLocalRef(ref,v);return resolvedRef(v,refCode)}}function addLocalRef(ref,v){var refId=refVal.length;refVal[refId]=v;refs[ref]=refId;return"refVal"+refId}function removeLocalRef(ref){delete refs[ref]}function replaceLocalRef(ref,v){var refId=refs[ref];refVal[refId]=v}function resolvedRef(refVal,code){return typeof refVal=="object"||typeof refVal=="boolean"?{code:code,schema:refVal,inline:true}:{code:code,$async:refVal&&!!refVal.$async}}function usePattern(regexStr){var index=patternsHash[regexStr];if(index===undefined){index=patternsHash[regexStr]=patterns.length;patterns[index]=regexStr}return"pattern"+index}function useDefault(value){switch(typeof value){case"boolean":case"number":return""+value;case"string":return util.toQuotedString(value);case"object":if(value===null)return"null";var valueStr=stableStringify(value);var index=defaultsHash[valueStr];if(index===undefined){index=defaultsHash[valueStr]=defaults.length;defaults[index]=value}return"default"+index}}function useCustomRule(rule,schema,parentSchema,it){if(self._opts.validateSchema!==false){var deps=rule.definition.dependencies;if(deps&&!deps.every((function(keyword){return Object.prototype.hasOwnProperty.call(parentSchema,keyword)})))throw new Error("parent schema must have all required keywords: "+deps.join(","));var validateSchema=rule.definition.validateSchema;if(validateSchema){var valid=validateSchema(schema);if(!valid){var message="keyword schema is invalid: "+self.errorsText(validateSchema.errors);if(self._opts.validateSchema=="log")self.logger.error(message);else throw new Error(message)}}}var compile=rule.definition.compile,inline=rule.definition.inline,macro=rule.definition.macro;var validate;if(compile){validate=compile.call(self,schema,parentSchema,it)}else if(macro){validate=macro.call(self,schema,parentSchema,it);if(opts.validateSchema!==false)self.validateSchema(validate,true)}else if(inline){validate=inline.call(self,it,rule.keyword,schema,parentSchema)}else{validate=rule.definition.validate;if(!validate)return}if(validate===undefined)throw new Error('custom keyword "'+rule.keyword+'"failed to compile');var index=customRules.length;customRules[index]=validate;return{code:"customRule"+index,validate:validate}}}function checkCompiling(schema,root,baseId){var index=compIndex.call(this,schema,root,baseId);if(index>=0)return{index:index,compiling:true};index=this._compilations.length;this._compilations[index]={schema:schema,root:root,baseId:baseId};return{index:index,compiling:false}}function endCompiling(schema,root,baseId){var i=compIndex.call(this,schema,root,baseId);if(i>=0)this._compilations.splice(i,1)}function compIndex(schema,root,baseId){for(var i=0;i<this._compilations.length;i++){var c=this._compilations[i];if(c.schema==schema&&c.root==root&&c.baseId==baseId)return i}return-1}function patternCode(i,patterns){return"var pattern"+i+" = new RegExp("+util.toQuotedString(patterns[i])+");"}function defaultCode(i){return"var default"+i+" = defaults["+i+"];"}function refValCode(i,refVal){return refVal[i]===undefined?"":"var refVal"+i+" = refVal["+i+"];"}function customRuleCode(i){return"var customRule"+i+" = customRules["+i+"];"}function vars(arr,statement){if(!arr.length)return"";var code="";for(var i=0;i<arr.length;i++)code+=statement(i,arr);return code}},{"../dotjs/validate":40,"./error_classes":5,"./resolve":8,"./util":12,"fast-deep-equal":46,"fast-json-stable-stringify":47}],8:[function(require,module,exports){"use strict";var URI=require("uri-js"),equal=require("fast-deep-equal"),util=require("./util"),SchemaObject=require("./schema_obj"),traverse=require("json-schema-traverse");module.exports=resolve;resolve.normalizeId=normalizeId;resolve.fullPath=getFullPath;resolve.url=resolveUrl;resolve.ids=resolveIds;resolve.inlineRef=inlineRef;resolve.schema=resolveSchema;function resolve(compile,root,ref){var refVal=this._refs[ref];if(typeof refVal=="string"){if(this._refs[refVal])refVal=this._refs[refVal];else return resolve.call(this,compile,root,refVal)}refVal=refVal||this._schemas[ref];if(refVal instanceof SchemaObject){return inlineRef(refVal.schema,this._opts.inlineRefs)?refVal.schema:refVal.validate||this._compile(refVal)}var res=resolveSchema.call(this,root,ref);var schema,v,baseId;if(res){schema=res.schema;root=res.root;baseId=res.baseId}if(schema instanceof SchemaObject){v=schema.validate||compile.call(this,schema.schema,root,undefined,baseId)}else if(schema!==undefined){v=inlineRef(schema,this._opts.inlineRefs)?schema:compile.call(this,schema,root,undefined,baseId)}return v}function resolveSchema(root,ref){var p=URI.parse(ref),refPath=_getFullPath(p),baseId=getFullPath(this._getId(root.schema));if(Object.keys(root.schema).length===0||refPath!==baseId){var id=normalizeId(refPath);var refVal=this._refs[id];if(typeof refVal=="string"){return resolveRecursive.call(this,root,refVal,p)}else if(refVal instanceof SchemaObject){if(!refVal.validate)this._compile(refVal);root=refVal}else{refVal=this._schemas[id];if(refVal instanceof SchemaObject){if(!refVal.validate)this._compile(refVal);if(id==normalizeId(ref))return{schema:refVal,root:root,baseId:baseId};root=refVal}else{return}}if(!root.schema)return;baseId=getFullPath(this._getId(root.schema))}return getJsonPointer.call(this,p,baseId,root.schema,root)}function resolveRecursive(root,ref,parsedRef){var res=resolveSchema.call(this,root,ref);if(res){var schema=res.schema;var baseId=res.baseId;root=res.root;var id=this._getId(schema);if(id)baseId=resolveUrl(baseId,id);return getJsonPointer.call(this,parsedRef,baseId,schema,root)}}var PREVENT_SCOPE_CHANGE=util.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(parsedRef,baseId,schema,root){parsedRef.fragment=parsedRef.fragment||"";if(parsedRef.fragment.slice(0,1)!="/")return;var parts=parsedRef.fragment.split("/");for(var i=1;i<parts.length;i++){var part=parts[i];if(part){part=util.unescapeFragment(part);schema=schema[part];if(schema===undefined)break;var id;if(!PREVENT_SCOPE_CHANGE[part]){id=this._getId(schema);if(id)baseId=resolveUrl(baseId,id);if(schema.$ref){var $ref=resolveUrl(baseId,schema.$ref);var res=resolveSchema.call(this,root,$ref);if(res){schema=res.schema;root=res.root;baseId=res.baseId}}}}}if(schema!==undefined&&schema!==root.schema)return{schema:schema,root:root,baseId:baseId}}var SIMPLE_INLINED=util.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function inlineRef(schema,limit){if(limit===false)return false;if(limit===undefined||limit===true)return checkNoRef(schema);else if(limit)return countKeys(schema)<=limit}function checkNoRef(schema){var item;if(Array.isArray(schema)){for(var i=0;i<schema.length;i++){item=schema[i];if(typeof item=="object"&&!checkNoRef(item))return false}}else{for(var key in schema){if(key=="$ref")return false;item=schema[key];if(typeof item=="object"&&!checkNoRef(item))return false}}return true}function countKeys(schema){var count=0,item;if(Array.isArray(schema)){for(var i=0;i<schema.length;i++){item=schema[i];if(typeof item=="object")count+=countKeys(item);if(count==Infinity)return Infinity}}else{for(var key in schema){if(key=="$ref")return Infinity;if(SIMPLE_INLINED[key]){count++}else{item=schema[key];if(typeof item=="object")count+=countKeys(item)+1;if(count==Infinity)return Infinity}}}return count}function getFullPath(id,normalize){if(normalize!==false)id=normalizeId(id);var p=URI.parse(id);return _getFullPath(p)}function _getFullPath(p){return URI.serialize(p).split("#")[0]+"#"}var TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(id){return id?id.replace(TRAILING_SLASH_HASH,""):""}function resolveUrl(baseId,id){id=normalizeId(id);return URI.resolve(baseId,id)}function resolveIds(schema){var schemaId=normalizeId(this._getId(schema));var baseIds={"":schemaId};var fullPaths={"":getFullPath(schemaId,false)};var localRefs={};var self=this;traverse(schema,{allKeys:true},(function(sch,jsonPtr,rootSchema,parentJsonPtr,parentKeyword,parentSchema,keyIndex){if(jsonPtr==="")return;var id=self._getId(sch);var baseId=baseIds[parentJsonPtr];var fullPath=fullPaths[parentJsonPtr]+"/"+parentKeyword;if(keyIndex!==undefined)fullPath+="/"+(typeof keyIndex=="number"?keyIndex:util.escapeFragment(keyIndex));if(typeof id=="string"){id=baseId=normalizeId(baseId?URI.resolve(baseId,id):id);var refVal=self._refs[id];if(typeof refVal=="string")refVal=self._refs[refVal];if(refVal&&refVal.schema){if(!equal(sch,refVal.schema))throw new Error('id "'+id+'" resolves to more than one schema')}else if(id!=normalizeId(fullPath)){if(id[0]=="#"){if(localRefs[id]&&!equal(sch,localRefs[id]))throw new Error('id "'+id+'" resolves to more than one schema');localRefs[id]=sch}else{self._refs[id]=fullPath}}}baseIds[jsonPtr]=baseId;fullPaths[jsonPtr]=fullPath}));return localRefs}},{"./schema_obj":10,"./util":12,"fast-deep-equal":46,"json-schema-traverse":48,"uri-js":92}],9:[function(require,module,exports){"use strict";var ruleModules=require("../dotjs"),toHash=require("./util").toHash;module.exports=function rules(){var RULES=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}];var ALL=["type","$comment"];var KEYWORDS=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"];var TYPES=["number","integer","string","array","object","boolean","null"];RULES.all=toHash(ALL);RULES.types=toHash(TYPES);RULES.forEach((function(group){group.rules=group.rules.map((function(keyword){var implKeywords;if(typeof keyword=="object"){var key=Object.keys(keyword)[0];implKeywords=keyword[key];keyword=key;implKeywords.forEach((function(k){ALL.push(k);RULES.all[k]=true}))}ALL.push(keyword);var rule=RULES.all[keyword]={keyword:keyword,code:ruleModules[keyword],implements:implKeywords};return rule}));RULES.all.$comment={keyword:"$comment",code:ruleModules.$comment};if(group.type)RULES.types[group.type]=group}));RULES.keywords=toHash(ALL.concat(KEYWORDS));RULES.custom={};return RULES}},{"../dotjs":29,"./util":12}],10:[function(require,module,exports){"use strict";var util=require("./util");module.exports=SchemaObject;function SchemaObject(obj){util.copy(obj,this)}},{"./util":12}],11:[function(require,module,exports){"use strict";module.exports=function ucs2length(str){var length=0,len=str.length,pos=0,value;while(pos<len){length++;value=str.charCodeAt(pos++);if(value>=55296&&value<=56319&&pos<len){value=str.charCodeAt(pos);if((value&64512)==56320)pos++}}return length}},{}],12:[function(require,module,exports){"use strict";module.exports={copy:copy,checkDataType:checkDataType,checkDataTypes:checkDataTypes,coerceToTypes:coerceToTypes,toHash:toHash,getProperty:getProperty,escapeQuotes:escapeQuotes,equal:require("fast-deep-equal"),ucs2length:require("./ucs2length"),varOccurences:varOccurences,varReplace:varReplace,cleanUpCode:cleanUpCode,finalCleanUpCode:finalCleanUpCode,schemaHasRules:schemaHasRules,schemaHasRulesExcept:schemaHasRulesExcept,schemaUnknownRules:schemaUnknownRules,toQuotedString:toQuotedString,getPathExpr:getPathExpr,getPath:getPath,getData:getData,unescapeFragment:unescapeFragment,unescapeJsonPointer:unescapeJsonPointer,escapeFragment:escapeFragment,escapeJsonPointer:escapeJsonPointer};function copy(o,to){to=to||{};for(var key in o)to[key]=o[key];return to}function checkDataType(dataType,data,negate){var EQUAL=negate?" !== ":" === ",AND=negate?" || ":" && ",OK=negate?"!":"",NOT=negate?"":"!";switch(dataType){case"null":return data+EQUAL+"null";case"array":return OK+"Array.isArray("+data+")";case"object":return"("+OK+data+AND+"typeof "+data+EQUAL+'"object"'+AND+NOT+"Array.isArray("+data+"))";case"integer":return"(typeof "+data+EQUAL+'"number"'+AND+NOT+"("+data+" % 1)"+AND+data+EQUAL+data+")";default:return"typeof "+data+EQUAL+'"'+dataType+'"'}}function checkDataTypes(dataTypes,data){switch(dataTypes.length){case 1:return checkDataType(dataTypes[0],data,true);default:var code="";var types=toHash(dataTypes);if(types.array&&types.object){code=types.null?"(":"(!"+data+" || ";code+="typeof "+data+' !== "object")';delete types.null;delete types.array;delete types.object}if(types.number)delete types.integer;for(var t in types)code+=(code?" && ":"")+checkDataType(t,data,true);return code}}var COERCE_TO_TYPES=toHash(["string","number","integer","boolean","null"]);function coerceToTypes(optionCoerceTypes,dataTypes){if(Array.isArray(dataTypes)){var types=[];for(var i=0;i<dataTypes.length;i++){var t=dataTypes[i];if(COERCE_TO_TYPES[t])types[types.length]=t;else if(optionCoerceTypes==="array"&&t==="array")types[types.length]=t}if(types.length)return types}else if(COERCE_TO_TYPES[dataTypes]){return[dataTypes]}else if(optionCoerceTypes==="array"&&dataTypes==="array"){return["array"]}}function toHash(arr){var hash={};for(var i=0;i<arr.length;i++)hash[arr[i]]=true;return hash}var IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var SINGLE_QUOTE=/'|\\/g;function getProperty(key){return typeof key=="number"?"["+key+"]":IDENTIFIER.test(key)?"."+key:"['"+escapeQuotes(key)+"']"}function escapeQuotes(str){return str.replace(SINGLE_QUOTE,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function varOccurences(str,dataVar){dataVar+="[^0-9]";var matches=str.match(new RegExp(dataVar,"g"));return matches?matches.length:0}function varReplace(str,dataVar,expr){dataVar+="([^0-9])";expr=expr.replace(/\$/g,"$$$$");return str.replace(new RegExp(dataVar,"g"),expr+"$1")}var EMPTY_ELSE=/else\s*{\s*}/g,EMPTY_IF_NO_ELSE=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,EMPTY_IF_WITH_ELSE=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g;function cleanUpCode(out){return out.replace(EMPTY_ELSE,"").replace(EMPTY_IF_NO_ELSE,"").replace(EMPTY_IF_WITH_ELSE,"if (!($1))")}var ERRORS_REGEXP=/[^v.]errors/g,REMOVE_ERRORS=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,REMOVE_ERRORS_ASYNC=/var errors = 0;|var vErrors = null;/g,RETURN_VALID="return errors === 0;",RETURN_TRUE="validate.errors = null; return true;",RETURN_ASYNC=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,RETURN_DATA_ASYNC="return data;",ROOTDATA_REGEXP=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,REMOVE_ROOTDATA=/if \(rootData === undefined\) rootData = data;/;function finalCleanUpCode(out,async){var matches=out.match(ERRORS_REGEXP);if(matches&&matches.length==2){out=async?out.replace(REMOVE_ERRORS_ASYNC,"").replace(RETURN_ASYNC,RETURN_DATA_ASYNC):out.replace(REMOVE_ERRORS,"").replace(RETURN_VALID,RETURN_TRUE)}matches=out.match(ROOTDATA_REGEXP);if(!matches||matches.length!==3)return out;return out.replace(REMOVE_ROOTDATA,"")}function schemaHasRules(schema,rules){if(typeof schema=="boolean")return!schema;for(var key in schema)if(rules[key])return true}function schemaHasRulesExcept(schema,rules,exceptKeyword){if(typeof schema=="boolean")return!schema&&exceptKeyword!="not";for(var key in schema)if(key!=exceptKeyword&&rules[key])return true}function schemaUnknownRules(schema,rules){if(typeof schema=="boolean")return;for(var key in schema)if(!rules[key])return key}function toQuotedString(str){return"'"+escapeQuotes(str)+"'"}function getPathExpr(currentPath,expr,jsonPointers,isNumber){var path=jsonPointers?"'/' + "+expr+(isNumber?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):isNumber?"'[' + "+expr+" + ']'":"'[\\'' + "+expr+" + '\\']'";return joinPaths(currentPath,path)}function getPath(currentPath,prop,jsonPointers){var path=jsonPointers?toQuotedString("/"+escapeJsonPointer(prop)):toQuotedString(getProperty(prop));return joinPaths(currentPath,path)}var JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/;var RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData($data,lvl,paths){var up,jsonPointer,data,matches;if($data==="")return"rootData";if($data[0]=="/"){if(!JSON_POINTER.test($data))throw new Error("Invalid JSON-pointer: "+$data);jsonPointer=$data;data="rootData"}else{matches=$data.match(RELATIVE_JSON_POINTER);if(!matches)throw new Error("Invalid JSON-pointer: "+$data);up=+matches[1];jsonPointer=matches[2];if(jsonPointer=="#"){if(up>=lvl)throw new Error("Cannot access property/index "+up+" levels up, current level is "+lvl);return paths[lvl-up]}if(up>lvl)throw new Error("Cannot access data "+up+" levels up, current level is "+lvl);data="data"+(lvl-up||"");if(!jsonPointer)return data}var expr=data;var segments=jsonPointer.split("/");for(var i=0;i<segments.length;i++){var segment=segments[i];if(segment){data+=getProperty(unescapeJsonPointer(segment));expr+=" && "+data}}return expr}function joinPaths(a,b){if(a=='""')return b;return(a+" + "+b).replace(/' \+ '/g,"")}function unescapeFragment(str){return unescapeJsonPointer(decodeURIComponent(str))}function escapeFragment(str){return encodeURIComponent(escapeJsonPointer(str))}function escapeJsonPointer(str){return str.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapeJsonPointer(str){return str.replace(/~1/g,"/").replace(/~0/g,"~")}},{"./ucs2length":11,"fast-deep-equal":46}],13:[function(require,module,exports){"use strict";var KEYWORDS=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];module.exports=function(metaSchema,keywordsJsonPointers){for(var i=0;i<keywordsJsonPointers.length;i++){metaSchema=JSON.parse(JSON.stringify(metaSchema));var segments=keywordsJsonPointers[i].split("/");var keywords=metaSchema;var j;for(j=1;j<segments.length;j++)keywords=keywords[segments[j]];for(j=0;j<KEYWORDS.length;j++){var key=KEYWORDS[j];var schema=keywords[key];if(schema){keywords[key]={anyOf:[schema,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}}}}return metaSchema}},{}],14:[function(require,module,exports){"use strict";var metaSchema=require("./refs/json-schema-draft-07.json");module.exports={$id:"https://github.com/epoberezkin/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:metaSchema.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:metaSchema.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}},{"./refs/json-schema-draft-07.json":43}],15:[function(require,module,exports){"use strict";module.exports=function generate__limit(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $errorKeyword;var $data="data"+($dataLvl||"");var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $isMax=$keyword=="maximum",$exclusiveKeyword=$isMax?"exclusiveMaximum":"exclusiveMinimum",$schemaExcl=it.schema[$exclusiveKeyword],$isDataExcl=it.opts.$data&&$schemaExcl&&$schemaExcl.$data,$op=$isMax?"<":">",$notOp=$isMax?">":"<",$errorKeyword=undefined;if($isDataExcl){var $schemaValueExcl=it.util.getData($schemaExcl.$data,$dataLvl,it.dataPathArr),$exclusive="exclusive"+$lvl,$exclType="exclType"+$lvl,$exclIsNumber="exclIsNumber"+$lvl,$opExpr="op"+$lvl,$opStr="' + "+$opExpr+" + '";out+=" var schemaExcl"+$lvl+" = "+$schemaValueExcl+"; ";$schemaValueExcl="schemaExcl"+$lvl;out+=" var "+$exclusive+"; var "+$exclType+" = typeof "+$schemaValueExcl+"; if ("+$exclType+" != 'boolean' && "+$exclType+" != 'undefined' && "+$exclType+" != 'number') { ";var $errorKeyword=$exclusiveKeyword;var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: {} ";if(it.opts.messages!==false){out+=" , message: '"+$exclusiveKeyword+" should be boolean' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } else if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'number') || "}out+=" "+$exclType+" == 'number' ? ( ("+$exclusive+" = "+$schemaValue+" === undefined || "+$schemaValueExcl+" "+$op+"= "+$schemaValue+") ? "+$data+" "+$notOp+"= "+$schemaValueExcl+" : "+$data+" "+$notOp+" "+$schemaValue+" ) : ( ("+$exclusive+" = "+$schemaValueExcl+" === true) ? "+$data+" "+$notOp+"= "+$schemaValue+" : "+$data+" "+$notOp+" "+$schemaValue+" ) || "+$data+" !== "+$data+") { var op"+$lvl+" = "+$exclusive+" ? '"+$op+"' : '"+$op+"='; ";if($schema===undefined){$errorKeyword=$exclusiveKeyword;$errSchemaPath=it.errSchemaPath+"/"+$exclusiveKeyword;$schemaValue=$schemaValueExcl;$isData=$isDataExcl}}else{var $exclIsNumber=typeof $schemaExcl=="number",$opStr=$op;if($exclIsNumber&&$isData){var $opExpr="'"+$opStr+"'";out+=" if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'number') || "}out+=" ( "+$schemaValue+" === undefined || "+$schemaExcl+" "+$op+"= "+$schemaValue+" ? "+$data+" "+$notOp+"= "+$schemaExcl+" : "+$data+" "+$notOp+" "+$schemaValue+" ) || "+$data+" !== "+$data+") { "}else{if($exclIsNumber&&$schema===undefined){$exclusive=true;$errorKeyword=$exclusiveKeyword;$errSchemaPath=it.errSchemaPath+"/"+$exclusiveKeyword;$schemaValue=$schemaExcl;$notOp+="="}else{if($exclIsNumber)$schemaValue=Math[$isMax?"min":"max"]($schemaExcl,$schema);if($schemaExcl===($exclIsNumber?$schemaValue:true)){$exclusive=true;$errorKeyword=$exclusiveKeyword;$errSchemaPath=it.errSchemaPath+"/"+$exclusiveKeyword;$notOp+="="}else{$exclusive=false;$opStr+="="}}var $opExpr="'"+$opStr+"'";out+=" if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'number') || "}out+=" "+$data+" "+$notOp+" "+$schemaValue+" || "+$data+" !== "+$data+") { "}}$errorKeyword=$errorKeyword||$keyword;var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"_limit")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { comparison: "+$opExpr+", limit: "+$schemaValue+", exclusive: "+$exclusive+" } ";if(it.opts.messages!==false){out+=" , message: 'should be "+$opStr+" ";if($isData){out+="' + "+$schemaValue}else{out+=""+$schemaValue+"'"}}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+$schema}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } ";if($breakOnError){out+=" else { "}return out}},{}],16:[function(require,module,exports){"use strict";module.exports=function generate__limitItems(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $errorKeyword;var $data="data"+($dataLvl||"");var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $op=$keyword=="maxItems"?">":"<";out+="if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'number') || "}out+=" "+$data+".length "+$op+" "+$schemaValue+") { ";var $errorKeyword=$keyword;var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"_limitItems")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { limit: "+$schemaValue+" } ";if(it.opts.messages!==false){out+=" , message: 'should NOT have ";if($keyword=="maxItems"){out+="more"}else{out+="fewer"}out+=" than ";if($isData){out+="' + "+$schemaValue+" + '"}else{out+=""+$schema}out+=" items' "}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+$schema}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+="} ";if($breakOnError){out+=" else { "}return out}},{}],17:[function(require,module,exports){"use strict";module.exports=function generate__limitLength(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $errorKeyword;var $data="data"+($dataLvl||"");var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $op=$keyword=="maxLength"?">":"<";out+="if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'number') || "}if(it.opts.unicode===false){out+=" "+$data+".length "}else{out+=" ucs2length("+$data+") "}out+=" "+$op+" "+$schemaValue+") { ";var $errorKeyword=$keyword;var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"_limitLength")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { limit: "+$schemaValue+" } ";if(it.opts.messages!==false){out+=" , message: 'should NOT be ";if($keyword=="maxLength"){out+="longer"}else{out+="shorter"}out+=" than ";if($isData){out+="' + "+$schemaValue+" + '"}else{out+=""+$schema}out+=" characters' "}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+$schema}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+="} ";if($breakOnError){out+=" else { "}return out}},{}],18:[function(require,module,exports){"use strict";module.exports=function generate__limitProperties(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $errorKeyword;var $data="data"+($dataLvl||"");var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $op=$keyword=="maxProperties"?">":"<";out+="if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'number') || "}out+=" Object.keys("+$data+").length "+$op+" "+$schemaValue+") { ";var $errorKeyword=$keyword;var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"_limitProperties")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { limit: "+$schemaValue+" } ";if(it.opts.messages!==false){out+=" , message: 'should NOT have ";if($keyword=="maxProperties"){out+="more"}else{out+="fewer"}out+=" than ";if($isData){out+="' + "+$schemaValue+" + '"}else{out+=""+$schema}out+=" properties' "}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+$schema}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+="} ";if($breakOnError){out+=" else { "}return out}},{}],19:[function(require,module,exports){"use strict";module.exports=function generate_allOf(it,$keyword,$ruleType){var out=" ";var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $currentBaseId=$it.baseId,$allSchemasEmpty=true;var arr1=$schema;if(arr1){var $sch,$i=-1,l1=arr1.length-1;while($i<l1){$sch=arr1[$i+=1];if(it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)){$allSchemasEmpty=false;$it.schema=$sch;$it.schemaPath=$schemaPath+"["+$i+"]";$it.errSchemaPath=$errSchemaPath+"/"+$i;out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId;if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}}}if($breakOnError){if($allSchemasEmpty){out+=" if (true) { "}else{out+=" "+$closingBraces.slice(0,-1)+" "}}out=it.util.cleanUpCode(out);return out}},{}],20:[function(require,module,exports){"use strict";module.exports=function generate_anyOf(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $noEmptySchema=$schema.every((function($sch){return it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)}));if($noEmptySchema){var $currentBaseId=$it.baseId;out+=" var "+$errs+" = errors; var "+$valid+" = false;  ";var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;var arr1=$schema;if(arr1){var $sch,$i=-1,l1=arr1.length-1;while($i<l1){$sch=arr1[$i+=1];$it.schema=$sch;$it.schemaPath=$schemaPath+"["+$i+"]";$it.errSchemaPath=$errSchemaPath+"/"+$i;out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId;out+=" "+$valid+" = "+$valid+" || "+$nextValid+"; if (!"+$valid+") { ";$closingBraces+="}"}}it.compositeRule=$it.compositeRule=$wasComposite;out+=" "+$closingBraces+" if (!"+$valid+") {   var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"anyOf"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: {} ";if(it.opts.messages!==false){out+=" , message: 'should match some schema in anyOf' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(vErrors); "}else{out+=" validate.errors = vErrors; return false; "}}out+=" } else {  errors = "+$errs+"; if (vErrors !== null) { if ("+$errs+") vErrors.length = "+$errs+"; else vErrors = null; } ";if(it.opts.allErrors){out+=" } "}out=it.util.cleanUpCode(out)}else{if($breakOnError){out+=" if (true) { "}}return out}},{}],21:[function(require,module,exports){"use strict";module.exports=function generate_comment(it,$keyword,$ruleType){var out=" ";var $schema=it.schema[$keyword];var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $comment=it.util.toQuotedString($schema);if(it.opts.$comment===true){out+=" console.log("+$comment+");"}else if(typeof it.opts.$comment=="function"){out+=" self._opts.$comment("+$comment+", "+it.util.toQuotedString($errSchemaPath)+", validate.root.schema);"}return out}},{}],22:[function(require,module,exports){"use strict";module.exports=function generate_const(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}if(!$isData){out+=" var schema"+$lvl+" = validate.schema"+$schemaPath+";"}out+="var "+$valid+" = equal("+$data+", schema"+$lvl+"); if (!"+$valid+") {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"const"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { allowedValue: schema"+$lvl+" } ";if(it.opts.messages!==false){out+=" , message: 'should be equal to constant' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" }";if($breakOnError){out+=" else { "}return out}},{}],23:[function(require,module,exports){"use strict";module.exports=function generate_contains(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $idx="i"+$lvl,$dataNxt=$it.dataLevel=it.dataLevel+1,$nextData="data"+$dataNxt,$currentBaseId=it.baseId,$nonEmptySchema=it.opts.strictKeywords?typeof $schema=="object"&&Object.keys($schema).length>0:it.util.schemaHasRules($schema,it.RULES.all);out+="var "+$errs+" = errors;var "+$valid+";";if($nonEmptySchema){var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;$it.schema=$schema;$it.schemaPath=$schemaPath;$it.errSchemaPath=$errSchemaPath;out+=" var "+$nextValid+" = false; for (var "+$idx+" = 0; "+$idx+" < "+$data+".length; "+$idx+"++) { ";$it.errorPath=it.util.getPathExpr(it.errorPath,$idx,it.opts.jsonPointers,true);var $passData=$data+"["+$idx+"]";$it.dataPathArr[$dataNxt]=$idx;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}out+=" if ("+$nextValid+") break; }  ";it.compositeRule=$it.compositeRule=$wasComposite;out+=" "+$closingBraces+" if (!"+$nextValid+") {"}else{out+=" if ("+$data+".length == 0) {"}var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"contains"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: {} ";if(it.opts.messages!==false){out+=" , message: 'should contain a valid item' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } else { ";if($nonEmptySchema){out+="  errors = "+$errs+"; if (vErrors !== null) { if ("+$errs+") vErrors.length = "+$errs+"; else vErrors = null; } "}if(it.opts.allErrors){out+=" } "}out=it.util.cleanUpCode(out);return out}},{}],24:[function(require,module,exports){"use strict";module.exports=function generate_custom(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $errorKeyword;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $errs="errs__"+$lvl;var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $rule=this,$definition="definition"+$lvl,$rDef=$rule.definition,$closingBraces="";var $compile,$inline,$macro,$ruleValidate,$validateCode;if($isData&&$rDef.$data){$validateCode="keywordValidate"+$lvl;var $validateSchema=$rDef.validateSchema;out+=" var "+$definition+" = RULES.custom['"+$keyword+"'].definition; var "+$validateCode+" = "+$definition+".validate;"}else{$ruleValidate=it.useCustomRule($rule,$schema,it.schema,it);if(!$ruleValidate)return;$schemaValue="validate.schema"+$schemaPath;$validateCode=$ruleValidate.code;$compile=$rDef.compile;$inline=$rDef.inline;$macro=$rDef.macro}var $ruleErrs=$validateCode+".errors",$i="i"+$lvl,$ruleErr="ruleErr"+$lvl,$asyncKeyword=$rDef.async;if($asyncKeyword&&!it.async)throw new Error("async keyword in sync schema");if(!($inline||$macro)){out+=""+$ruleErrs+" = null;"}out+="var "+$errs+" = errors;var "+$valid+";";if($isData&&$rDef.$data){$closingBraces+="}";out+=" if ("+$schemaValue+" === undefined) { "+$valid+" = true; } else { ";if($validateSchema){$closingBraces+="}";out+=" "+$valid+" = "+$definition+".validateSchema("+$schemaValue+"); if ("+$valid+") { "}}if($inline){if($rDef.statements){out+=" "+$ruleValidate.validate+" "}else{out+=" "+$valid+" = "+$ruleValidate.validate+"; "}}else if($macro){var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;$it.schema=$ruleValidate.validate;$it.schemaPath="";var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;var $code=it.validate($it).replace(/validate\.schema/g,$validateCode);it.compositeRule=$it.compositeRule=$wasComposite;out+=" "+$code}else{var $$outStack=$$outStack||[];$$outStack.push(out);out="";out+="  "+$validateCode+".call( ";if(it.opts.passContext){out+="this"}else{out+="self"}if($compile||$rDef.schema===false){out+=" , "+$data+" "}else{out+=" , "+$schemaValue+" , "+$data+" , validate.schema"+it.schemaPath+" "}out+=" , (dataPath || '')";if(it.errorPath!='""'){out+=" + "+it.errorPath}var $parentData=$dataLvl?"data"+($dataLvl-1||""):"parentData",$parentDataProperty=$dataLvl?it.dataPathArr[$dataLvl]:"parentDataProperty";out+=" , "+$parentData+" , "+$parentDataProperty+" , rootData )  ";var def_callRuleValidate=out;out=$$outStack.pop();if($rDef.errors===false){out+=" "+$valid+" = ";if($asyncKeyword){out+="await "}out+=""+def_callRuleValidate+"; "}else{if($asyncKeyword){$ruleErrs="customErrors"+$lvl;out+=" var "+$ruleErrs+" = null; try { "+$valid+" = await "+def_callRuleValidate+"; } catch (e) { "+$valid+" = false; if (e instanceof ValidationError) "+$ruleErrs+" = e.errors; else throw e; } "}else{out+=" "+$ruleErrs+" = null; "+$valid+" = "+def_callRuleValidate+"; "}}}if($rDef.modifying){out+=" if ("+$parentData+") "+$data+" = "+$parentData+"["+$parentDataProperty+"];"}out+=""+$closingBraces;if($rDef.valid){if($breakOnError){out+=" if (true) { "}}else{out+=" if ( ";if($rDef.valid===undefined){out+=" !";if($macro){out+=""+$nextValid}else{out+=""+$valid}}else{out+=" "+!$rDef.valid+" "}out+=") { ";$errorKeyword=$rule.keyword;var $$outStack=$$outStack||[];$$outStack.push(out);out="";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"custom")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { keyword: '"+$rule.keyword+"' } ";if(it.opts.messages!==false){out+=" , message: 'should pass \""+$rule.keyword+"\" keyword validation' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}var def_customError=out;out=$$outStack.pop();if($inline){if($rDef.errors){if($rDef.errors!="full"){out+="  for (var "+$i+"="+$errs+"; "+$i+"<errors; "+$i+"++) { var "+$ruleErr+" = vErrors["+$i+"]; if ("+$ruleErr+".dataPath === undefined) "+$ruleErr+".dataPath = (dataPath || '') + "+it.errorPath+"; if ("+$ruleErr+".schemaPath === undefined) { "+$ruleErr+'.schemaPath = "'+$errSchemaPath+'"; } ';if(it.opts.verbose){out+=" "+$ruleErr+".schema = "+$schemaValue+"; "+$ruleErr+".data = "+$data+"; "}out+=" } "}}else{if($rDef.errors===false){out+=" "+def_customError+" "}else{out+=" if ("+$errs+" == errors) { "+def_customError+" } else {  for (var "+$i+"="+$errs+"; "+$i+"<errors; "+$i+"++) { var "+$ruleErr+" = vErrors["+$i+"]; if ("+$ruleErr+".dataPath === undefined) "+$ruleErr+".dataPath = (dataPath || '') + "+it.errorPath+"; if ("+$ruleErr+".schemaPath === undefined) { "+$ruleErr+'.schemaPath = "'+$errSchemaPath+'"; } ';if(it.opts.verbose){out+=" "+$ruleErr+".schema = "+$schemaValue+"; "+$ruleErr+".data = "+$data+"; "}out+=" } } "}}}else if($macro){out+="   var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"custom")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { keyword: '"+$rule.keyword+"' } ";if(it.opts.messages!==false){out+=" , message: 'should pass \""+$rule.keyword+"\" keyword validation' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(vErrors); "}else{out+=" validate.errors = vErrors; return false; "}}}else{if($rDef.errors===false){out+=" "+def_customError+" "}else{out+=" if (Array.isArray("+$ruleErrs+")) { if (vErrors === null) vErrors = "+$ruleErrs+"; else vErrors = vErrors.concat("+$ruleErrs+"); errors = vErrors.length;  for (var "+$i+"="+$errs+"; "+$i+"<errors; "+$i+"++) { var "+$ruleErr+" = vErrors["+$i+"]; if ("+$ruleErr+".dataPath === undefined) "+$ruleErr+".dataPath = (dataPath || '') + "+it.errorPath+";  "+$ruleErr+'.schemaPath = "'+$errSchemaPath+'";  ';if(it.opts.verbose){out+=" "+$ruleErr+".schema = "+$schemaValue+"; "+$ruleErr+".data = "+$data+"; "}out+=" } } else { "+def_customError+" } "}}out+=" } ";if($breakOnError){out+=" else { "}}return out}},{}],25:[function(require,module,exports){"use strict";module.exports=function generate_dependencies(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $schemaDeps={},$propertyDeps={},$ownProperties=it.opts.ownProperties;for($property in $schema){var $sch=$schema[$property];var $deps=Array.isArray($sch)?$propertyDeps:$schemaDeps;$deps[$property]=$sch}out+="var "+$errs+" = errors;";var $currentErrorPath=it.errorPath;out+="var missing"+$lvl+";";for(var $property in $propertyDeps){$deps=$propertyDeps[$property];if($deps.length){out+=" if ( "+$data+it.util.getProperty($property)+" !== undefined ";if($ownProperties){out+=" && Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($property)+"') "}if($breakOnError){out+=" && ( ";var arr1=$deps;if(arr1){var $propertyKey,$i=-1,l1=arr1.length-1;while($i<l1){$propertyKey=arr1[$i+=1];if($i){out+=" || "}var $prop=it.util.getProperty($propertyKey),$useData=$data+$prop;out+=" ( ( "+$useData+" === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=") && (missing"+$lvl+" = "+it.util.toQuotedString(it.opts.jsonPointers?$propertyKey:$prop)+") ) "}}out+=")) {  ";var $propertyPath="missing"+$lvl,$missingProperty="' + "+$propertyPath+" + '";if(it.opts._errorDataPathProperty){it.errorPath=it.opts.jsonPointers?it.util.getPathExpr($currentErrorPath,$propertyPath,true):$currentErrorPath+" + "+$propertyPath}var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"dependencies"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { property: '"+it.util.escapeQuotes($property)+"', missingProperty: '"+$missingProperty+"', depsCount: "+$deps.length+", deps: '"+it.util.escapeQuotes($deps.length==1?$deps[0]:$deps.join(", "))+"' } ";if(it.opts.messages!==false){out+=" , message: 'should have ";if($deps.length==1){out+="property "+it.util.escapeQuotes($deps[0])}else{out+="properties "+it.util.escapeQuotes($deps.join(", "))}out+=" when property "+it.util.escapeQuotes($property)+" is present' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}}else{out+=" ) { ";var arr2=$deps;if(arr2){var $propertyKey,i2=-1,l2=arr2.length-1;while(i2<l2){$propertyKey=arr2[i2+=1];var $prop=it.util.getProperty($propertyKey),$missingProperty=it.util.escapeQuotes($propertyKey),$useData=$data+$prop;if(it.opts._errorDataPathProperty){it.errorPath=it.util.getPath($currentErrorPath,$propertyKey,it.opts.jsonPointers)}out+=" if ( "+$useData+" === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=") {  var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"dependencies"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { property: '"+it.util.escapeQuotes($property)+"', missingProperty: '"+$missingProperty+"', depsCount: "+$deps.length+", deps: '"+it.util.escapeQuotes($deps.length==1?$deps[0]:$deps.join(", "))+"' } ";if(it.opts.messages!==false){out+=" , message: 'should have ";if($deps.length==1){out+="property "+it.util.escapeQuotes($deps[0])}else{out+="properties "+it.util.escapeQuotes($deps.join(", "))}out+=" when property "+it.util.escapeQuotes($property)+" is present' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}}out+=" }   ";if($breakOnError){$closingBraces+="}";out+=" else { "}}}it.errorPath=$currentErrorPath;var $currentBaseId=$it.baseId;for(var $property in $schemaDeps){var $sch=$schemaDeps[$property];if(it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)){out+=" "+$nextValid+" = true; if ( "+$data+it.util.getProperty($property)+" !== undefined ";if($ownProperties){out+=" && Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($property)+"') "}out+=") { ";$it.schema=$sch;$it.schemaPath=$schemaPath+it.util.getProperty($property);$it.errSchemaPath=$errSchemaPath+"/"+it.util.escapeFragment($property);out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId;out+=" }  ";if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}}if($breakOnError){out+="   "+$closingBraces+" if ("+$errs+" == errors) {"}out=it.util.cleanUpCode(out);return out}},{}],26:[function(require,module,exports){"use strict";module.exports=function generate_enum(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $i="i"+$lvl,$vSchema="schema"+$lvl;if(!$isData){out+=" var "+$vSchema+" = validate.schema"+$schemaPath+";"}out+="var "+$valid+";";if($isData){out+=" if (schema"+$lvl+" === undefined) "+$valid+" = true; else if (!Array.isArray(schema"+$lvl+")) "+$valid+" = false; else {"}out+=""+$valid+" = false;for (var "+$i+"=0; "+$i+"<"+$vSchema+".length; "+$i+"++) if (equal("+$data+", "+$vSchema+"["+$i+"])) { "+$valid+" = true; break; }";if($isData){out+="  }  "}out+=" if (!"+$valid+") {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"enum"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { allowedValues: schema"+$lvl+" } ";if(it.opts.messages!==false){out+=" , message: 'should be equal to one of the allowed values' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" }";if($breakOnError){out+=" else { "}return out}},{}],27:[function(require,module,exports){"use strict";module.exports=function generate_format(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");if(it.opts.format===false){if($breakOnError){out+=" if (true) { "}return out}var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $unknownFormats=it.opts.unknownFormats,$allowUnknown=Array.isArray($unknownFormats);if($isData){var $format="format"+$lvl,$isObject="isObject"+$lvl,$formatType="formatType"+$lvl;out+=" var "+$format+" = formats["+$schemaValue+"]; var "+$isObject+" = typeof "+$format+" == 'object' && !("+$format+" instanceof RegExp) && "+$format+".validate; var "+$formatType+" = "+$isObject+" && "+$format+".type || 'string'; if ("+$isObject+") { ";if(it.async){out+=" var async"+$lvl+" = "+$format+".async; "}out+=" "+$format+" = "+$format+".validate; } if (  ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'string') || "}out+=" (";if($unknownFormats!="ignore"){out+=" ("+$schemaValue+" && !"+$format+" ";if($allowUnknown){out+=" && self._opts.unknownFormats.indexOf("+$schemaValue+") == -1 "}out+=") || "}out+=" ("+$format+" && "+$formatType+" == '"+$ruleType+"' && !(typeof "+$format+" == 'function' ? ";if(it.async){out+=" (async"+$lvl+" ? await "+$format+"("+$data+") : "+$format+"("+$data+")) "}else{out+=" "+$format+"("+$data+") "}out+=" : "+$format+".test("+$data+"))))) {"}else{var $format=it.formats[$schema];if(!$format){if($unknownFormats=="ignore"){it.logger.warn('unknown format "'+$schema+'" ignored in schema at path "'+it.errSchemaPath+'"');if($breakOnError){out+=" if (true) { "}return out}else if($allowUnknown&&$unknownFormats.indexOf($schema)>=0){if($breakOnError){out+=" if (true) { "}return out}else{throw new Error('unknown format "'+$schema+'" is used in schema at path "'+it.errSchemaPath+'"')}}var $isObject=typeof $format=="object"&&!($format instanceof RegExp)&&$format.validate;var $formatType=$isObject&&$format.type||"string";if($isObject){var $async=$format.async===true;$format=$format.validate}if($formatType!=$ruleType){if($breakOnError){out+=" if (true) { "}return out}if($async){if(!it.async)throw new Error("async format in sync schema");var $formatRef="formats"+it.util.getProperty($schema)+".validate";out+=" if (!(await "+$formatRef+"("+$data+"))) { "}else{out+=" if (! ";var $formatRef="formats"+it.util.getProperty($schema);if($isObject)$formatRef+=".validate";if(typeof $format=="function"){out+=" "+$formatRef+"("+$data+") "}else{out+=" "+$formatRef+".test("+$data+") "}out+=") { "}}var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"format"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { format:  ";if($isData){out+=""+$schemaValue}else{out+=""+it.util.toQuotedString($schema)}out+="  } ";if(it.opts.messages!==false){out+=" , message: 'should match format \"";if($isData){out+="' + "+$schemaValue+" + '"}else{out+=""+it.util.escapeQuotes($schema)}out+="\"' "}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+it.util.toQuotedString($schema)}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } ";if($breakOnError){out+=" else { "}return out}},{}],28:[function(require,module,exports){"use strict";module.exports=function generate_if(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $errs="errs__"+$lvl;var $it=it.util.copy(it);$it.level++;var $nextValid="valid"+$it.level;var $thenSch=it.schema["then"],$elseSch=it.schema["else"],$thenPresent=$thenSch!==undefined&&(it.opts.strictKeywords?typeof $thenSch=="object"&&Object.keys($thenSch).length>0:it.util.schemaHasRules($thenSch,it.RULES.all)),$elsePresent=$elseSch!==undefined&&(it.opts.strictKeywords?typeof $elseSch=="object"&&Object.keys($elseSch).length>0:it.util.schemaHasRules($elseSch,it.RULES.all)),$currentBaseId=$it.baseId;if($thenPresent||$elsePresent){var $ifClause;$it.createErrors=false;$it.schema=$schema;$it.schemaPath=$schemaPath;$it.errSchemaPath=$errSchemaPath;out+=" var "+$errs+" = errors; var "+$valid+" = true;  ";var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId;$it.createErrors=true;out+="  errors = "+$errs+"; if (vErrors !== null) { if ("+$errs+") vErrors.length = "+$errs+"; else vErrors = null; }  ";it.compositeRule=$it.compositeRule=$wasComposite;if($thenPresent){out+=" if ("+$nextValid+") {  ";$it.schema=it.schema["then"];$it.schemaPath=it.schemaPath+".then";$it.errSchemaPath=it.errSchemaPath+"/then";out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId;out+=" "+$valid+" = "+$nextValid+"; ";if($thenPresent&&$elsePresent){$ifClause="ifClause"+$lvl;out+=" var "+$ifClause+" = 'then'; "}else{$ifClause="'then'"}out+=" } ";if($elsePresent){out+=" else { "}}else{out+=" if (!"+$nextValid+") { "}if($elsePresent){$it.schema=it.schema["else"];$it.schemaPath=it.schemaPath+".else";$it.errSchemaPath=it.errSchemaPath+"/else";out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId;out+=" "+$valid+" = "+$nextValid+"; ";if($thenPresent&&$elsePresent){$ifClause="ifClause"+$lvl;out+=" var "+$ifClause+" = 'else'; "}else{$ifClause="'else'"}out+=" } "}out+=" if (!"+$valid+") {   var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"if"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { failingKeyword: "+$ifClause+" } ";if(it.opts.messages!==false){out+=" , message: 'should match \"' + "+$ifClause+" + '\" schema' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(vErrors); "}else{out+=" validate.errors = vErrors; return false; "}}out+=" }   ";if($breakOnError){out+=" else { "}out=it.util.cleanUpCode(out)}else{if($breakOnError){out+=" if (true) { "}}return out}},{}],29:[function(require,module,exports){"use strict";module.exports={$ref:require("./ref"),allOf:require("./allOf"),anyOf:require("./anyOf"),$comment:require("./comment"),const:require("./const"),contains:require("./contains"),dependencies:require("./dependencies"),enum:require("./enum"),format:require("./format"),if:require("./if"),items:require("./items"),maximum:require("./_limit"),minimum:require("./_limit"),maxItems:require("./_limitItems"),minItems:require("./_limitItems"),maxLength:require("./_limitLength"),minLength:require("./_limitLength"),maxProperties:require("./_limitProperties"),minProperties:require("./_limitProperties"),multipleOf:require("./multipleOf"),not:require("./not"),oneOf:require("./oneOf"),pattern:require("./pattern"),properties:require("./properties"),propertyNames:require("./propertyNames"),required:require("./required"),uniqueItems:require("./uniqueItems"),validate:require("./validate")}},{"./_limit":15,"./_limitItems":16,"./_limitLength":17,"./_limitProperties":18,"./allOf":19,"./anyOf":20,"./comment":21,"./const":22,"./contains":23,"./dependencies":25,"./enum":26,"./format":27,"./if":28,"./items":30,"./multipleOf":31,"./not":32,"./oneOf":33,"./pattern":34,"./properties":35,"./propertyNames":36,"./ref":37,"./required":38,"./uniqueItems":39,"./validate":40}],30:[function(require,module,exports){"use strict";module.exports=function generate_items(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $idx="i"+$lvl,$dataNxt=$it.dataLevel=it.dataLevel+1,$nextData="data"+$dataNxt,$currentBaseId=it.baseId;out+="var "+$errs+" = errors;var "+$valid+";";if(Array.isArray($schema)){var $additionalItems=it.schema.additionalItems;if($additionalItems===false){out+=" "+$valid+" = "+$data+".length <= "+$schema.length+"; ";var $currErrSchemaPath=$errSchemaPath;$errSchemaPath=it.errSchemaPath+"/additionalItems";out+="  if (!"+$valid+") {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"additionalItems"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { limit: "+$schema.length+" } ";if(it.opts.messages!==false){out+=" , message: 'should NOT have more than "+$schema.length+" items' "}if(it.opts.verbose){out+=" , schema: false , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } ";$errSchemaPath=$currErrSchemaPath;if($breakOnError){$closingBraces+="}";out+=" else { "}}var arr1=$schema;if(arr1){var $sch,$i=-1,l1=arr1.length-1;while($i<l1){$sch=arr1[$i+=1];if(it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)){out+=" "+$nextValid+" = true; if ("+$data+".length > "+$i+") { ";var $passData=$data+"["+$i+"]";$it.schema=$sch;$it.schemaPath=$schemaPath+"["+$i+"]";$it.errSchemaPath=$errSchemaPath+"/"+$i;$it.errorPath=it.util.getPathExpr(it.errorPath,$i,it.opts.jsonPointers,true);$it.dataPathArr[$dataNxt]=$i;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}out+=" }  ";if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}}}if(typeof $additionalItems=="object"&&(it.opts.strictKeywords?typeof $additionalItems=="object"&&Object.keys($additionalItems).length>0:it.util.schemaHasRules($additionalItems,it.RULES.all))){$it.schema=$additionalItems;$it.schemaPath=it.schemaPath+".additionalItems";$it.errSchemaPath=it.errSchemaPath+"/additionalItems";out+=" "+$nextValid+" = true; if ("+$data+".length > "+$schema.length+") {  for (var "+$idx+" = "+$schema.length+"; "+$idx+" < "+$data+".length; "+$idx+"++) { ";$it.errorPath=it.util.getPathExpr(it.errorPath,$idx,it.opts.jsonPointers,true);var $passData=$data+"["+$idx+"]";$it.dataPathArr[$dataNxt]=$idx;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}if($breakOnError){out+=" if (!"+$nextValid+") break; "}out+=" } }  ";if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}}else if(it.opts.strictKeywords?typeof $schema=="object"&&Object.keys($schema).length>0:it.util.schemaHasRules($schema,it.RULES.all)){$it.schema=$schema;$it.schemaPath=$schemaPath;$it.errSchemaPath=$errSchemaPath;out+="  for (var "+$idx+" = "+0+"; "+$idx+" < "+$data+".length; "+$idx+"++) { ";$it.errorPath=it.util.getPathExpr(it.errorPath,$idx,it.opts.jsonPointers,true);var $passData=$data+"["+$idx+"]";$it.dataPathArr[$dataNxt]=$idx;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}if($breakOnError){out+=" if (!"+$nextValid+") break; "}out+=" }"}if($breakOnError){out+=" "+$closingBraces+" if ("+$errs+" == errors) {"}out=it.util.cleanUpCode(out);return out}},{}],31:[function(require,module,exports){"use strict";module.exports=function generate_multipleOf(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}out+="var division"+$lvl+";if (";if($isData){out+=" "+$schemaValue+" !== undefined && ( typeof "+$schemaValue+" != 'number' || "}out+=" (division"+$lvl+" = "+$data+" / "+$schemaValue+", ";if(it.opts.multipleOfPrecision){out+=" Math.abs(Math.round(division"+$lvl+") - division"+$lvl+") > 1e-"+it.opts.multipleOfPrecision+" "}else{out+=" division"+$lvl+" !== parseInt(division"+$lvl+") "}out+=" ) ";if($isData){out+="  )  "}out+=" ) {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"multipleOf"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { multipleOf: "+$schemaValue+" } ";if(it.opts.messages!==false){out+=" , message: 'should be multiple of ";if($isData){out+="' + "+$schemaValue}else{out+=""+$schemaValue+"'"}}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+$schema}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+="} ";if($breakOnError){out+=" else { "}return out}},{}],32:[function(require,module,exports){"use strict";module.exports=function generate_not(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $errs="errs__"+$lvl;var $it=it.util.copy(it);$it.level++;var $nextValid="valid"+$it.level;if(it.opts.strictKeywords?typeof $schema=="object"&&Object.keys($schema).length>0:it.util.schemaHasRules($schema,it.RULES.all)){$it.schema=$schema;$it.schemaPath=$schemaPath;$it.errSchemaPath=$errSchemaPath;out+=" var "+$errs+" = errors;  ";var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;$it.createErrors=false;var $allErrorsOption;if($it.opts.allErrors){$allErrorsOption=$it.opts.allErrors;$it.opts.allErrors=false}out+=" "+it.validate($it)+" ";$it.createErrors=true;if($allErrorsOption)$it.opts.allErrors=$allErrorsOption;it.compositeRule=$it.compositeRule=$wasComposite;out+=" if ("+$nextValid+") {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"not"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: {} ";if(it.opts.messages!==false){out+=" , message: 'should NOT be valid' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } else {  errors = "+$errs+"; if (vErrors !== null) { if ("+$errs+") vErrors.length = "+$errs+"; else vErrors = null; } ";if(it.opts.allErrors){out+=" } "}}else{out+="  var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"not"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: {} ";if(it.opts.messages!==false){out+=" , message: 'should NOT be valid' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";if($breakOnError){out+=" if (false) { "}}return out}},{}],33:[function(require,module,exports){"use strict";module.exports=function generate_oneOf(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $currentBaseId=$it.baseId,$prevValid="prevValid"+$lvl,$passingSchemas="passingSchemas"+$lvl;out+="var "+$errs+" = errors , "+$prevValid+" = false , "+$valid+" = false , "+$passingSchemas+" = null; ";var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;var arr1=$schema;if(arr1){var $sch,$i=-1,l1=arr1.length-1;while($i<l1){$sch=arr1[$i+=1];if(it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)){$it.schema=$sch;$it.schemaPath=$schemaPath+"["+$i+"]";$it.errSchemaPath=$errSchemaPath+"/"+$i;out+="  "+it.validate($it)+" ";$it.baseId=$currentBaseId}else{out+=" var "+$nextValid+" = true; "}if($i){out+=" if ("+$nextValid+" && "+$prevValid+") { "+$valid+" = false; "+$passingSchemas+" = ["+$passingSchemas+", "+$i+"]; } else { ";$closingBraces+="}"}out+=" if ("+$nextValid+") { "+$valid+" = "+$prevValid+" = true; "+$passingSchemas+" = "+$i+"; }"}}it.compositeRule=$it.compositeRule=$wasComposite;out+=""+$closingBraces+"if (!"+$valid+") {   var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"oneOf"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { passingSchemas: "+$passingSchemas+" } ";if(it.opts.messages!==false){out+=" , message: 'should match exactly one schema in oneOf' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(vErrors); "}else{out+=" validate.errors = vErrors; return false; "}}out+="} else {  errors = "+$errs+"; if (vErrors !== null) { if ("+$errs+") vErrors.length = "+$errs+"; else vErrors = null; }";if(it.opts.allErrors){out+=" } "}return out}},{}],34:[function(require,module,exports){"use strict";module.exports=function generate_pattern(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $regexp=$isData?"(new RegExp("+$schemaValue+"))":it.usePattern($schema);out+="if ( ";if($isData){out+=" ("+$schemaValue+" !== undefined && typeof "+$schemaValue+" != 'string') || "}out+=" !"+$regexp+".test("+$data+") ) {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"pattern"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { pattern:  ";if($isData){out+=""+$schemaValue}else{out+=""+it.util.toQuotedString($schema)}out+="  } ";if(it.opts.messages!==false){out+=" , message: 'should match pattern \"";if($isData){out+="' + "+$schemaValue+" + '"}else{out+=""+it.util.escapeQuotes($schema)}out+="\"' "}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+it.util.toQuotedString($schema)}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+="} ";if($breakOnError){out+=" else { "}return out}},{}],35:[function(require,module,exports){"use strict";module.exports=function generate_properties(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;var $key="key"+$lvl,$idx="idx"+$lvl,$dataNxt=$it.dataLevel=it.dataLevel+1,$nextData="data"+$dataNxt,$dataProperties="dataProperties"+$lvl;var $schemaKeys=Object.keys($schema||{}),$pProperties=it.schema.patternProperties||{},$pPropertyKeys=Object.keys($pProperties),$aProperties=it.schema.additionalProperties,$someProperties=$schemaKeys.length||$pPropertyKeys.length,$noAdditional=$aProperties===false,$additionalIsSchema=typeof $aProperties=="object"&&Object.keys($aProperties).length,$removeAdditional=it.opts.removeAdditional,$checkAdditional=$noAdditional||$additionalIsSchema||$removeAdditional,$ownProperties=it.opts.ownProperties,$currentBaseId=it.baseId;var $required=it.schema.required;if($required&&!(it.opts.$data&&$required.$data)&&$required.length<it.opts.loopRequired)var $requiredHash=it.util.toHash($required);out+="var "+$errs+" = errors;var "+$nextValid+" = true;";if($ownProperties){out+=" var "+$dataProperties+" = undefined;"}if($checkAdditional){if($ownProperties){out+=" "+$dataProperties+" = "+$dataProperties+" || Object.keys("+$data+"); for (var "+$idx+"=0; "+$idx+"<"+$dataProperties+".length; "+$idx+"++) { var "+$key+" = "+$dataProperties+"["+$idx+"]; "}else{out+=" for (var "+$key+" in "+$data+") { "}if($someProperties){out+=" var isAdditional"+$lvl+" = !(false ";if($schemaKeys.length){if($schemaKeys.length>8){out+=" || validate.schema"+$schemaPath+".hasOwnProperty("+$key+") "}else{var arr1=$schemaKeys;if(arr1){var $propertyKey,i1=-1,l1=arr1.length-1;while(i1<l1){$propertyKey=arr1[i1+=1];out+=" || "+$key+" == "+it.util.toQuotedString($propertyKey)+" "}}}}if($pPropertyKeys.length){var arr2=$pPropertyKeys;if(arr2){var $pProperty,$i=-1,l2=arr2.length-1;while($i<l2){$pProperty=arr2[$i+=1];out+=" || "+it.usePattern($pProperty)+".test("+$key+") "}}}out+=" ); if (isAdditional"+$lvl+") { "}if($removeAdditional=="all"){out+=" delete "+$data+"["+$key+"]; "}else{var $currentErrorPath=it.errorPath;var $additionalProperty="' + "+$key+" + '";if(it.opts._errorDataPathProperty){it.errorPath=it.util.getPathExpr(it.errorPath,$key,it.opts.jsonPointers)}if($noAdditional){if($removeAdditional){out+=" delete "+$data+"["+$key+"]; "}else{out+=" "+$nextValid+" = false; ";var $currErrSchemaPath=$errSchemaPath;$errSchemaPath=it.errSchemaPath+"/additionalProperties";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"additionalProperties"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { additionalProperty: '"+$additionalProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is an invalid additional property"}else{out+="should NOT have additional properties"}out+="' "}if(it.opts.verbose){out+=" , schema: false , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}$errSchemaPath=$currErrSchemaPath;if($breakOnError){out+=" break; "}}}else if($additionalIsSchema){if($removeAdditional=="failing"){out+=" var "+$errs+" = errors;  ";var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;$it.schema=$aProperties;$it.schemaPath=it.schemaPath+".additionalProperties";$it.errSchemaPath=it.errSchemaPath+"/additionalProperties";$it.errorPath=it.opts._errorDataPathProperty?it.errorPath:it.util.getPathExpr(it.errorPath,$key,it.opts.jsonPointers);var $passData=$data+"["+$key+"]";$it.dataPathArr[$dataNxt]=$key;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}out+=" if (!"+$nextValid+") { errors = "+$errs+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+$data+"["+$key+"]; }  ";it.compositeRule=$it.compositeRule=$wasComposite}else{$it.schema=$aProperties;$it.schemaPath=it.schemaPath+".additionalProperties";$it.errSchemaPath=it.errSchemaPath+"/additionalProperties";$it.errorPath=it.opts._errorDataPathProperty?it.errorPath:it.util.getPathExpr(it.errorPath,$key,it.opts.jsonPointers);var $passData=$data+"["+$key+"]";$it.dataPathArr[$dataNxt]=$key;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}if($breakOnError){out+=" if (!"+$nextValid+") break; "}}}it.errorPath=$currentErrorPath}if($someProperties){out+=" } "}out+=" }  ";if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}var $useDefaults=it.opts.useDefaults&&!it.compositeRule;if($schemaKeys.length){var arr3=$schemaKeys;if(arr3){var $propertyKey,i3=-1,l3=arr3.length-1;while(i3<l3){$propertyKey=arr3[i3+=1];var $sch=$schema[$propertyKey];if(it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)){var $prop=it.util.getProperty($propertyKey),$passData=$data+$prop,$hasDefault=$useDefaults&&$sch.default!==undefined;$it.schema=$sch;$it.schemaPath=$schemaPath+$prop;$it.errSchemaPath=$errSchemaPath+"/"+it.util.escapeFragment($propertyKey);$it.errorPath=it.util.getPath(it.errorPath,$propertyKey,it.opts.jsonPointers);$it.dataPathArr[$dataNxt]=it.util.toQuotedString($propertyKey);var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){$code=it.util.varReplace($code,$nextData,$passData);var $useData=$passData}else{var $useData=$nextData;out+=" var "+$nextData+" = "+$passData+"; "}if($hasDefault){out+=" "+$code+" "}else{if($requiredHash&&$requiredHash[$propertyKey]){out+=" if ( "+$useData+" === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=") { "+$nextValid+" = false; ";var $currentErrorPath=it.errorPath,$currErrSchemaPath=$errSchemaPath,$missingProperty=it.util.escapeQuotes($propertyKey);if(it.opts._errorDataPathProperty){it.errorPath=it.util.getPath($currentErrorPath,$propertyKey,it.opts.jsonPointers)}$errSchemaPath=it.errSchemaPath+"/required";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"required"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { missingProperty: '"+$missingProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is a required property"}else{out+="should have required property \\'"+$missingProperty+"\\'"}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}$errSchemaPath=$currErrSchemaPath;it.errorPath=$currentErrorPath;out+=" } else { "}else{if($breakOnError){out+=" if ( "+$useData+" === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=") { "+$nextValid+" = true; } else { "}else{out+=" if ("+$useData+" !== undefined ";if($ownProperties){out+=" &&   Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=" ) { "}}out+=" "+$code+" } "}}if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}}}if($pPropertyKeys.length){var arr4=$pPropertyKeys;if(arr4){var $pProperty,i4=-1,l4=arr4.length-1;while(i4<l4){$pProperty=arr4[i4+=1];var $sch=$pProperties[$pProperty];if(it.opts.strictKeywords?typeof $sch=="object"&&Object.keys($sch).length>0:it.util.schemaHasRules($sch,it.RULES.all)){$it.schema=$sch;$it.schemaPath=it.schemaPath+".patternProperties"+it.util.getProperty($pProperty);$it.errSchemaPath=it.errSchemaPath+"/patternProperties/"+it.util.escapeFragment($pProperty);if($ownProperties){out+=" "+$dataProperties+" = "+$dataProperties+" || Object.keys("+$data+"); for (var "+$idx+"=0; "+$idx+"<"+$dataProperties+".length; "+$idx+"++) { var "+$key+" = "+$dataProperties+"["+$idx+"]; "}else{out+=" for (var "+$key+" in "+$data+") { "}out+=" if ("+it.usePattern($pProperty)+".test("+$key+")) { ";$it.errorPath=it.util.getPathExpr(it.errorPath,$key,it.opts.jsonPointers);var $passData=$data+"["+$key+"]";$it.dataPathArr[$dataNxt]=$key;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}if($breakOnError){out+=" if (!"+$nextValid+") break; "}out+=" } ";if($breakOnError){out+=" else "+$nextValid+" = true; "}out+=" }  ";if($breakOnError){out+=" if ("+$nextValid+") { ";$closingBraces+="}"}}}}}if($breakOnError){out+=" "+$closingBraces+" if ("+$errs+" == errors) {"}out=it.util.cleanUpCode(out);return out}},{}],36:[function(require,module,exports){"use strict";module.exports=function generate_propertyNames(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $errs="errs__"+$lvl;var $it=it.util.copy(it);var $closingBraces="";$it.level++;var $nextValid="valid"+$it.level;out+="var "+$errs+" = errors;";if(it.opts.strictKeywords?typeof $schema=="object"&&Object.keys($schema).length>0:it.util.schemaHasRules($schema,it.RULES.all)){$it.schema=$schema;$it.schemaPath=$schemaPath;$it.errSchemaPath=$errSchemaPath;var $key="key"+$lvl,$idx="idx"+$lvl,$i="i"+$lvl,$invalidName="' + "+$key+" + '",$dataNxt=$it.dataLevel=it.dataLevel+1,$nextData="data"+$dataNxt,$dataProperties="dataProperties"+$lvl,$ownProperties=it.opts.ownProperties,$currentBaseId=it.baseId;if($ownProperties){out+=" var "+$dataProperties+" = undefined; "}if($ownProperties){out+=" "+$dataProperties+" = "+$dataProperties+" || Object.keys("+$data+"); for (var "+$idx+"=0; "+$idx+"<"+$dataProperties+".length; "+$idx+"++) { var "+$key+" = "+$dataProperties+"["+$idx+"]; "}else{out+=" for (var "+$key+" in "+$data+") { "}out+=" var startErrs"+$lvl+" = errors; ";var $passData=$key;var $wasComposite=it.compositeRule;it.compositeRule=$it.compositeRule=true;var $code=it.validate($it);$it.baseId=$currentBaseId;if(it.util.varOccurences($code,$nextData)<2){out+=" "+it.util.varReplace($code,$nextData,$passData)+" "}else{out+=" var "+$nextData+" = "+$passData+"; "+$code+" "}it.compositeRule=$it.compositeRule=$wasComposite;out+=" if (!"+$nextValid+") { for (var "+$i+"=startErrs"+$lvl+"; "+$i+"<errors; "+$i+"++) { vErrors["+$i+"].propertyName = "+$key+"; }   var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"propertyNames"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { propertyName: '"+$invalidName+"' } ";if(it.opts.messages!==false){out+=" , message: 'property name \\'"+$invalidName+"\\' is invalid' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(vErrors); "}else{out+=" validate.errors = vErrors; return false; "}}if($breakOnError){out+=" break; "}out+=" } }"}if($breakOnError){out+=" "+$closingBraces+" if ("+$errs+" == errors) {"}out=it.util.cleanUpCode(out);return out}},{}],37:[function(require,module,exports){"use strict";module.exports=function generate_ref(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $async,$refCode;if($schema=="#"||$schema=="#/"){if(it.isRoot){$async=it.async;$refCode="validate"}else{$async=it.root.schema.$async===true;$refCode="root.refVal[0]"}}else{var $refVal=it.resolveRef(it.baseId,$schema,it.isRoot);if($refVal===undefined){var $message=it.MissingRefError.message(it.baseId,$schema);if(it.opts.missingRefs=="fail"){it.logger.error($message);var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"$ref"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { ref: '"+it.util.escapeQuotes($schema)+"' } ";if(it.opts.messages!==false){out+=" , message: 'can\\'t resolve reference "+it.util.escapeQuotes($schema)+"' "}if(it.opts.verbose){out+=" , schema: "+it.util.toQuotedString($schema)+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}if($breakOnError){out+=" if (false) { "}}else if(it.opts.missingRefs=="ignore"){it.logger.warn($message);if($breakOnError){out+=" if (true) { "}}else{throw new it.MissingRefError(it.baseId,$schema,$message)}}else if($refVal.inline){var $it=it.util.copy(it);$it.level++;var $nextValid="valid"+$it.level;$it.schema=$refVal.schema;$it.schemaPath="";$it.errSchemaPath=$schema;var $code=it.validate($it).replace(/validate\.schema/g,$refVal.code);out+=" "+$code+" ";if($breakOnError){out+=" if ("+$nextValid+") { "}}else{$async=$refVal.$async===true||it.async&&$refVal.$async!==false;$refCode=$refVal.code}}if($refCode){var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.opts.passContext){out+=" "+$refCode+".call(this, "}else{out+=" "+$refCode+"( "}out+=" "+$data+", (dataPath || '')";if(it.errorPath!='""'){out+=" + "+it.errorPath}var $parentData=$dataLvl?"data"+($dataLvl-1||""):"parentData",$parentDataProperty=$dataLvl?it.dataPathArr[$dataLvl]:"parentDataProperty";out+=" , "+$parentData+" , "+$parentDataProperty+", rootData)  ";var __callValidate=out;out=$$outStack.pop();if($async){if(!it.async)throw new Error("async schema referenced by sync schema");if($breakOnError){out+=" var "+$valid+"; "}out+=" try { await "+__callValidate+"; ";if($breakOnError){out+=" "+$valid+" = true; "}out+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ";if($breakOnError){out+=" "+$valid+" = false; "}out+=" } ";if($breakOnError){out+=" if ("+$valid+") { "}}else{out+=" if (!"+__callValidate+") { if (vErrors === null) vErrors = "+$refCode+".errors; else vErrors = vErrors.concat("+$refCode+".errors); errors = vErrors.length; } ";if($breakOnError){out+=" else { "}}}return out}},{}],38:[function(require,module,exports){"use strict";module.exports=function generate_required(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}var $vSchema="schema"+$lvl;if(!$isData){if($schema.length<it.opts.loopRequired&&it.schema.properties&&Object.keys(it.schema.properties).length){var $required=[];var arr1=$schema;if(arr1){var $property,i1=-1,l1=arr1.length-1;while(i1<l1){$property=arr1[i1+=1];var $propertySch=it.schema.properties[$property];if(!($propertySch&&(it.opts.strictKeywords?typeof $propertySch=="object"&&Object.keys($propertySch).length>0:it.util.schemaHasRules($propertySch,it.RULES.all)))){$required[$required.length]=$property}}}}else{var $required=$schema}}if($isData||$required.length){var $currentErrorPath=it.errorPath,$loopRequired=$isData||$required.length>=it.opts.loopRequired,$ownProperties=it.opts.ownProperties;if($breakOnError){out+=" var missing"+$lvl+"; ";if($loopRequired){if(!$isData){out+=" var "+$vSchema+" = validate.schema"+$schemaPath+"; "}var $i="i"+$lvl,$propertyPath="schema"+$lvl+"["+$i+"]",$missingProperty="' + "+$propertyPath+" + '";if(it.opts._errorDataPathProperty){it.errorPath=it.util.getPathExpr($currentErrorPath,$propertyPath,it.opts.jsonPointers)}out+=" var "+$valid+" = true; ";if($isData){out+=" if (schema"+$lvl+" === undefined) "+$valid+" = true; else if (!Array.isArray(schema"+$lvl+")) "+$valid+" = false; else {"}out+=" for (var "+$i+" = 0; "+$i+" < "+$vSchema+".length; "+$i+"++) { "+$valid+" = "+$data+"["+$vSchema+"["+$i+"]] !== undefined ";if($ownProperties){out+=" &&   Object.prototype.hasOwnProperty.call("+$data+", "+$vSchema+"["+$i+"]) "}out+="; if (!"+$valid+") break; } ";if($isData){out+="  }  "}out+="  if (!"+$valid+") {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"required"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { missingProperty: '"+$missingProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is a required property"}else{out+="should have required property \\'"+$missingProperty+"\\'"}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } else { "}else{out+=" if ( ";var arr2=$required;if(arr2){var $propertyKey,$i=-1,l2=arr2.length-1;while($i<l2){$propertyKey=arr2[$i+=1];if($i){out+=" || "}var $prop=it.util.getProperty($propertyKey),$useData=$data+$prop;out+=" ( ( "+$useData+" === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=") && (missing"+$lvl+" = "+it.util.toQuotedString(it.opts.jsonPointers?$propertyKey:$prop)+") ) "}}out+=") {  ";var $propertyPath="missing"+$lvl,$missingProperty="' + "+$propertyPath+" + '";if(it.opts._errorDataPathProperty){it.errorPath=it.opts.jsonPointers?it.util.getPathExpr($currentErrorPath,$propertyPath,true):$currentErrorPath+" + "+$propertyPath}var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"required"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { missingProperty: '"+$missingProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is a required property"}else{out+="should have required property \\'"+$missingProperty+"\\'"}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } else { "}}else{if($loopRequired){if(!$isData){out+=" var "+$vSchema+" = validate.schema"+$schemaPath+"; "}var $i="i"+$lvl,$propertyPath="schema"+$lvl+"["+$i+"]",$missingProperty="' + "+$propertyPath+" + '";if(it.opts._errorDataPathProperty){it.errorPath=it.util.getPathExpr($currentErrorPath,$propertyPath,it.opts.jsonPointers)}if($isData){out+=" if ("+$vSchema+" && !Array.isArray("+$vSchema+")) {  var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"required"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { missingProperty: '"+$missingProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is a required property"}else{out+="should have required property \\'"+$missingProperty+"\\'"}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+$vSchema+" !== undefined) { "}out+=" for (var "+$i+" = 0; "+$i+" < "+$vSchema+".length; "+$i+"++) { if ("+$data+"["+$vSchema+"["+$i+"]] === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", "+$vSchema+"["+$i+"]) "}out+=") {  var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"required"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { missingProperty: '"+$missingProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is a required property"}else{out+="should have required property \\'"+$missingProperty+"\\'"}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ";if($isData){out+="  }  "}}else{var arr3=$required;if(arr3){var $propertyKey,i3=-1,l3=arr3.length-1;while(i3<l3){$propertyKey=arr3[i3+=1];var $prop=it.util.getProperty($propertyKey),$missingProperty=it.util.escapeQuotes($propertyKey),$useData=$data+$prop;if(it.opts._errorDataPathProperty){it.errorPath=it.util.getPath($currentErrorPath,$propertyKey,it.opts.jsonPointers)}out+=" if ( "+$useData+" === undefined ";if($ownProperties){out+=" || ! Object.prototype.hasOwnProperty.call("+$data+", '"+it.util.escapeQuotes($propertyKey)+"') "}out+=") {  var err =   ";if(it.createErrors!==false){out+=" { keyword: '"+"required"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { missingProperty: '"+$missingProperty+"' } ";if(it.opts.messages!==false){out+=" , message: '";if(it.opts._errorDataPathProperty){out+="is a required property"}else{out+="should have required property \\'"+$missingProperty+"\\'"}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}out+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}}}it.errorPath=$currentErrorPath}else if($breakOnError){out+=" if (true) {"}return out}},{}],39:[function(require,module,exports){"use strict";module.exports=function generate_uniqueItems(it,$keyword,$ruleType){var out=" ";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;var $isData=it.opts.$data&&$schema&&$schema.$data,$schemaValue;if($isData){out+=" var schema"+$lvl+" = "+it.util.getData($schema.$data,$dataLvl,it.dataPathArr)+"; ";$schemaValue="schema"+$lvl}else{$schemaValue=$schema}if(($schema||$isData)&&it.opts.uniqueItems!==false){if($isData){out+=" var "+$valid+"; if ("+$schemaValue+" === false || "+$schemaValue+" === undefined) "+$valid+" = true; else if (typeof "+$schemaValue+" != 'boolean') "+$valid+" = false; else { "}out+=" var i = "+$data+".length , "+$valid+" = true , j; if (i > 1) { ";var $itemType=it.schema.items&&it.schema.items.type,$typeIsArray=Array.isArray($itemType);if(!$itemType||$itemType=="object"||$itemType=="array"||$typeIsArray&&($itemType.indexOf("object")>=0||$itemType.indexOf("array")>=0)){out+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+$data+"[i], "+$data+"[j])) { "+$valid+" = false; break outer; } } } "}else{out+=" var itemIndices = {}, item; for (;i--;) { var item = "+$data+"[i]; ";var $method="checkDataType"+($typeIsArray?"s":"");out+=" if ("+it.util[$method]($itemType,"item",true)+") continue; ";if($typeIsArray){out+=" if (typeof item == 'string') item = '\"' + item; "}out+=" if (typeof itemIndices[item] == 'number') { "+$valid+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}out+=" } ";if($isData){out+="  }  "}out+=" if (!"+$valid+") {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+"uniqueItems"+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { i: i, j: j } ";if(it.opts.messages!==false){out+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "}if(it.opts.verbose){out+=" , schema:  ";if($isData){out+="validate.schema"+$schemaPath}else{out+=""+$schema}out+="         , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } ";if($breakOnError){out+=" else { "}}else{if($breakOnError){out+=" if (true) { "}}return out}},{}],40:[function(require,module,exports){"use strict";module.exports=function generate_validate(it,$keyword,$ruleType){var out="";var $async=it.schema.$async===true,$refKeywords=it.util.schemaHasRulesExcept(it.schema,it.RULES.all,"$ref"),$id=it.self._getId(it.schema);if(it.opts.strictKeywords){var $unknownKwd=it.util.schemaUnknownRules(it.schema,it.RULES.keywords);if($unknownKwd){var $keywordsMsg="unknown keyword: "+$unknownKwd;if(it.opts.strictKeywords==="log")it.logger.warn($keywordsMsg);else throw new Error($keywordsMsg)}}if(it.isTop){out+=" var validate = ";if($async){it.async=true;out+="async "}out+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ";if($id&&(it.opts.sourceCode||it.opts.processCode)){out+=" "+("/*# sourceURL="+$id+" */")+" "}}if(typeof it.schema=="boolean"||!($refKeywords||it.schema.$ref)){var $keyword="false schema";var $lvl=it.level;var $dataLvl=it.dataLevel;var $schema=it.schema[$keyword];var $schemaPath=it.schemaPath+it.util.getProperty($keyword);var $errSchemaPath=it.errSchemaPath+"/"+$keyword;var $breakOnError=!it.opts.allErrors;var $errorKeyword;var $data="data"+($dataLvl||"");var $valid="valid"+$lvl;if(it.schema===false){if(it.isTop){$breakOnError=true}else{out+=" var "+$valid+" = false; "}var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"false schema")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: {} ";if(it.opts.messages!==false){out+=" , message: 'boolean schema is false' "}if(it.opts.verbose){out+=" , schema: false , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}}else{if(it.isTop){if($async){out+=" return data; "}else{out+=" validate.errors = null; return true; "}}else{out+=" var "+$valid+" = true; "}}if(it.isTop){out+=" }; return validate; "}return out}if(it.isTop){var $top=it.isTop,$lvl=it.level=0,$dataLvl=it.dataLevel=0,$data="data";it.rootId=it.resolve.fullPath(it.self._getId(it.root.schema));it.baseId=it.baseId||it.rootId;delete it.isTop;it.dataPathArr=[undefined];if(it.schema.default!==undefined&&it.opts.useDefaults&&it.opts.strictDefaults){var $defaultMsg="default is ignored in the schema root";if(it.opts.strictDefaults==="log")it.logger.warn($defaultMsg);else throw new Error($defaultMsg)}out+=" var vErrors = null; ";out+=" var errors = 0;     ";out+=" if (rootData === undefined) rootData = data; "}else{var $lvl=it.level,$dataLvl=it.dataLevel,$data="data"+($dataLvl||"");if($id)it.baseId=it.resolve.url(it.baseId,$id);if($async&&!it.async)throw new Error("async schema in sync schema");out+=" var errs_"+$lvl+" = errors;"}var $valid="valid"+$lvl,$breakOnError=!it.opts.allErrors,$closingBraces1="",$closingBraces2="";var $errorKeyword;var $typeSchema=it.schema.type,$typeIsArray=Array.isArray($typeSchema);if($typeSchema&&it.opts.nullable&&it.schema.nullable===true){if($typeIsArray){if($typeSchema.indexOf("null")==-1)$typeSchema=$typeSchema.concat("null")}else if($typeSchema!="null"){$typeSchema=[$typeSchema,"null"];$typeIsArray=true}}if($typeIsArray&&$typeSchema.length==1){$typeSchema=$typeSchema[0];$typeIsArray=false}if(it.schema.$ref&&$refKeywords){if(it.opts.extendRefs=="fail"){throw new Error('$ref: validation keywords used in schema at path "'+it.errSchemaPath+'" (see option extendRefs)')}else if(it.opts.extendRefs!==true){$refKeywords=false;it.logger.warn('$ref: keywords ignored in schema at path "'+it.errSchemaPath+'"')}}if(it.schema.$comment&&it.opts.$comment){out+=" "+it.RULES.all.$comment.code(it,"$comment")}if($typeSchema){if(it.opts.coerceTypes){var $coerceToTypes=it.util.coerceToTypes(it.opts.coerceTypes,$typeSchema)}var $rulesGroup=it.RULES.types[$typeSchema];if($coerceToTypes||$typeIsArray||$rulesGroup===true||$rulesGroup&&!$shouldUseGroup($rulesGroup)){var $schemaPath=it.schemaPath+".type",$errSchemaPath=it.errSchemaPath+"/type";var $schemaPath=it.schemaPath+".type",$errSchemaPath=it.errSchemaPath+"/type",$method=$typeIsArray?"checkDataTypes":"checkDataType";out+=" if ("+it.util[$method]($typeSchema,$data,true)+") { ";if($coerceToTypes){var $dataType="dataType"+$lvl,$coerced="coerced"+$lvl;out+=" var "+$dataType+" = typeof "+$data+"; ";if(it.opts.coerceTypes=="array"){out+=" if ("+$dataType+" == 'object' && Array.isArray("+$data+")) "+$dataType+" = 'array'; "}out+=" var "+$coerced+" = undefined; ";var $bracesCoercion="";var arr1=$coerceToTypes;if(arr1){var $type,$i=-1,l1=arr1.length-1;while($i<l1){$type=arr1[$i+=1];if($i){out+=" if ("+$coerced+" === undefined) { ";$bracesCoercion+="}"}if(it.opts.coerceTypes=="array"&&$type!="array"){out+=" if ("+$dataType+" == 'array' && "+$data+".length == 1) { "+$coerced+" = "+$data+" = "+$data+"[0]; "+$dataType+" = typeof "+$data+";  } "}if($type=="string"){out+=" if ("+$dataType+" == 'number' || "+$dataType+" == 'boolean') "+$coerced+" = '' + "+$data+"; else if ("+$data+" === null) "+$coerced+" = ''; "}else if($type=="number"||$type=="integer"){out+=" if ("+$dataType+" == 'boolean' || "+$data+" === null || ("+$dataType+" == 'string' && "+$data+" && "+$data+" == +"+$data+" ";if($type=="integer"){out+=" && !("+$data+" % 1)"}out+=")) "+$coerced+" = +"+$data+"; "}else if($type=="boolean"){out+=" if ("+$data+" === 'false' || "+$data+" === 0 || "+$data+" === null) "+$coerced+" = false; else if ("+$data+" === 'true' || "+$data+" === 1) "+$coerced+" = true; "}else if($type=="null"){out+=" if ("+$data+" === '' || "+$data+" === 0 || "+$data+" === false) "+$coerced+" = null; "}else if(it.opts.coerceTypes=="array"&&$type=="array"){out+=" if ("+$dataType+" == 'string' || "+$dataType+" == 'number' || "+$dataType+" == 'boolean' || "+$data+" == null) "+$coerced+" = ["+$data+"]; "}}}out+=" "+$bracesCoercion+" if ("+$coerced+" === undefined) {   ";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"type")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { type: '";if($typeIsArray){out+=""+$typeSchema.join(",")}else{out+=""+$typeSchema}out+="' } ";if(it.opts.messages!==false){out+=" , message: 'should be ";if($typeIsArray){out+=""+$typeSchema.join(",")}else{out+=""+$typeSchema}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } else {  ";var $parentData=$dataLvl?"data"+($dataLvl-1||""):"parentData",$parentDataProperty=$dataLvl?it.dataPathArr[$dataLvl]:"parentDataProperty";out+=" "+$data+" = "+$coerced+"; ";if(!$dataLvl){out+="if ("+$parentData+" !== undefined)"}out+=" "+$parentData+"["+$parentDataProperty+"] = "+$coerced+"; } "}else{var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"type")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { type: '";if($typeIsArray){out+=""+$typeSchema.join(",")}else{out+=""+$typeSchema}out+="' } ";if(it.opts.messages!==false){out+=" , message: 'should be ";if($typeIsArray){out+=""+$typeSchema.join(",")}else{out+=""+$typeSchema}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}}out+=" } "}}if(it.schema.$ref&&!$refKeywords){out+=" "+it.RULES.all.$ref.code(it,"$ref")+" ";if($breakOnError){out+=" } if (errors === ";if($top){out+="0"}else{out+="errs_"+$lvl}out+=") { ";$closingBraces2+="}"}}else{var arr2=it.RULES;if(arr2){var $rulesGroup,i2=-1,l2=arr2.length-1;while(i2<l2){$rulesGroup=arr2[i2+=1];if($shouldUseGroup($rulesGroup)){if($rulesGroup.type){out+=" if ("+it.util.checkDataType($rulesGroup.type,$data)+") { "}if(it.opts.useDefaults){if($rulesGroup.type=="object"&&it.schema.properties){var $schema=it.schema.properties,$schemaKeys=Object.keys($schema);var arr3=$schemaKeys;if(arr3){var $propertyKey,i3=-1,l3=arr3.length-1;while(i3<l3){$propertyKey=arr3[i3+=1];var $sch=$schema[$propertyKey];if($sch.default!==undefined){var $passData=$data+it.util.getProperty($propertyKey);if(it.compositeRule){if(it.opts.strictDefaults){var $defaultMsg="default is ignored for: "+$passData;if(it.opts.strictDefaults==="log")it.logger.warn($defaultMsg);else throw new Error($defaultMsg)}}else{out+=" if ("+$passData+" === undefined ";if(it.opts.useDefaults=="empty"){out+=" || "+$passData+" === null || "+$passData+" === '' "}out+=" ) "+$passData+" = ";if(it.opts.useDefaults=="shared"){out+=" "+it.useDefault($sch.default)+" "}else{out+=" "+JSON.stringify($sch.default)+" "}out+="; "}}}}}else if($rulesGroup.type=="array"&&Array.isArray(it.schema.items)){var arr4=it.schema.items;if(arr4){var $sch,$i=-1,l4=arr4.length-1;while($i<l4){$sch=arr4[$i+=1];if($sch.default!==undefined){var $passData=$data+"["+$i+"]";if(it.compositeRule){if(it.opts.strictDefaults){var $defaultMsg="default is ignored for: "+$passData;if(it.opts.strictDefaults==="log")it.logger.warn($defaultMsg);else throw new Error($defaultMsg)}}else{out+=" if ("+$passData+" === undefined ";if(it.opts.useDefaults=="empty"){out+=" || "+$passData+" === null || "+$passData+" === '' "}out+=" ) "+$passData+" = ";if(it.opts.useDefaults=="shared"){out+=" "+it.useDefault($sch.default)+" "}else{out+=" "+JSON.stringify($sch.default)+" "}out+="; "}}}}}}var arr5=$rulesGroup.rules;if(arr5){var $rule,i5=-1,l5=arr5.length-1;while(i5<l5){$rule=arr5[i5+=1];if($shouldUseRule($rule)){var $code=$rule.code(it,$rule.keyword,$rulesGroup.type);if($code){out+=" "+$code+" ";if($breakOnError){$closingBraces1+="}"}}}}}if($breakOnError){out+=" "+$closingBraces1+" ";$closingBraces1=""}if($rulesGroup.type){out+=" } ";if($typeSchema&&$typeSchema===$rulesGroup.type&&!$coerceToTypes){out+=" else { ";var $schemaPath=it.schemaPath+".type",$errSchemaPath=it.errSchemaPath+"/type";var $$outStack=$$outStack||[];$$outStack.push(out);out="";if(it.createErrors!==false){out+=" { keyword: '"+($errorKeyword||"type")+"' , dataPath: (dataPath || '') + "+it.errorPath+" , schemaPath: "+it.util.toQuotedString($errSchemaPath)+" , params: { type: '";if($typeIsArray){out+=""+$typeSchema.join(",")}else{out+=""+$typeSchema}out+="' } ";if(it.opts.messages!==false){out+=" , message: 'should be ";if($typeIsArray){out+=""+$typeSchema.join(",")}else{out+=""+$typeSchema}out+="' "}if(it.opts.verbose){out+=" , schema: validate.schema"+$schemaPath+" , parentSchema: validate.schema"+it.schemaPath+" , data: "+$data+" "}out+=" } "}else{out+=" {} "}var __err=out;out=$$outStack.pop();if(!it.compositeRule&&$breakOnError){if(it.async){out+=" throw new ValidationError(["+__err+"]); "}else{out+=" validate.errors = ["+__err+"]; return false; "}}else{out+=" var err = "+__err+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}out+=" } "}}if($breakOnError){out+=" if (errors === ";if($top){out+="0"}else{out+="errs_"+$lvl}out+=") { ";$closingBraces2+="}"}}}}}if($breakOnError){out+=" "+$closingBraces2+" "}if($top){if($async){out+=" if (errors === 0) return data;           ";out+=" else throw new ValidationError(vErrors); "}else{out+=" validate.errors = vErrors; ";out+=" return errors === 0;       "}out+=" }; return validate;"}else{out+=" var "+$valid+" = errors === errs_"+$lvl+";"}out=it.util.cleanUpCode(out);if($top){out=it.util.finalCleanUpCode(out,$async)}function $shouldUseGroup($rulesGroup){var rules=$rulesGroup.rules;for(var i=0;i<rules.length;i++)if($shouldUseRule(rules[i]))return true}function $shouldUseRule($rule){return it.schema[$rule.keyword]!==undefined||$rule.implements&&$ruleImplementsSomeKeyword($rule)}function $ruleImplementsSomeKeyword($rule){var impl=$rule.implements;for(var i=0;i<impl.length;i++)if(it.schema[impl[i]]!==undefined)return true}return out}},{}],41:[function(require,module,exports){"use strict";var IDENTIFIER=/^[a-z_$][a-z0-9_$-]*$/i;var customRuleCode=require("./dotjs/custom");var definitionSchema=require("./definition_schema");module.exports={add:addKeyword,get:getKeyword,remove:removeKeyword,validate:validateKeyword};function addKeyword(keyword,definition){var RULES=this.RULES;if(RULES.keywords[keyword])throw new Error("Keyword "+keyword+" is already defined");if(!IDENTIFIER.test(keyword))throw new Error("Keyword "+keyword+" is not a valid identifier");if(definition){this.validateKeyword(definition,true);var dataType=definition.type;if(Array.isArray(dataType)){for(var i=0;i<dataType.length;i++)_addRule(keyword,dataType[i],definition)}else{_addRule(keyword,dataType,definition)}var metaSchema=definition.metaSchema;if(metaSchema){if(definition.$data&&this._opts.$data){metaSchema={anyOf:[metaSchema,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}}definition.validateSchema=this.compile(metaSchema,true)}}RULES.keywords[keyword]=RULES.all[keyword]=true;function _addRule(keyword,dataType,definition){var ruleGroup;for(var i=0;i<RULES.length;i++){var rg=RULES[i];if(rg.type==dataType){ruleGroup=rg;break}}if(!ruleGroup){ruleGroup={type:dataType,rules:[]};RULES.push(ruleGroup)}var rule={keyword:keyword,definition:definition,custom:true,code:customRuleCode,implements:definition.implements};ruleGroup.rules.push(rule);RULES.custom[keyword]=rule}return this}function getKeyword(keyword){var rule=this.RULES.custom[keyword];return rule?rule.definition:this.RULES.keywords[keyword]||false}function removeKeyword(keyword){var RULES=this.RULES;delete RULES.keywords[keyword];delete RULES.all[keyword];delete RULES.custom[keyword];for(var i=0;i<RULES.length;i++){var rules=RULES[i].rules;for(var j=0;j<rules.length;j++){if(rules[j].keyword==keyword){rules.splice(j,1);break}}}return this}function validateKeyword(definition,throwError){validateKeyword.errors=null;var v=this._validateKeyword=this._validateKeyword||this.compile(definitionSchema,true);if(v(definition))return true;validateKeyword.errors=v.errors;if(throwError)throw new Error("custom keyword definition is invalid: "+this.errorsText(v.errors));else return false}},{"./definition_schema":14,"./dotjs/custom":24}],42:[function(require,module,exports){module.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:false}},{}],43:[function(require,module,exports){module.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:true,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:true,readOnly:{type:"boolean",default:false},examples:{type:"array",items:true},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:true},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:false},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:true,enum:{type:"array",items:true,minItems:1,uniqueItems:true},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:true}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:true}},{}],44:[function(require,module,exports){},{}],45:[function(require,module,exports){"use strict";module.exports=function(object){return serialize(object);function serialize(object){if(object===null||typeof object!=="object"||object.toJSON!=null){return JSON.stringify(object)}if(Array.isArray(object)&&object.length===0){return"[]"}if(Array.isArray(object)&&object.length===1){return"["+serialize(object[0])+"]"}if(Array.isArray(object)){return"["+object.reduce((t,cv,ci)=>{t=ci===1?serialize(t):t;return t+","+serialize(cv)})+"]"}const keys=Object.keys(object);if(keys.length===0){return"{}"}if(keys.length===1){return"{"+serialize(keys[0])+":"+serialize(object[keys[0]])+"}"}return"{"+keys.sort().reduce((t,cv,ci)=>{t=ci===1?serialize(t)+":"+serialize(object[t]):t;return t+","+serialize(cv)+":"+serialize(object[cv])})+"}"}}},{}],46:[function(require,module,exports){"use strict";module.exports=function equal(a,b){if(a===b)return true;if(a&&b&&typeof a=="object"&&typeof b=="object"){if(a.constructor!==b.constructor)return false;var length,i,keys;if(Array.isArray(a)){length=a.length;if(length!=b.length)return false;for(i=length;i--!==0;)if(!equal(a[i],b[i]))return false;return true}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();keys=Object.keys(a);length=keys.length;if(length!==Object.keys(b).length)return false;for(i=length;i--!==0;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return false;for(i=length;i--!==0;){var key=keys[i];if(!equal(a[key],b[key]))return false}return true}return a!==a&&b!==b}},{}],47:[function(require,module,exports){"use strict";module.exports=function(data,opts){if(!opts)opts={};if(typeof opts==="function")opts={cmp:opts};var cycles=typeof opts.cycles==="boolean"?opts.cycles:false;var cmp=opts.cmp&&function(f){return function(node){return function(a,b){var aobj={key:a,value:node[a]};var bobj={key:b,value:node[b]};return f(aobj,bobj)}}}(opts.cmp);var seen=[];return function stringify(node){if(node&&node.toJSON&&typeof node.toJSON==="function"){node=node.toJSON()}if(node===undefined)return;if(typeof node=="number")return isFinite(node)?""+node:"null";if(typeof node!=="object")return JSON.stringify(node);var i,out;if(Array.isArray(node)){out="[";for(i=0;i<node.length;i++){if(i)out+=",";out+=stringify(node[i])||"null"}return out+"]"}if(node===null)return"null";if(seen.indexOf(node)!==-1){if(cycles)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var seenIndex=seen.push(node)-1;var keys=Object.keys(node).sort(cmp&&cmp(node));out="";for(i=0;i<keys.length;i++){var key=keys[i];var value=stringify(node[key]);if(!value)continue;if(out)out+=",";out+=JSON.stringify(key)+":"+value}seen.splice(seenIndex,1);return"{"+out+"}"}(data)}},{}],48:[function(require,module,exports){"use strict";var traverse=module.exports=function(schema,opts,cb){if(typeof opts=="function"){cb=opts;opts={}}cb=opts.cb||cb;var pre=typeof cb=="function"?cb:cb.pre||function(){};var post=cb.post||function(){};_traverse(opts,pre,post,schema,"",schema)};traverse.keywords={additionalItems:true,items:true,contains:true,additionalProperties:true,propertyNames:true,not:true};traverse.arrayKeywords={items:true,allOf:true,anyOf:true,oneOf:true};traverse.propsKeywords={definitions:true,properties:true,patternProperties:true,dependencies:true};traverse.skipKeywords={default:true,enum:true,const:true,required:true,maximum:true,minimum:true,exclusiveMaximum:true,exclusiveMinimum:true,multipleOf:true,maxLength:true,minLength:true,pattern:true,format:true,maxItems:true,minItems:true,uniqueItems:true,maxProperties:true,minProperties:true};function _traverse(opts,pre,post,schema,jsonPtr,rootSchema,parentJsonPtr,parentKeyword,parentSchema,keyIndex){if(schema&&typeof schema=="object"&&!Array.isArray(schema)){pre(schema,jsonPtr,rootSchema,parentJsonPtr,parentKeyword,parentSchema,keyIndex);for(var key in schema){var sch=schema[key];if(Array.isArray(sch)){if(key in traverse.arrayKeywords){for(var i=0;i<sch.length;i++)_traverse(opts,pre,post,sch[i],jsonPtr+"/"+key+"/"+i,rootSchema,jsonPtr,key,schema,i)}}else if(key in traverse.propsKeywords){if(sch&&typeof sch=="object"){for(var prop in sch)_traverse(opts,pre,post,sch[prop],jsonPtr+"/"+key+"/"+escapeJsonPtr(prop),rootSchema,jsonPtr,key,schema,prop)}}else if(key in traverse.keywords||opts.allKeys&&!(key in traverse.skipKeywords)){_traverse(opts,pre,post,sch,jsonPtr+"/"+key,rootSchema,jsonPtr,key,schema)}}post(schema,jsonPtr,rootSchema,parentJsonPtr,parentKeyword,parentSchema,keyIndex)}}function escapeJsonPtr(str){return str.replace(/~/g,"~0").replace(/\//g,"~1")}},{}],49:[function(require,module,exports){"use strict";const{isArray:_isArray,isObject:_isObject,isString:_isString}=require("./types");const{asArray:_asArray}=require("./util");const{prependBase:prependBase}=require("./url");const JsonLdError=require("./JsonLdError");const ResolvedContext=require("./ResolvedContext");const MAX_CONTEXT_URLS=10;module.exports=class ContextResolver{constructor({sharedCache:sharedCache}){this.perOpCache=new Map;this.sharedCache=sharedCache}async resolve({activeCtx:activeCtx,context:context,documentLoader:documentLoader,base:base,cycles:cycles=new Set}){if(context&&_isObject(context)&&context["@context"]){context=context["@context"]}context=_asArray(context);const allResolved=[];for(const ctx of context){if(_isString(ctx)){let resolved=this._get(ctx);if(!resolved){resolved=await this._resolveRemoteContext({activeCtx:activeCtx,url:ctx,documentLoader:documentLoader,base:base,cycles:cycles})}if(_isArray(resolved)){allResolved.push(...resolved)}else{allResolved.push(resolved)}continue}if(ctx===null){allResolved.push(new ResolvedContext({document:null}));continue}if(!_isObject(ctx)){_throwInvalidLocalContext(context)}const key=JSON.stringify(ctx);let resolved=this._get(key);if(!resolved){resolved=new ResolvedContext({document:ctx});this._cacheResolvedContext({key:key,resolved:resolved,tag:"static"})}allResolved.push(resolved)}return allResolved}_get(key){let resolved=this.perOpCache.get(key);if(!resolved){const tagMap=this.sharedCache.get(key);if(tagMap){resolved=tagMap.get("static");if(resolved){this.perOpCache.set(key,resolved)}}}return resolved}_cacheResolvedContext({key:key,resolved:resolved,tag:tag}){this.perOpCache.set(key,resolved);if(tag!==undefined){let tagMap=this.sharedCache.get(key);if(!tagMap){tagMap=new Map;this.sharedCache.set(key,tagMap)}tagMap.set(tag,resolved)}return resolved}async _resolveRemoteContext({activeCtx:activeCtx,url:url,documentLoader:documentLoader,base:base,cycles:cycles}){url=prependBase(base,url);const{context:context,remoteDoc:remoteDoc}=await this._fetchContext({activeCtx:activeCtx,url:url,documentLoader:documentLoader,cycles:cycles});base=remoteDoc.documentUrl||url;_resolveContextUrls({context:context,base:base});const resolved=await this.resolve({activeCtx:activeCtx,context:context,documentLoader:documentLoader,base:base,cycles:cycles});this._cacheResolvedContext({key:url,resolved:resolved,tag:remoteDoc.tag});return resolved}async _fetchContext({activeCtx:activeCtx,url:url,documentLoader:documentLoader,cycles:cycles}){if(cycles.size>MAX_CONTEXT_URLS){throw new JsonLdError("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:activeCtx.processingMode==="json-ld-1.0"?"loading remote context failed":"context overflow",max:MAX_CONTEXT_URLS})}if(cycles.has(url)){throw new JsonLdError("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:activeCtx.processingMode==="json-ld-1.0"?"recursive context inclusion":"context overflow",url:url})}cycles.add(url);let context;let remoteDoc;try{remoteDoc=await documentLoader(url);context=remoteDoc.document||null;if(_isString(context)){context=JSON.parse(context)}}catch(e){throw new JsonLdError("Dereferencing a URL did not result in a valid JSON-LD object. "+"Possible causes are an inaccessible URL perhaps due to "+"a same-origin policy (ensure the server uses CORS if you are "+"using client-side JavaScript), too many redirects, a "+"non-JSON response, or more than one HTTP Link Header was "+"provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:url,cause:e})}if(!_isObject(context)){throw new JsonLdError("Dereferencing a URL did not result in a JSON object. The "+"response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:url})}if(!("@context"in context)){context={"@context":{}}}else{context={"@context":context["@context"]}}if(remoteDoc.contextUrl){if(!_isArray(context["@context"])){context["@context"]=[context["@context"]]}context["@context"].push(remoteDoc.contextUrl)}return{context:context,remoteDoc:remoteDoc}}};function _throwInvalidLocalContext(ctx){throw new JsonLdError("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:ctx})}function _resolveContextUrls({context:context,base:base}){if(!context){return}const ctx=context["@context"];if(_isString(ctx)){context["@context"]=prependBase(base,ctx);return}if(_isArray(ctx)){for(let i=0;i<ctx.length;++i){const element=ctx[i];if(_isString(element)){ctx[i]=prependBase(base,element);continue}if(_isObject(element)){_resolveContextUrls({context:{"@context":element},base:base})}}return}if(!_isObject(ctx)){return}for(const term in ctx){_resolveContextUrls({context:ctx[term],base:base})}}},{"./JsonLdError":50,"./ResolvedContext":55,"./types":69,"./url":70,"./util":71}],50:[function(require,module,exports){"use strict";module.exports=class JsonLdError extends Error{constructor(message="An unspecified JSON-LD error occurred.",name="jsonld.Error",details={}){super(message);this.name=name;this.message=message;this.details=details}}},{}],51:[function(require,module,exports){"use strict";module.exports=jsonld=>{class JsonLdProcessor{toString(){return"[object JsonLdProcessor]"}}Object.defineProperty(JsonLdProcessor,"prototype",{writable:false,enumerable:false});Object.defineProperty(JsonLdProcessor.prototype,"constructor",{writable:true,enumerable:false,configurable:true,value:JsonLdProcessor});JsonLdProcessor.compact=function(input,ctx){if(arguments.length<2){return Promise.reject(new TypeError("Could not compact, too few arguments."))}return jsonld.compact(input,ctx)};JsonLdProcessor.expand=function(input){if(arguments.length<1){return Promise.reject(new TypeError("Could not expand, too few arguments."))}return jsonld.expand(input)};JsonLdProcessor.flatten=function(input){if(arguments.length<1){return Promise.reject(new TypeError("Could not flatten, too few arguments."))}return jsonld.flatten(input)};return JsonLdProcessor}},{}],52:[function(require,module,exports){"use strict";module.exports=require("rdf-canonize").NQuads},{"rdf-canonize":89}],53:[function(require,module,exports){"use strict";const{RDF_LANGSTRING:RDF_LANGSTRING,RDF_PLAIN_LITERAL:RDF_PLAIN_LITERAL,RDF_OBJECT:RDF_OBJECT,RDF_XML_LITERAL:RDF_XML_LITERAL,XSD_STRING:XSD_STRING}=require("./constants");let _Node;if(typeof Node!=="undefined"){_Node=Node}else{_Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}module.exports=class Rdfa{parse(data){const dataset={};dataset["@default"]=[];const subjects=data.getSubjects();for(let si=0;si<subjects.length;++si){const subject=subjects[si];if(subject===null){continue}const triples=data.getSubjectTriples(subject);if(triples===null){continue}const predicates=triples.predicates;for(const predicate in predicates){const objects=predicates[predicate].objects;for(let oi=0;oi<objects.length;++oi){const object=objects[oi];const triple={};if(subject.indexOf("_:")===0){triple.subject={type:"blank node",value:subject}}else{triple.subject={type:"IRI",value:subject}}if(predicate.indexOf("_:")===0){triple.predicate={type:"blank node",value:predicate}}else{triple.predicate={type:"IRI",value:predicate}}let value=object.value;if(object.type===RDF_XML_LITERAL){const XMLSerializer=getXMLSerializerClass();const serializer=new XMLSerializer;value="";for(let x=0;x<object.value.length;x++){if(object.value[x].nodeType===_Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType===_Node.TEXT_NODE){value+=object.value[x].nodeValue}}}triple.object={};if(object.type===RDF_OBJECT){if(object.value.indexOf("_:")===0){triple.object.type="blank node"}else{triple.object.type="IRI"}}else{triple.object.type="literal";if(object.type===RDF_PLAIN_LITERAL){if(object.language){triple.object.datatype=RDF_LANGSTRING;triple.object.language=object.language}else{triple.object.datatype=XSD_STRING}}else{triple.object.datatype=object.type}}triple.object.value=value;dataset["@default"].push(triple)}}}return dataset}};function getXMLSerializerClass(){if(typeof XMLSerializer==="undefined"){return require("xmldom").XMLSerializer}return XMLSerializer}},{"./constants":57,xmldom:44}],54:[function(require,module,exports){"use strict";module.exports=class RequestQueue{constructor(){this._requests={}}wrapLoader(loader){const self=this;self._loader=loader;return function(){return self.add.apply(self,arguments)}}async add(url){let promise=this._requests[url];if(promise){return Promise.resolve(promise)}promise=this._requests[url]=this._loader(url);try{return await promise}finally{delete this._requests[url]}}}},{}],55:[function(require,module,exports){"use strict";const LRU=require("lru-cache");const MAX_ACTIVE_CONTEXTS=10;module.exports=class ResolvedContext{constructor({document:document}){this.document=document;this.cache=new LRU({max:MAX_ACTIVE_CONTEXTS})}getProcessed(activeCtx){return this.cache.get(activeCtx)}setProcessed(activeCtx,processedCtx){this.cache.set(activeCtx,processedCtx)}}},{"lru-cache":72}],56:[function(require,module,exports){"use strict";const JsonLdError=require("./JsonLdError");const{isArray:_isArray,isObject:_isObject,isString:_isString,isUndefined:_isUndefined}=require("./types");const{isList:_isList,isValue:_isValue,isGraph:_isGraph,isSimpleGraph:_isSimpleGraph,isSubjectReference:_isSubjectReference}=require("./graphTypes");const{expandIri:_expandIri,getContextValue:_getContextValue,isKeyword:_isKeyword,process:_processContext,processingMode:_processingMode}=require("./context");const{removeBase:_removeBase,prependBase:_prependBase}=require("./url");const{addValue:_addValue,asArray:_asArray,compareShortestLeast:_compareShortestLeast}=require("./util");const api={};module.exports=api;api.compact=async({activeCtx:activeCtx,activeProperty:activeProperty=null,element:element,options:options={},compactionMap:compactionMap=(()=>undefined)})=>{if(_isArray(element)){let rval=[];for(let i=0;i<element.length;++i){let compacted=await api.compact({activeCtx:activeCtx,activeProperty:activeProperty,element:element[i],options:options,compactionMap:compactionMap});if(compacted===null){compacted=await compactionMap({unmappedValue:element[i],activeCtx:activeCtx,activeProperty:activeProperty,parent:element,index:i,options:options});if(compacted===undefined){continue}}rval.push(compacted)}if(options.compactArrays&&rval.length===1){const container=_getContextValue(activeCtx,activeProperty,"@container")||[];if(container.length===0){rval=rval[0]}}return rval}const ctx=_getContextValue(activeCtx,activeProperty,"@context");if(!_isUndefined(ctx)){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:ctx,propagate:true,overrideProtected:true,options:options})}if(_isObject(element)){if(options.link&&"@id"in element&&options.link.hasOwnProperty(element["@id"])){const linked=options.link[element["@id"]];for(let i=0;i<linked.length;++i){if(linked[i].expanded===element){return linked[i].compacted}}}if(_isValue(element)||_isSubjectReference(element)){const rval=api.compactValue({activeCtx:activeCtx,activeProperty:activeProperty,value:element,options:options});if(options.link&&_isSubjectReference(element)){if(!options.link.hasOwnProperty(element["@id"])){options.link[element["@id"]]=[]}options.link[element["@id"]].push({expanded:element,compacted:rval})}return rval}if(_isList(element)){const container=_getContextValue(activeCtx,activeProperty,"@container")||[];if(container.includes("@list")){return api.compact({activeCtx:activeCtx,activeProperty:activeProperty,element:element["@list"],options:options,compactionMap:compactionMap})}}const insideReverse=activeProperty==="@reverse";const rval={};const inputCtx=activeCtx;if(!_isValue(element)&&!_isSubjectReference(element)){activeCtx=activeCtx.revertToPreviousContext()}const propertyScopedCtx=_getContextValue(inputCtx,activeProperty,"@context");if(!_isUndefined(propertyScopedCtx)){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:propertyScopedCtx,propagate:true,overrideProtected:true,options:options})}if(options.link&&"@id"in element){if(!options.link.hasOwnProperty(element["@id"])){options.link[element["@id"]]=[]}options.link[element["@id"]].push({expanded:element,compacted:rval})}let types=element["@type"]||[];if(types.length>1){types=Array.from(types).sort()}const typeContext=activeCtx;for(const type of types){const compactedType=api.compactIri({activeCtx:typeContext,iri:type,relativeTo:{vocab:true}});const ctx=_getContextValue(inputCtx,compactedType,"@context");if(!_isUndefined(ctx)){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:ctx,options:options,propagate:false})}}const keys=Object.keys(element).sort();for(const expandedProperty of keys){const expandedValue=element[expandedProperty];if(expandedProperty==="@id"){let compactedValue=_asArray(expandedValue).map(expandedIri=>api.compactIri({activeCtx:activeCtx,iri:expandedIri,relativeTo:{vocab:false},base:options.base}));if(compactedValue.length===1){compactedValue=compactedValue[0]}const alias=api.compactIri({activeCtx:activeCtx,iri:"@id",relativeTo:{vocab:true}});rval[alias]=compactedValue;continue}if(expandedProperty==="@type"){let compactedValue=_asArray(expandedValue).map(expandedIri=>api.compactIri({activeCtx:inputCtx,iri:expandedIri,relativeTo:{vocab:true}}));if(compactedValue.length===1){compactedValue=compactedValue[0]}const alias=api.compactIri({activeCtx:activeCtx,iri:"@type",relativeTo:{vocab:true}});const container=_getContextValue(activeCtx,alias,"@container")||[];const typeAsSet=container.includes("@set")&&_processingMode(activeCtx,1.1);const isArray=typeAsSet||_isArray(compactedValue)&&expandedValue.length===0;_addValue(rval,alias,compactedValue,{propertyIsArray:isArray});continue}if(expandedProperty==="@reverse"){const compactedValue=await api.compact({activeCtx:activeCtx,activeProperty:"@reverse",element:expandedValue,options:options,compactionMap:compactionMap});for(const compactedProperty in compactedValue){if(activeCtx.mappings.has(compactedProperty)&&activeCtx.mappings.get(compactedProperty).reverse){const value=compactedValue[compactedProperty];const container=_getContextValue(activeCtx,compactedProperty,"@container")||[];const useArray=container.includes("@set")||!options.compactArrays;_addValue(rval,compactedProperty,value,{propertyIsArray:useArray});delete compactedValue[compactedProperty]}}if(Object.keys(compactedValue).length>0){const alias=api.compactIri({activeCtx:activeCtx,iri:expandedProperty,relativeTo:{vocab:true}});_addValue(rval,alias,compactedValue)}continue}if(expandedProperty==="@preserve"){const compactedValue=await api.compact({activeCtx:activeCtx,activeProperty:activeProperty,element:expandedValue,options:options,compactionMap:compactionMap});if(!(_isArray(compactedValue)&&compactedValue.length===0)){_addValue(rval,expandedProperty,compactedValue)}continue}if(expandedProperty==="@index"){const container=_getContextValue(activeCtx,activeProperty,"@container")||[];if(container.includes("@index")){continue}const alias=api.compactIri({activeCtx:activeCtx,iri:expandedProperty,relativeTo:{vocab:true}});_addValue(rval,alias,expandedValue);continue}if(expandedProperty!=="@graph"&&expandedProperty!=="@list"&&expandedProperty!=="@included"&&_isKeyword(expandedProperty)){const alias=api.compactIri({activeCtx:activeCtx,iri:expandedProperty,relativeTo:{vocab:true}});_addValue(rval,alias,expandedValue);continue}if(!_isArray(expandedValue)){throw new JsonLdError("JSON-LD expansion error; expanded value must be an array.","jsonld.SyntaxError")}if(expandedValue.length===0){const itemActiveProperty=api.compactIri({activeCtx:activeCtx,iri:expandedProperty,value:expandedValue,relativeTo:{vocab:true},reverse:insideReverse});const nestProperty=activeCtx.mappings.has(itemActiveProperty)?activeCtx.mappings.get(itemActiveProperty)["@nest"]:null;let nestResult=rval;if(nestProperty){_checkNestProperty(activeCtx,nestProperty,options);if(!_isObject(rval[nestProperty])){rval[nestProperty]={}}nestResult=rval[nestProperty]}_addValue(nestResult,itemActiveProperty,expandedValue,{propertyIsArray:true})}for(const expandedItem of expandedValue){const itemActiveProperty=api.compactIri({activeCtx:activeCtx,iri:expandedProperty,value:expandedItem,relativeTo:{vocab:true},reverse:insideReverse});const nestProperty=activeCtx.mappings.has(itemActiveProperty)?activeCtx.mappings.get(itemActiveProperty)["@nest"]:null;let nestResult=rval;if(nestProperty){_checkNestProperty(activeCtx,nestProperty,options);if(!_isObject(rval[nestProperty])){rval[nestProperty]={}}nestResult=rval[nestProperty]}const container=_getContextValue(activeCtx,itemActiveProperty,"@container")||[];const isGraph=_isGraph(expandedItem);const isList=_isList(expandedItem);let inner;if(isList){inner=expandedItem["@list"]}else if(isGraph){inner=expandedItem["@graph"]}let compactedItem=await api.compact({activeCtx:activeCtx,activeProperty:itemActiveProperty,element:isList||isGraph?inner:expandedItem,options:options,compactionMap:compactionMap});if(isList){if(!_isArray(compactedItem)){compactedItem=[compactedItem]}if(!container.includes("@list")){compactedItem={[api.compactIri({activeCtx:activeCtx,iri:"@list",relativeTo:{vocab:true}})]:compactedItem};if("@index"in expandedItem){compactedItem[api.compactIri({activeCtx:activeCtx,iri:"@index",relativeTo:{vocab:true}})]=expandedItem["@index"]}}else{_addValue(nestResult,itemActiveProperty,compactedItem,{valueIsArray:true,allowDuplicate:true});continue}}if(isGraph){if(container.includes("@graph")&&(container.includes("@id")||container.includes("@index")&&_isSimpleGraph(expandedItem))){let mapObject;if(nestResult.hasOwnProperty(itemActiveProperty)){mapObject=nestResult[itemActiveProperty]}else{nestResult[itemActiveProperty]=mapObject={}}const key=(container.includes("@id")?expandedItem["@id"]:expandedItem["@index"])||api.compactIri({activeCtx:activeCtx,iri:"@none",relativeTo:{vocab:true}});_addValue(mapObject,key,compactedItem,{propertyIsArray:!options.compactArrays||container.includes("@set")})}else if(container.includes("@graph")&&_isSimpleGraph(expandedItem)){if(_isArray(compactedItem)&&compactedItem.length>1){compactedItem={"@included":compactedItem}}_addValue(nestResult,itemActiveProperty,compactedItem,{propertyIsArray:!options.compactArrays||container.includes("@set")})}else{if(_isArray(compactedItem)&&compactedItem.length===1&&options.compactArrays){compactedItem=compactedItem[0]}compactedItem={[api.compactIri({activeCtx:activeCtx,iri:"@graph",relativeTo:{vocab:true}})]:compactedItem};if("@id"in expandedItem){compactedItem[api.compactIri({activeCtx:activeCtx,iri:"@id",relativeTo:{vocab:true}})]=expandedItem["@id"]}if("@index"in expandedItem){compactedItem[api.compactIri({activeCtx:activeCtx,iri:"@index",relativeTo:{vocab:true}})]=expandedItem["@index"]}_addValue(nestResult,itemActiveProperty,compactedItem,{propertyIsArray:!options.compactArrays||container.includes("@set")})}}else if(container.includes("@language")||container.includes("@index")||container.includes("@id")||container.includes("@type")){let mapObject;if(nestResult.hasOwnProperty(itemActiveProperty)){mapObject=nestResult[itemActiveProperty]}else{nestResult[itemActiveProperty]=mapObject={}}let key;if(container.includes("@language")){if(_isValue(compactedItem)){compactedItem=compactedItem["@value"]}key=expandedItem["@language"]}else if(container.includes("@index")){const indexKey=_getContextValue(activeCtx,itemActiveProperty,"@index")||"@index";const containerKey=api.compactIri({activeCtx:activeCtx,iri:indexKey,relativeTo:{vocab:true}});if(indexKey==="@index"){key=expandedItem["@index"];delete compactedItem[containerKey]}else{let others;[key,...others]=_asArray(compactedItem[indexKey]||[]);if(!_isString(key)){key=null}else{switch(others.length){case 0:delete compactedItem[indexKey];break;case 1:compactedItem[indexKey]=others[0];break;default:compactedItem[indexKey]=others;break}}}}else if(container.includes("@id")){const idKey=api.compactIri({activeCtx:activeCtx,iri:"@id",relativeTo:{vocab:true}});key=compactedItem[idKey];delete compactedItem[idKey]}else if(container.includes("@type")){const typeKey=api.compactIri({activeCtx:activeCtx,iri:"@type",relativeTo:{vocab:true}});let types;[key,...types]=_asArray(compactedItem[typeKey]||[]);switch(types.length){case 0:delete compactedItem[typeKey];break;case 1:compactedItem[typeKey]=types[0];break;default:compactedItem[typeKey]=types;break}if(Object.keys(compactedItem).length===1&&"@id"in expandedItem){compactedItem=await api.compact({activeCtx:activeCtx,activeProperty:itemActiveProperty,element:{"@id":expandedItem["@id"]},options:options,compactionMap:compactionMap})}}if(!key){key=api.compactIri({activeCtx:activeCtx,iri:"@none",relativeTo:{vocab:true}})}_addValue(mapObject,key,compactedItem,{propertyIsArray:container.includes("@set")})}else{const isArray=!options.compactArrays||container.includes("@set")||container.includes("@list")||_isArray(compactedItem)&&compactedItem.length===0||expandedProperty==="@list"||expandedProperty==="@graph";_addValue(nestResult,itemActiveProperty,compactedItem,{propertyIsArray:isArray})}}}return rval}return element};api.compactIri=({activeCtx:activeCtx,iri:iri,value:value=null,relativeTo:relativeTo={vocab:false},reverse:reverse=false,base:base=null})=>{if(iri===null){return iri}if(activeCtx.isPropertyTermScoped&&activeCtx.previousContext){activeCtx=activeCtx.previousContext}const inverseCtx=activeCtx.getInverse();if(_isKeyword(iri)&&iri in inverseCtx&&"@none"in inverseCtx[iri]&&"@type"in inverseCtx[iri]["@none"]&&"@none"in inverseCtx[iri]["@none"]["@type"]){return inverseCtx[iri]["@none"]["@type"]["@none"]}if(relativeTo.vocab&&iri in inverseCtx){const defaultLanguage=activeCtx["@language"]||"@none";const containers=[];if(_isObject(value)&&"@index"in value&&!("@graph"in value)){containers.push("@index","@index@set")}if(_isObject(value)&&"@preserve"in value){value=value["@preserve"][0]}if(_isGraph(value)){if("@index"in value){containers.push("@graph@index","@graph@index@set","@index","@index@set")}if("@id"in value){containers.push("@graph@id","@graph@id@set")}containers.push("@graph","@graph@set","@set");if(!("@index"in value)){containers.push("@graph@index","@graph@index@set","@index","@index@set")}if(!("@id"in value)){containers.push("@graph@id","@graph@id@set")}}else if(_isObject(value)&&!_isValue(value)){containers.push("@id","@id@set","@type","@set@type")}let typeOrLanguage="@language";let typeOrLanguageValue="@null";if(reverse){typeOrLanguage="@type";typeOrLanguageValue="@reverse";containers.push("@set")}else if(_isList(value)){if(!("@index"in value)){containers.push("@list")}const list=value["@list"];if(list.length===0){typeOrLanguage="@any";typeOrLanguageValue="@none"}else{let commonLanguage=list.length===0?defaultLanguage:null;let commonType=null;for(let i=0;i<list.length;++i){const item=list[i];let itemLanguage="@none";let itemType="@none";if(_isValue(item)){if("@direction"in item){const lang=(item["@language"]||"").toLowerCase();const dir=item["@direction"];itemLanguage=`${lang}_${dir}`}else if("@language"in item){itemLanguage=item["@language"].toLowerCase()}else if("@type"in item){itemType=item["@type"]}else{itemLanguage="@null"}}else{itemType="@id"}if(commonLanguage===null){commonLanguage=itemLanguage}else if(itemLanguage!==commonLanguage&&_isValue(item)){commonLanguage="@none"}if(commonType===null){commonType=itemType}else if(itemType!==commonType){commonType="@none"}if(commonLanguage==="@none"&&commonType==="@none"){break}}commonLanguage=commonLanguage||"@none";commonType=commonType||"@none";if(commonType!=="@none"){typeOrLanguage="@type";typeOrLanguageValue=commonType}else{typeOrLanguageValue=commonLanguage}}}else{if(_isValue(value)){if("@language"in value&&!("@index"in value)){containers.push("@language","@language@set");typeOrLanguageValue=value["@language"];const dir=value["@direction"];if(dir){typeOrLanguageValue=`${typeOrLanguageValue}_${dir}`}}else if("@direction"in value&&!("@index"in value)){typeOrLanguageValue=`_${value["@direction"]}`}else if("@type"in value){typeOrLanguage="@type";typeOrLanguageValue=value["@type"]}}else{typeOrLanguage="@type";typeOrLanguageValue="@id"}containers.push("@set")}containers.push("@none");if(_isObject(value)&&!("@index"in value)){containers.push("@index","@index@set")}if(_isValue(value)&&Object.keys(value).length===1){containers.push("@language","@language@set")}const term=_selectTerm(activeCtx,iri,value,containers,typeOrLanguage,typeOrLanguageValue);if(term!==null){return term}}if(relativeTo.vocab){if("@vocab"in activeCtx){const vocab=activeCtx["@vocab"];if(iri.indexOf(vocab)===0&&iri!==vocab){const suffix=iri.substr(vocab.length);if(!activeCtx.mappings.has(suffix)){return suffix}}}}let choice=null;const partialMatches=[];let iriMap=activeCtx.fastCurieMap;const maxPartialLength=iri.length-1;for(let i=0;i<maxPartialLength&&iri[i]in iriMap;++i){iriMap=iriMap[iri[i]];if(""in iriMap){partialMatches.push(iriMap[""][0])}}for(let i=partialMatches.length-1;i>=0;--i){const entry=partialMatches[i];const terms=entry.terms;for(const term of terms){const curie=term+":"+iri.substr(entry.iri.length);const isUsableCurie=activeCtx.mappings.get(term)._prefix&&(!activeCtx.mappings.has(curie)||value===null&&activeCtx.mappings.get(curie)["@id"]===iri);if(isUsableCurie&&(choice===null||_compareShortestLeast(curie,choice)<0)){choice=curie}}}if(choice!==null){return choice}for(const[term,td]of activeCtx.mappings){if(td&&td._prefix&&iri.startsWith(term+":")){throw new JsonLdError(`Absolute IRI "${iri}" confused with prefix "${term}".`,"jsonld.SyntaxError",{code:"IRI confused with prefix",context:activeCtx})}}if(!relativeTo.vocab){if("@base"in activeCtx){if(!activeCtx["@base"]){return iri}else{return _removeBase(_prependBase(base,activeCtx["@base"]),iri)}}else{return _removeBase(base,iri)}}return iri};api.compactValue=({activeCtx:activeCtx,activeProperty:activeProperty,value:value,options:options})=>{if(_isValue(value)){const type=_getContextValue(activeCtx,activeProperty,"@type");const language=_getContextValue(activeCtx,activeProperty,"@language");const direction=_getContextValue(activeCtx,activeProperty,"@direction");const container=_getContextValue(activeCtx,activeProperty,"@container")||[];const preserveIndex="@index"in value&&!container.includes("@index");if(!preserveIndex&&type!=="@none"){if(value["@type"]===type){return value["@value"]}if("@language"in value&&value["@language"]===language&&"@direction"in value&&value["@direction"]===direction){return value["@value"]}if("@language"in value&&value["@language"]===language){return value["@value"]}if("@direction"in value&&value["@direction"]===direction){return value["@value"]}}const keyCount=Object.keys(value).length;const isValueOnlyKey=keyCount===1||keyCount===2&&"@index"in value&&!preserveIndex;const hasDefaultLanguage="@language"in activeCtx;const isValueString=_isString(value["@value"]);const hasNullMapping=activeCtx.mappings.has(activeProperty)&&activeCtx.mappings.get(activeProperty)["@language"]===null;if(isValueOnlyKey&&type!=="@none"&&(!hasDefaultLanguage||!isValueString||hasNullMapping)){return value["@value"]}const rval={};if(preserveIndex){rval[api.compactIri({activeCtx:activeCtx,iri:"@index",relativeTo:{vocab:true}})]=value["@index"]}if("@type"in value){rval[api.compactIri({activeCtx:activeCtx,iri:"@type",relativeTo:{vocab:true}})]=api.compactIri({activeCtx:activeCtx,iri:value["@type"],relativeTo:{vocab:true}})}else if("@language"in value){rval[api.compactIri({activeCtx:activeCtx,iri:"@language",relativeTo:{vocab:true}})]=value["@language"]}if("@direction"in value){rval[api.compactIri({activeCtx:activeCtx,iri:"@direction",relativeTo:{vocab:true}})]=value["@direction"]}rval[api.compactIri({activeCtx:activeCtx,iri:"@value",relativeTo:{vocab:true}})]=value["@value"];return rval}const expandedProperty=_expandIri(activeCtx,activeProperty,{vocab:true},options);const type=_getContextValue(activeCtx,activeProperty,"@type");const compacted=api.compactIri({activeCtx:activeCtx,iri:value["@id"],relativeTo:{vocab:type==="@vocab"},base:options.base});if(type==="@id"||type==="@vocab"||expandedProperty==="@graph"){return compacted}return{[api.compactIri({activeCtx:activeCtx,iri:"@id",relativeTo:{vocab:true}})]:compacted}};function _selectTerm(activeCtx,iri,value,containers,typeOrLanguage,typeOrLanguageValue){if(typeOrLanguageValue===null){typeOrLanguageValue="@null"}const prefs=[];if((typeOrLanguageValue==="@id"||typeOrLanguageValue==="@reverse")&&_isObject(value)&&"@id"in value){if(typeOrLanguageValue==="@reverse"){prefs.push("@reverse")}const term=api.compactIri({activeCtx:activeCtx,iri:value["@id"],relativeTo:{vocab:true}});if(activeCtx.mappings.has(term)&&activeCtx.mappings.get(term)&&activeCtx.mappings.get(term)["@id"]===value["@id"]){prefs.push.apply(prefs,["@vocab","@id"])}else{prefs.push.apply(prefs,["@id","@vocab"])}}else{prefs.push(typeOrLanguageValue);const langDir=prefs.find(el=>el.includes("_"));if(langDir){prefs.push(langDir.replace(/^[^_]+_/,"_"))}}prefs.push("@none");const containerMap=activeCtx.inverse[iri];for(const container of containers){if(!(container in containerMap)){continue}const typeOrLanguageValueMap=containerMap[container][typeOrLanguage];for(const pref of prefs){if(!(pref in typeOrLanguageValueMap)){continue}return typeOrLanguageValueMap[pref]}}return null}function _checkNestProperty(activeCtx,nestProperty,options){if(_expandIri(activeCtx,nestProperty,{vocab:true},options)!=="@nest"){throw new JsonLdError("JSON-LD compact error; nested property must have an @nest value "+"resolving to @nest.","jsonld.SyntaxError",{code:"invalid @nest value"})}}},{"./JsonLdError":50,"./context":58,"./graphTypes":65,"./types":69,"./url":70,"./util":71}],57:[function(require,module,exports){"use strict";const RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";const XSD="http://www.w3.org/2001/XMLSchema#";module.exports={LINK_HEADER_REL:"http://www.w3.org/ns/json-ld#context",LINK_HEADER_CONTEXT:"http://www.w3.org/ns/json-ld#context",RDF:RDF,RDF_LIST:RDF+"List",RDF_FIRST:RDF+"first",RDF_REST:RDF+"rest",RDF_NIL:RDF+"nil",RDF_TYPE:RDF+"type",RDF_PLAIN_LITERAL:RDF+"PlainLiteral",RDF_XML_LITERAL:RDF+"XMLLiteral",RDF_JSON_LITERAL:RDF+"JSON",RDF_OBJECT:RDF+"object",RDF_LANGSTRING:RDF+"langString",XSD:XSD,XSD_BOOLEAN:XSD+"boolean",XSD_DOUBLE:XSD+"double",XSD_INTEGER:XSD+"integer",XSD_STRING:XSD+"string"}},{}],58:[function(require,module,exports){"use strict";const util=require("./util");const JsonLdError=require("./JsonLdError");const{isArray:_isArray,isObject:_isObject,isString:_isString,isUndefined:_isUndefined}=require("./types");const{isAbsolute:_isAbsoluteIri,isRelative:_isRelativeIri,prependBase:prependBase,parse:parseUrl}=require("./url");const{asArray:_asArray,compareShortestLeast:_compareShortestLeast}=require("./util");const INITIAL_CONTEXT_CACHE=new Map;const INITIAL_CONTEXT_CACHE_MAX_SIZE=1e4;const KEYWORD_PATTERN=/^@[a-zA-Z]+$/;const api={};module.exports=api;api.process=async({activeCtx:activeCtx,localCtx:localCtx,options:options,propagate:propagate=true,overrideProtected:overrideProtected=false,cycles:cycles=new Set})=>{if(_isObject(localCtx)&&"@context"in localCtx&&_isArray(localCtx["@context"])){localCtx=localCtx["@context"]}const ctxs=_asArray(localCtx);if(ctxs.length===0){return activeCtx}const resolved=await options.contextResolver.resolve({activeCtx:activeCtx,context:localCtx,documentLoader:options.documentLoader,base:options.base});if(_isObject(resolved[0].document)&&typeof resolved[0].document["@propagate"]==="boolean"){propagate=resolved[0].document["@propagate"]}let rval=activeCtx;if(!propagate&&!rval.previousContext){rval=rval.clone();rval.previousContext=activeCtx}for(const resolvedContext of resolved){let{document:ctx}=resolvedContext;activeCtx=rval;if(ctx===null){if(!overrideProtected&&Object.keys(activeCtx.protected).length!==0){const protectedMode=options&&options.protectedMode||"error";if(protectedMode==="error"){throw new JsonLdError("Tried to nullify a context with protected terms outside of "+"a term definition.","jsonld.SyntaxError",{code:"invalid context nullification"})}else if(protectedMode==="warn"){console.warn("WARNING: invalid context nullification");const processed=resolvedContext.getProcessed(activeCtx);if(processed){rval=activeCtx=processed;continue}const oldActiveCtx=activeCtx;rval=activeCtx=api.getInitialContext(options).clone();for(const[term,_protected]of Object.entries(oldActiveCtx.protected)){if(_protected){activeCtx.mappings[term]=util.clone(oldActiveCtx.mappings[term])}}activeCtx.protected=util.clone(oldActiveCtx.protected);resolvedContext.setProcessed(oldActiveCtx,rval);continue}throw new JsonLdError("Invalid protectedMode.","jsonld.SyntaxError",{code:"invalid protected mode",context:localCtx,protectedMode:protectedMode})}rval=activeCtx=api.getInitialContext(options).clone();continue}const processed=resolvedContext.getProcessed(activeCtx);if(processed){rval=activeCtx=processed;continue}if(_isObject(ctx)&&"@context"in ctx){ctx=ctx["@context"]}if(!_isObject(ctx)){throw new JsonLdError("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:ctx})}rval=rval.clone();const defined=new Map;if("@version"in ctx){if(ctx["@version"]!==1.1){throw new JsonLdError("Unsupported JSON-LD version: "+ctx["@version"],"jsonld.UnsupportedVersion",{code:"invalid @version value",context:ctx})}if(activeCtx.processingMode&&activeCtx.processingMode==="json-ld-1.0"){throw new JsonLdError("@version: "+ctx["@version"]+" not compatible with "+activeCtx.processingMode,"jsonld.ProcessingModeConflict",{code:"processing mode conflict",context:ctx})}rval.processingMode="json-ld-1.1";rval["@version"]=ctx["@version"];defined.set("@version",true)}rval.processingMode=rval.processingMode||activeCtx.processingMode;if("@base"in ctx){let base=ctx["@base"];if(base===null||_isAbsoluteIri(base)){}else if(_isRelativeIri(base)){base=prependBase(rval["@base"],base)}else{throw new JsonLdError('Invalid JSON-LD syntax; the value of "@base" in a '+"@context must be an absolute IRI, a relative IRI, or null.","jsonld.SyntaxError",{code:"invalid base IRI",context:ctx})}rval["@base"]=base;defined.set("@base",true)}if("@vocab"in ctx){const value=ctx["@vocab"];if(value===null){delete rval["@vocab"]}else if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@vocab" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid vocab mapping",context:ctx})}else if(!_isAbsoluteIri(value)&&api.processingMode(rval,1)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@vocab" in a '+"@context must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid vocab mapping",context:ctx})}else{rval["@vocab"]=_expandIri(rval,value,{vocab:true,base:true},undefined,undefined,options)}defined.set("@vocab",true)}if("@language"in ctx){const value=ctx["@language"];if(value===null){delete rval["@language"]}else if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@language" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid default language",context:ctx})}else{rval["@language"]=value.toLowerCase()}defined.set("@language",true)}if("@direction"in ctx){const value=ctx["@direction"];if(activeCtx.processingMode==="json-ld-1.0"){throw new JsonLdError("Invalid JSON-LD syntax; @direction not compatible with "+activeCtx.processingMode,"jsonld.SyntaxError",{code:"invalid context member",context:ctx})}if(value===null){delete rval["@direction"]}else if(value!=="ltr"&&value!=="rtl"){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@direction" in a '+'@context must be null, "ltr", or "rtl".',"jsonld.SyntaxError",{code:"invalid base direction",context:ctx})}else{rval["@direction"]=value}defined.set("@direction",true)}if("@propagate"in ctx){const value=ctx["@propagate"];if(activeCtx.processingMode==="json-ld-1.0"){throw new JsonLdError("Invalid JSON-LD syntax; @propagate not compatible with "+activeCtx.processingMode,"jsonld.SyntaxError",{code:"invalid context entry",context:ctx})}if(typeof value!=="boolean"){throw new JsonLdError("Invalid JSON-LD syntax; @propagate value must be a boolean.","jsonld.SyntaxError",{code:"invalid @propagate value",context:localCtx})}defined.set("@propagate",true)}if("@import"in ctx){const value=ctx["@import"];if(activeCtx.processingMode==="json-ld-1.0"){throw new JsonLdError("Invalid JSON-LD syntax; @import not compatible with "+activeCtx.processingMode,"jsonld.SyntaxError",{code:"invalid context entry",context:ctx})}if(!_isString(value)){throw new JsonLdError("Invalid JSON-LD syntax; @import must be a string.","jsonld.SyntaxError",{code:"invalid @import value",context:localCtx})}const resolvedImport=await options.contextResolver.resolve({activeCtx:activeCtx,context:value,documentLoader:options.documentLoader,base:options.base});if(resolvedImport.length!==1){throw new JsonLdError("Invalid JSON-LD syntax; @import must reference a single context.","jsonld.SyntaxError",{code:"invalid remote context",context:localCtx})}const processedImport=resolvedImport[0].getProcessed(activeCtx);if(processedImport){ctx=processedImport}else{const importCtx=resolvedImport[0].document;if("@import"in importCtx){throw new JsonLdError("Invalid JSON-LD syntax: "+"imported context must not include @import.","jsonld.SyntaxError",{code:"invalid context entry",context:localCtx})}for(const key in importCtx){if(!ctx.hasOwnProperty(key)){ctx[key]=importCtx[key]}}resolvedImport[0].setProcessed(activeCtx,ctx)}defined.set("@import",true)}defined.set("@protected",ctx["@protected"]||false);for(const key in ctx){api.createTermDefinition({activeCtx:rval,localCtx:ctx,term:key,defined:defined,options:options,overrideProtected:overrideProtected});if(_isObject(ctx[key])&&"@context"in ctx[key]){const keyCtx=ctx[key]["@context"];let process=true;if(_isString(keyCtx)){const url=prependBase(options.base,keyCtx);if(cycles.has(url)){process=false}else{cycles.add(url)}}if(process){try{await api.process({activeCtx:rval,localCtx:ctx[key]["@context"],overrideProtected:true,options:options,cycles:cycles})}catch(e){throw new JsonLdError("Invalid JSON-LD syntax; invalid scoped context.","jsonld.SyntaxError",{code:"invalid scoped context",context:ctx[key]["@context"],term:key})}}}}resolvedContext.setProcessed(activeCtx,rval)}return rval};api.createTermDefinition=({activeCtx:activeCtx,localCtx:localCtx,term:term,defined:defined,options:options,overrideProtected:overrideProtected=false})=>{if(defined.has(term)){if(defined.get(term)){return}throw new JsonLdError("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:localCtx,term:term})}defined.set(term,false);let value;if(localCtx.hasOwnProperty(term)){value=localCtx[term]}if(term==="@type"&&_isObject(value)&&(value["@container"]||"@set")==="@set"&&api.processingMode(activeCtx,1.1)){const validKeys=["@container","@id","@protected"];const keys=Object.keys(value);if(keys.length===0||keys.some(k=>!validKeys.includes(k))){throw new JsonLdError("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:localCtx,term:term})}}else if(api.isKeyword(term)){throw new JsonLdError("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:localCtx,term:term})}else if(term.match(KEYWORD_PATTERN)){console.warn('WARNING: terms beginning with "@" are reserved'+" for future use and ignored",{term:term});return}else if(term===""){throw new JsonLdError("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}const previousMapping=activeCtx.mappings.get(term);if(activeCtx.mappings.has(term)){activeCtx.mappings.delete(term)}let simpleTerm=false;if(_isString(value)||value===null){simpleTerm=true;value={"@id":value}}if(!_isObject(value)){throw new JsonLdError("Invalid JSON-LD syntax; @context term values must be "+"strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}const mapping={};activeCtx.mappings.set(term,mapping);mapping.reverse=false;const validKeys=["@container","@id","@language","@reverse","@type"];if(api.processingMode(activeCtx,1.1)){validKeys.push("@context","@direction","@index","@nest","@prefix","@protected")}for(const kw in value){if(!validKeys.includes(kw)){throw new JsonLdError("Invalid JSON-LD syntax; a term definition must not contain "+kw,"jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}}const colon=term.indexOf(":");mapping._termHasColon=colon>0;if("@reverse"in value){if("@id"in value){throw new JsonLdError("Invalid JSON-LD syntax; a @reverse term definition must not "+"contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}if("@nest"in value){throw new JsonLdError("Invalid JSON-LD syntax; a @reverse term definition must not "+"contain @nest.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}const reverse=value["@reverse"];if(!_isString(reverse)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}if(!api.isKeyword(reverse)&&reverse.match(KEYWORD_PATTERN)){console.warn('WARNING: values beginning with "@" are reserved'+" for future use and ignored",{reverse:reverse});if(previousMapping){activeCtx.mappings.set(term,previousMapping)}else{activeCtx.mappings.delete(term)}return}const id=_expandIri(activeCtx,reverse,{vocab:true,base:false},localCtx,defined,options);if(!_isAbsoluteIri(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @reverse value must be an "+"absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}mapping["@id"]=id;mapping.reverse=true}else if("@id"in value){let id=value["@id"];if(id&&!_isString(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @id value must be an array "+"of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}if(id===null){mapping["@id"]=null}else if(!api.isKeyword(id)&&id.match(KEYWORD_PATTERN)){console.warn('WARNING: values beginning with "@" are reserved'+" for future use and ignored",{id:id});if(previousMapping){activeCtx.mappings.set(term,previousMapping)}else{activeCtx.mappings.delete(term)}return}else if(id!==term){id=_expandIri(activeCtx,id,{vocab:true,base:false},localCtx,defined,options);if(!_isAbsoluteIri(id)&&!api.isKeyword(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @id value must be an "+"absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}if(term.match(/(?::[^:])|\//)){const termDefined=new Map(defined).set(term,true);const termIri=_expandIri(activeCtx,term,{vocab:true,base:false},localCtx,termDefined,options);if(termIri!==id){throw new JsonLdError("Invalid JSON-LD syntax; term in form of IRI must "+"expand to definition.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}}mapping["@id"]=id;mapping._prefix=simpleTerm&&!mapping._termHasColon&&id.match(/[:\/\?#\[\]@]$/)}}if(!("@id"in mapping)){if(mapping._termHasColon){const prefix=term.substr(0,colon);if(localCtx.hasOwnProperty(prefix)){api.createTermDefinition({activeCtx:activeCtx,localCtx:localCtx,term:prefix,defined:defined,options:options})}if(activeCtx.mappings.has(prefix)){const suffix=term.substr(colon+1);mapping["@id"]=activeCtx.mappings.get(prefix)["@id"]+suffix}else{mapping["@id"]=term}}else if(term==="@type"){mapping["@id"]=term}else{if(!("@vocab"in activeCtx)){throw new JsonLdError("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx,term:term})}mapping["@id"]=activeCtx["@vocab"]+term}}if(value["@protected"]===true||defined.get("@protected")===true&&value["@protected"]!==false){activeCtx.protected[term]=true;mapping.protected=true}defined.set(term,true);if("@type"in value){let type=value["@type"];if(!_isString(type)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type value must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}if(type==="@json"||type==="@none"){if(api.processingMode(activeCtx,1)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type value must not be "+`"${type}" in JSON-LD 1.0 mode.`,"jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}}else if(type!=="@id"&&type!=="@vocab"){type=_expandIri(activeCtx,type,{vocab:true,base:false},localCtx,defined,options);if(!_isAbsoluteIri(type)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type value must be an "+"absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}if(type.indexOf("_:")===0){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type value must be an IRI, "+"not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}}mapping["@type"]=type}if("@container"in value){const container=_isString(value["@container"])?[value["@container"]]:value["@container"]||[];const validContainers=["@list","@set","@index","@language"];let isValid=true;const hasSet=container.includes("@set");if(api.processingMode(activeCtx,1.1)){validContainers.push("@graph","@id","@type");if(container.includes("@list")){if(container.length!==1){throw new JsonLdError("Invalid JSON-LD syntax; @context @container with @list must "+"have no other values","jsonld.SyntaxError",{code:"invalid container mapping",context:localCtx})}}else if(container.includes("@graph")){if(container.some(key=>key!=="@graph"&&key!=="@id"&&key!=="@index"&&key!=="@set")){throw new JsonLdError("Invalid JSON-LD syntax; @context @container with @graph must "+"have no other values other than @id, @index, and @set","jsonld.SyntaxError",{code:"invalid container mapping",context:localCtx})}}else{isValid&=container.length<=(hasSet?2:1)}if(container.includes("@type")){mapping["@type"]=mapping["@type"]||"@id";if(!["@id","@vocab"].includes(mapping["@type"])){throw new JsonLdError("Invalid JSON-LD syntax; container: @type requires @type to be "+"@id or @vocab.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}}}else{isValid&=!_isArray(value["@container"]);isValid&=container.length<=1}isValid&=container.every(c=>validContainers.includes(c));isValid&=!(hasSet&&container.includes("@list"));if(!isValid){throw new JsonLdError("Invalid JSON-LD syntax; @context @container value must be "+"one of the following: "+validContainers.join(", "),"jsonld.SyntaxError",{code:"invalid container mapping",context:localCtx})}if(mapping.reverse&&!container.every(c=>["@index","@set"].includes(c))){throw new JsonLdError("Invalid JSON-LD syntax; @context @container value for a @reverse "+"type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}mapping["@container"]=container}if("@index"in value){if(!("@container"in value)||!mapping["@container"].includes("@index")){throw new JsonLdError("Invalid JSON-LD syntax; @index without @index in @container: "+`"${value["@index"]}" on term "${term}".`,"jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}if(!_isString(value["@index"])||value["@index"].indexOf("@")===0){throw new JsonLdError("Invalid JSON-LD syntax; @index must expand to an IRI: "+`"${value["@index"]}" on term "${term}".`,"jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}mapping["@index"]=value["@index"]}if("@context"in value){mapping["@context"]=value["@context"]}if("@language"in value&&!("@type"in value)){let language=value["@language"];if(language!==null&&!_isString(language)){throw new JsonLdError("Invalid JSON-LD syntax; @context @language value must be "+"a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:localCtx})}if(language!==null){language=language.toLowerCase()}mapping["@language"]=language}if("@prefix"in value){if(term.match(/:|\//)){throw new JsonLdError("Invalid JSON-LD syntax; @context @prefix used on a compact IRI term","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}if(api.isKeyword(mapping["@id"])){throw new JsonLdError("Invalid JSON-LD syntax; keywords may not be used as prefixes","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}if(typeof value["@prefix"]==="boolean"){mapping._prefix=value["@prefix"]===true}else{throw new JsonLdError("Invalid JSON-LD syntax; @context value for @prefix must be boolean","jsonld.SyntaxError",{code:"invalid @prefix value",context:localCtx})}}if("@direction"in value){const direction=value["@direction"];if(direction!==null&&direction!=="ltr"&&direction!=="rtl"){throw new JsonLdError("Invalid JSON-LD syntax; @direction value must be "+'null, "ltr", or "rtl".',"jsonld.SyntaxError",{code:"invalid base direction",context:localCtx})}mapping["@direction"]=direction}if("@nest"in value){const nest=value["@nest"];if(!_isString(nest)||nest!=="@nest"&&nest.indexOf("@")===0){throw new JsonLdError("Invalid JSON-LD syntax; @context @nest value must be "+"a string which is not a keyword other than @nest.","jsonld.SyntaxError",{code:"invalid @nest value",context:localCtx})}mapping["@nest"]=nest}
// disallow aliasing @context and @preserve
const id=mapping["@id"];if(id==="@context"||id==="@preserve"){throw new JsonLdError("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:localCtx})}if(previousMapping&&previousMapping.protected&&!overrideProtected){activeCtx.protected[term]=true;mapping.protected=true;if(!_deepCompare(previousMapping,mapping)){const protectedMode=options&&options.protectedMode||"error";if(protectedMode==="error"){throw new JsonLdError("Invalid JSON-LD syntax; tried to redefine a protected term.","jsonld.SyntaxError",{code:"protected term redefinition",context:localCtx,term:term})}else if(protectedMode==="warn"){console.warn("WARNING: protected term redefinition",{term:term});return}throw new JsonLdError("Invalid protectedMode.","jsonld.SyntaxError",{code:"invalid protected mode",context:localCtx,term:term,protectedMode:protectedMode})}}};api.expandIri=(activeCtx,value,relativeTo,options)=>_expandIri(activeCtx,value,relativeTo,undefined,undefined,options);function _expandIri(activeCtx,value,relativeTo,localCtx,defined,options){if(value===null||!_isString(value)||api.isKeyword(value)){return value}if(value.match(KEYWORD_PATTERN)){return null}if(localCtx&&localCtx.hasOwnProperty(value)&&defined.get(value)!==true){api.createTermDefinition({activeCtx:activeCtx,localCtx:localCtx,term:value,defined:defined,options:options})}relativeTo=relativeTo||{};if(relativeTo.vocab){const mapping=activeCtx.mappings.get(value);if(mapping===null){return null}if(_isObject(mapping)&&"@id"in mapping){return mapping["@id"]}}const colon=value.indexOf(":");if(colon>0){const prefix=value.substr(0,colon);const suffix=value.substr(colon+1);if(prefix==="_"||suffix.indexOf("//")===0){return value}if(localCtx&&localCtx.hasOwnProperty(prefix)){api.createTermDefinition({activeCtx:activeCtx,localCtx:localCtx,term:prefix,defined:defined,options:options})}const mapping=activeCtx.mappings.get(prefix);if(mapping&&mapping._prefix){return mapping["@id"]+suffix}if(_isAbsoluteIri(value)){return value}}if(relativeTo.vocab&&"@vocab"in activeCtx){return activeCtx["@vocab"]+value}if(relativeTo.base&&"@base"in activeCtx){if(activeCtx["@base"]){return prependBase(prependBase(options.base,activeCtx["@base"]),value)}}else if(relativeTo.base){return prependBase(options.base,value)}return value}api.getInitialContext=options=>{const key=JSON.stringify({processingMode:options.processingMode});const cached=INITIAL_CONTEXT_CACHE.get(key);if(cached){return cached}const initialContext={processingMode:options.processingMode,mappings:new Map,inverse:null,getInverse:_createInverseContext,clone:_cloneActiveContext,revertToPreviousContext:_revertToPreviousContext,protected:{}};if(INITIAL_CONTEXT_CACHE.size===INITIAL_CONTEXT_CACHE_MAX_SIZE){INITIAL_CONTEXT_CACHE.clear()}INITIAL_CONTEXT_CACHE.set(key,initialContext);return initialContext;function _createInverseContext(){const activeCtx=this;if(activeCtx.inverse){return activeCtx.inverse}const inverse=activeCtx.inverse={};const fastCurieMap=activeCtx.fastCurieMap={};const irisToTerms={};const defaultLanguage=(activeCtx["@language"]||"@none").toLowerCase();const defaultDirection=activeCtx["@direction"];const mappings=activeCtx.mappings;const terms=[...mappings.keys()].sort(_compareShortestLeast);for(const term of terms){const mapping=mappings.get(term);if(mapping===null){continue}let container=mapping["@container"]||"@none";container=[].concat(container).sort().join("");if(mapping["@id"]===null){continue}const ids=_asArray(mapping["@id"]);for(const iri of ids){let entry=inverse[iri];const isKeyword=api.isKeyword(iri);if(!entry){inverse[iri]=entry={};if(!isKeyword&&!mapping._termHasColon){irisToTerms[iri]=[term];const fastCurieEntry={iri:iri,terms:irisToTerms[iri]};if(iri[0]in fastCurieMap){fastCurieMap[iri[0]].push(fastCurieEntry)}else{fastCurieMap[iri[0]]=[fastCurieEntry]}}}else if(!isKeyword&&!mapping._termHasColon){irisToTerms[iri].push(term)}if(!entry[container]){entry[container]={"@language":{},"@type":{},"@any":{}}}entry=entry[container];_addPreferredTerm(term,entry["@any"],"@none");if(mapping.reverse){_addPreferredTerm(term,entry["@type"],"@reverse")}else if(mapping["@type"]==="@none"){_addPreferredTerm(term,entry["@any"],"@none");_addPreferredTerm(term,entry["@language"],"@none");_addPreferredTerm(term,entry["@type"],"@none")}else if("@type"in mapping){_addPreferredTerm(term,entry["@type"],mapping["@type"])}else if("@language"in mapping&&"@direction"in mapping){const language=mapping["@language"];const direction=mapping["@direction"];if(language&&direction){_addPreferredTerm(term,entry["@language"],`${language}_${direction}`.toLowerCase())}else if(language){_addPreferredTerm(term,entry["@language"],language.toLowerCase())}else if(direction){_addPreferredTerm(term,entry["@language"],`_${direction}`)}else{_addPreferredTerm(term,entry["@language"],"@null")}}else if("@language"in mapping){_addPreferredTerm(term,entry["@language"],(mapping["@language"]||"@null").toLowerCase())}else if("@direction"in mapping){if(mapping["@direction"]){_addPreferredTerm(term,entry["@language"],`_${mapping["@direction"]}`)}else{_addPreferredTerm(term,entry["@language"],"@none")}}else if(defaultDirection){_addPreferredTerm(term,entry["@language"],`_${defaultDirection}`);_addPreferredTerm(term,entry["@language"],"@none");_addPreferredTerm(term,entry["@type"],"@none")}else{_addPreferredTerm(term,entry["@language"],defaultLanguage);_addPreferredTerm(term,entry["@language"],"@none");_addPreferredTerm(term,entry["@type"],"@none")}}}for(const key in fastCurieMap){_buildIriMap(fastCurieMap,key,1)}return inverse}function _buildIriMap(iriMap,key,idx){const entries=iriMap[key];const next=iriMap[key]={};let iri;let letter;for(const entry of entries){iri=entry.iri;if(idx>=iri.length){letter=""}else{letter=iri[idx]}if(letter in next){next[letter].push(entry)}else{next[letter]=[entry]}}for(const key in next){if(key===""){continue}_buildIriMap(next,key,idx+1)}}function _addPreferredTerm(term,entry,typeOrLanguageValue){if(!entry.hasOwnProperty(typeOrLanguageValue)){entry[typeOrLanguageValue]=term}}function _cloneActiveContext(){const child={};child.mappings=util.clone(this.mappings);child.clone=this.clone;child.inverse=null;child.getInverse=this.getInverse;child.protected=util.clone(this.protected);if(this.previousContext){child.previousContext=this.previousContext.clone()}child.revertToPreviousContext=this.revertToPreviousContext;if("@base"in this){child["@base"]=this["@base"]}if("@language"in this){child["@language"]=this["@language"]}if("@vocab"in this){child["@vocab"]=this["@vocab"]}return child}function _revertToPreviousContext(){if(!this.previousContext){return this}return this.previousContext.clone()}};api.getContextValue=(ctx,key,type)=>{if(key===null){if(type==="@context"){return undefined}return null}if(ctx.mappings.has(key)){const entry=ctx.mappings.get(key);if(_isUndefined(type)){return entry}if(entry.hasOwnProperty(type)){return entry[type]}}if(type==="@language"&&type in ctx){return ctx[type]}if(type==="@direction"&&type in ctx){return ctx[type]}if(type==="@context"){return undefined}return null};api.processingMode=(activeCtx,version)=>{if(version.toString()>="1.1"){return!activeCtx.processingMode||activeCtx.processingMode>="json-ld-"+version.toString()}else{return activeCtx.processingMode==="json-ld-1.0"}};api.isKeyword=v=>{if(!_isString(v)||v[0]!=="@"){return false}switch(v){case"@base":case"@container":case"@context":case"@default":case"@direction":case"@embed":case"@explicit":case"@graph":case"@id":case"@included":case"@index":case"@json":case"@language":case"@list":case"@nest":case"@none":case"@omitDefault":case"@prefix":case"@preserve":case"@protected":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@version":case"@vocab":return true}return false};function _deepCompare(x1,x2){if(!(x1&&typeof x1==="object")||!(x2&&typeof x2==="object")){return x1===x2}const x1Array=Array.isArray(x1);if(x1Array!==Array.isArray(x2)){return false}if(x1Array){if(x1.length!==x2.length){return false}for(let i=0;i<x1.length;++i){if(!_deepCompare(x1[i],x2[i])){return false}}return true}const k1s=Object.keys(x1);const k2s=Object.keys(x2);if(k1s.length!==k2s.length){return false}for(const k1 in x1){let v1=x1[k1];let v2=x2[k1];if(k1==="@container"){if(Array.isArray(v1)&&Array.isArray(v2)){v1=v1.slice().sort();v2=v2.slice().sort()}}if(!_deepCompare(v1,v2)){return false}}return true}},{"./JsonLdError":50,"./types":69,"./url":70,"./util":71}],59:[function(require,module,exports){"use strict";const{parseLinkHeader:parseLinkHeader,buildHeaders:buildHeaders}=require("../util");const{LINK_HEADER_CONTEXT:LINK_HEADER_CONTEXT}=require("../constants");const JsonLdError=require("../JsonLdError");const RequestQueue=require("../RequestQueue");const{prependBase:prependBase}=require("../url");module.exports=({secure:secure,strictSSL:strictSSL=true,maxRedirects:maxRedirects=-1,request:request,headers:headers={}}={strictSSL:true,maxRedirects:-1,headers:{}})=>{headers=buildHeaders(headers);request=request||require("request");const http=require("http");const queue=new RequestQueue;return queue.wrapLoader((function(url){return loadDocument(url,[])}));async function loadDocument(url,redirects){if(url.indexOf("http:")!==0&&url.indexOf("https:")!==0){throw new JsonLdError('URL could not be dereferenced; only "http" and "https" URLs are '+"supported.","jsonld.InvalidUrl",{code:"loading document failed",url:url})}if(secure&&url.indexOf("https")!==0){throw new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url})}let doc=null;if(doc!==null){return doc}let result;let alternate=null;try{result=await _request(request,{url:url,headers:headers,strictSSL:strictSSL,followRedirect:false})}catch(e){throw new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url,cause:e})}const{res:res,body:body}=result;doc={contextUrl:null,documentUrl:url,document:body||null};const statusText=http.STATUS_CODES[res.statusCode];if(res.statusCode>=400){throw new JsonLdError(`URL "${url}" could not be dereferenced: ${statusText}`,"jsonld.InvalidUrl",{code:"loading document failed",url:url,httpStatusCode:res.statusCode})}if(res.headers.link&&res.headers["content-type"]!=="application/ld+json"){const linkHeaders=parseLinkHeader(res.headers.link);const linkedContext=linkHeaders[LINK_HEADER_CONTEXT];if(Array.isArray(linkedContext)){throw new JsonLdError("URL could not be dereferenced, it has more than one associated "+"HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url})}if(linkedContext){doc.contextUrl=linkedContext.target}alternate=linkHeaders["alternate"];if(alternate&&alternate.type=="application/ld+json"&&!(res.headers["content-type"]||"").match(/^application\/(\w*\+)?json$/)){res.headers.location=prependBase(url,alternate.target)}}if((alternate||res.statusCode>=300&&res.statusCode<400)&&res.headers.location){if(redirects.length===maxRedirects){throw new JsonLdError("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:url,httpStatusCode:res.statusCode,redirects:redirects})}if(redirects.indexOf(url)!==-1){throw new JsonLdError("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:url,httpStatusCode:res.statusCode,redirects:redirects})}redirects.push(url);return loadDocument(res.headers.location,redirects)}redirects.push(url);return doc}};function _request(request,options){return new Promise((resolve,reject)=>{request(options,(err,res,body)=>{if(err){reject(err)}else{resolve({res:res,body:body})}})})}},{"../JsonLdError":50,"../RequestQueue":54,"../constants":57,"../url":70,"../util":71,http:44,request:44}],60:[function(require,module,exports){"use strict";const{parseLinkHeader:parseLinkHeader,buildHeaders:buildHeaders}=require("../util");const{LINK_HEADER_CONTEXT:LINK_HEADER_CONTEXT}=require("../constants");const JsonLdError=require("../JsonLdError");const RequestQueue=require("../RequestQueue");const{prependBase:prependBase}=require("../url");const REGEX_LINK_HEADER=/(^|(\r\n))link:/i;module.exports=({secure:secure,headers:headers={},xhr:xhr}={headers:{}})=>{headers=buildHeaders(headers);const queue=new RequestQueue;return queue.wrapLoader(loader);async function loader(url){if(url.indexOf("http:")!==0&&url.indexOf("https:")!==0){throw new JsonLdError('URL could not be dereferenced; only "http" and "https" URLs are '+"supported.","jsonld.InvalidUrl",{code:"loading document failed",url:url})}if(secure&&url.indexOf("https")!==0){throw new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url})}let req;try{req=await _get(xhr,url,headers)}catch(e){throw new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url,cause:e})}if(req.status>=400){throw new JsonLdError("URL could not be dereferenced: "+req.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:url,httpStatusCode:req.status})}let doc={contextUrl:null,documentUrl:url,document:req.response};let alternate=null;const contentType=req.getResponseHeader("Content-Type");let linkHeader;if(REGEX_LINK_HEADER.test(req.getAllResponseHeaders())){linkHeader=req.getResponseHeader("Link")}if(linkHeader&&contentType!=="application/ld+json"){const linkHeaders=parseLinkHeader(linkHeader);const linkedContext=linkHeaders[LINK_HEADER_CONTEXT];if(Array.isArray(linkedContext)){throw new JsonLdError("URL could not be dereferenced, it has more than one "+"associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url})}if(linkedContext){doc.contextUrl=linkedContext.target}alternate=linkHeaders["alternate"];if(alternate&&alternate.type=="application/ld+json"&&!(contentType||"").match(/^application\/(\w*\+)?json$/)){doc=await loader(prependBase(url,alternate.target))}}return doc}};function _get(xhr,url,headers){xhr=xhr||XMLHttpRequest;const req=new xhr;return new Promise((resolve,reject)=>{req.onload=()=>resolve(req);req.onerror=err=>reject(err);req.open("GET",url,true);for(const k in headers){req.setRequestHeader(k,headers[k])}req.send()})}},{"../JsonLdError":50,"../RequestQueue":54,"../constants":57,"../url":70,"../util":71}],61:[function(require,module,exports){"use strict";const JsonLdError=require("./JsonLdError");const{isArray:_isArray,isObject:_isObject,isEmptyObject:_isEmptyObject,isString:_isString,isUndefined:_isUndefined}=require("./types");const{isList:_isList,isValue:_isValue,isGraph:_isGraph,isSubject:_isSubject}=require("./graphTypes");const{expandIri:_expandIri,getContextValue:_getContextValue,isKeyword:_isKeyword,process:_processContext,processingMode:_processingMode}=require("./context");const{isAbsolute:_isAbsoluteIri}=require("./url");const{addValue:_addValue,asArray:_asArray,getValues:_getValues,validateTypeValue:_validateTypeValue}=require("./util");const api={};module.exports=api;const REGEX_BCP47=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/;api.expand=async({activeCtx:activeCtx,activeProperty:activeProperty=null,element:element,options:options={},insideList:insideList=false,insideIndex:insideIndex=false,typeScopedContext:typeScopedContext=null,expansionMap:expansionMap=(()=>undefined)})=>{if(element===null||element===undefined){return null}if(activeProperty==="@default"){options=Object.assign({},options,{isFrame:false})}if(!_isArray(element)&&!_isObject(element)){if(!insideList&&(activeProperty===null||_expandIri(activeCtx,activeProperty,{vocab:true},options)==="@graph")){const mapped=await expansionMap({unmappedValue:element,activeCtx:activeCtx,activeProperty:activeProperty,options:options,insideList:insideList});if(mapped===undefined){return null}return mapped}return _expandValue({activeCtx:activeCtx,activeProperty:activeProperty,value:element,options:options})}if(_isArray(element)){let rval=[];const container=_getContextValue(activeCtx,activeProperty,"@container")||[];insideList=insideList||container.includes("@list");for(let i=0;i<element.length;++i){let e=await api.expand({activeCtx:activeCtx,activeProperty:activeProperty,element:element[i],options:options,expansionMap:expansionMap,insideIndex:insideIndex,typeScopedContext:typeScopedContext});if(insideList&&_isArray(e)){e={"@list":e}}if(e===null){e=await expansionMap({unmappedValue:element[i],activeCtx:activeCtx,activeProperty:activeProperty,parent:element,index:i,options:options,expandedParent:rval,insideList:insideList});if(e===undefined){continue}}if(_isArray(e)){rval=rval.concat(e)}else{rval.push(e)}}return rval}const expandedActiveProperty=_expandIri(activeCtx,activeProperty,{vocab:true},options);const propertyScopedCtx=_getContextValue(activeCtx,activeProperty,"@context");typeScopedContext=typeScopedContext||(activeCtx.previousContext?activeCtx:null);let keys=Object.keys(element).sort();let mustRevert=!insideIndex;if(mustRevert&&typeScopedContext&&keys.length<=2&&!keys.includes("@context")){for(const key of keys){const expandedProperty=_expandIri(typeScopedContext,key,{vocab:true},options);if(expandedProperty==="@value"){mustRevert=false;activeCtx=typeScopedContext;break}if(expandedProperty==="@id"&&keys.length===1){mustRevert=false;break}}}if(mustRevert){activeCtx=activeCtx.revertToPreviousContext()}if(!_isUndefined(propertyScopedCtx)){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:propertyScopedCtx,propagate:true,overrideProtected:true,options:options})}if("@context"in element){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:element["@context"],options:options})}typeScopedContext=activeCtx;let typeKey=null;for(const key of keys){const expandedProperty=_expandIri(activeCtx,key,{vocab:true},options);if(expandedProperty==="@type"){typeKey=typeKey||key;const value=element[key];const types=Array.isArray(value)?value.length>1?value.slice().sort():value:[value];for(const type of types){const ctx=_getContextValue(typeScopedContext,type,"@context");if(!_isUndefined(ctx)){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:ctx,options:options,propagate:false})}}}}let rval={};await _expandObject({activeCtx:activeCtx,activeProperty:activeProperty,expandedActiveProperty:expandedActiveProperty,element:element,expandedParent:rval,options:options,insideList:insideList,typeKey:typeKey,typeScopedContext:typeScopedContext,expansionMap:expansionMap});keys=Object.keys(rval);let count=keys.length;if("@value"in rval){if("@type"in rval&&("@language"in rval||"@direction"in rval)){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" may not '+'contain both "@type" and either "@language" or "@direction".',"jsonld.SyntaxError",{code:"invalid value object",element:rval})}let validCount=count-1;if("@type"in rval){validCount-=1}if("@index"in rval){validCount-=1}if("@language"in rval){validCount-=1}if("@direction"in rval){validCount-=1}if(validCount!==0){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" may only '+'have an "@index" property and either "@type" '+'or either or both "@language" or "@direction".',"jsonld.SyntaxError",{code:"invalid value object",element:rval})}const values=rval["@value"]===null?[]:_asArray(rval["@value"]);const types=_getValues(rval,"@type");if(_processingMode(activeCtx,1.1)&&types.includes("@json")&&types.length===1){}else if(values.length===0){const mapped=await expansionMap({unmappedValue:rval,activeCtx:activeCtx,activeProperty:activeProperty,element:element,options:options,insideList:insideList});if(mapped!==undefined){rval=mapped}else{rval=null}}else if(!values.every(v=>_isString(v)||_isEmptyObject(v))&&"@language"in rval){throw new JsonLdError("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:rval})}else if(!types.every(t=>_isAbsoluteIri(t)&&!(_isString(t)&&t.indexOf("_:")===0)||_isEmptyObject(t))){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" and "@type" '+'must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:rval})}}else if("@type"in rval&&!_isArray(rval["@type"])){rval["@type"]=[rval["@type"]]}else if("@set"in rval||"@list"in rval){if(count>1&&!(count===2&&"@index"in rval)){throw new JsonLdError('Invalid JSON-LD syntax; if an element has the property "@set" '+'or "@list", then it can have at most one other property that is '+'"@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:rval})}if("@set"in rval){rval=rval["@set"];keys=Object.keys(rval);count=keys.length}}else if(count===1&&"@language"in rval){const mapped=await expansionMap(rval,{unmappedValue:rval,activeCtx:activeCtx,activeProperty:activeProperty,element:element,options:options,insideList:insideList});if(mapped!==undefined){rval=mapped}else{rval=null}}if(_isObject(rval)&&!options.keepFreeFloatingNodes&&!insideList&&(activeProperty===null||expandedActiveProperty==="@graph")){if(count===0||"@value"in rval||"@list"in rval||count===1&&"@id"in rval){const mapped=await expansionMap({unmappedValue:rval,activeCtx:activeCtx,activeProperty:activeProperty,element:element,options:options,insideList:insideList});if(mapped!==undefined){rval=mapped}else{rval=null}}}return rval};async function _expandObject({activeCtx:activeCtx,activeProperty:activeProperty,expandedActiveProperty:expandedActiveProperty,element:element,expandedParent:expandedParent,options:options={},insideList:insideList,typeKey:typeKey,typeScopedContext:typeScopedContext,expansionMap:expansionMap}){const keys=Object.keys(element).sort();const nests=[];let unexpandedValue;const isJsonType=element[typeKey]&&_expandIri(activeCtx,_isArray(element[typeKey])?element[typeKey][0]:element[typeKey],{vocab:true},options)==="@json";for(const key of keys){let value=element[key];let expandedValue;if(key==="@context"){continue}let expandedProperty=_expandIri(activeCtx,key,{vocab:true},options);if(expandedProperty===null||!(_isAbsoluteIri(expandedProperty)||_isKeyword(expandedProperty))){expandedProperty=expansionMap({unmappedProperty:key,activeCtx:activeCtx,activeProperty:activeProperty,parent:element,options:options,insideList:insideList,value:value,expandedParent:expandedParent});if(expandedProperty===undefined){continue}}if(_isKeyword(expandedProperty)){if(expandedActiveProperty==="@reverse"){throw new JsonLdError("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse "+"property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:value})}if(expandedProperty in expandedParent&&expandedProperty!=="@included"&&expandedProperty!=="@type"){throw new JsonLdError("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:expandedProperty})}}if(expandedProperty==="@id"){if(!_isString(value)){if(!options.isFrame){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:value})}if(_isObject(value)){if(!_isEmptyObject(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value an empty object or array '+"of strings, if framing","jsonld.SyntaxError",{code:"invalid @id value",value:value})}}else if(_isArray(value)){if(!value.every(v=>_isString(v))){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value an empty object or array '+"of strings, if framing","jsonld.SyntaxError",{code:"invalid @id value",value:value})}}else{throw new JsonLdError('Invalid JSON-LD syntax; "@id" value an empty object or array '+"of strings, if framing","jsonld.SyntaxError",{code:"invalid @id value",value:value})}}_addValue(expandedParent,"@id",_asArray(value).map(v=>_isString(v)?_expandIri(activeCtx,v,{base:true},options):v),{propertyIsArray:options.isFrame});continue}if(expandedProperty==="@type"){if(_isObject(value)){value=Object.fromEntries(Object.entries(value).map(([k,v])=>[_expandIri(typeScopedContext,k,{vocab:true}),_asArray(v).map(vv=>_expandIri(typeScopedContext,vv,{base:true,vocab:true}))]))}_validateTypeValue(value,options.isFrame);_addValue(expandedParent,"@type",_asArray(value).map(v=>_isString(v)?_expandIri(typeScopedContext,v,{base:true,vocab:true},options):v),{propertyIsArray:options.isFrame});continue}if(expandedProperty==="@included"&&_processingMode(activeCtx,1.1)){const includedResult=_asArray(await api.expand({activeCtx:activeCtx,activeProperty:activeProperty,element:value,options:options,expansionMap:expansionMap}));if(!includedResult.every(v=>_isSubject(v))){throw new JsonLdError("Invalid JSON-LD syntax; "+"values of @included must expand to node objects.","jsonld.SyntaxError",{code:"invalid @included value",value:value})}_addValue(expandedParent,"@included",includedResult,{propertyIsArray:true});continue}if(expandedProperty==="@graph"&&!(_isObject(value)||_isArray(value))){throw new JsonLdError('Invalid JSON-LD syntax; "@graph" value must not be an '+"object or an array.","jsonld.SyntaxError",{code:"invalid @graph value",value:value})}if(expandedProperty==="@value"){unexpandedValue=value;if(isJsonType&&_processingMode(activeCtx,1.1)){expandedParent["@value"]=value}else{_addValue(expandedParent,"@value",value,{propertyIsArray:options.isFrame})}continue}if(expandedProperty==="@language"){if(value===null){continue}if(!_isString(value)&&!options.isFrame){throw new JsonLdError('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:value})}value=_asArray(value).map(v=>_isString(v)?v.toLowerCase():v);for(const lang of value){if(_isString(lang)&&!lang.match(REGEX_BCP47)){console.warn(`@language must be valid BCP47: ${lang}`)}}_addValue(expandedParent,"@language",value,{propertyIsArray:options.isFrame});continue}if(expandedProperty==="@direction"){if(!_isString(value)&&!options.isFrame){throw new JsonLdError('Invalid JSON-LD syntax; "@direction" value must be a string.',"jsonld.SyntaxError",{code:"invalid base direction",value:value})}value=_asArray(value);for(const dir of value){if(_isString(dir)&&dir!=="ltr"&&dir!=="rtl"){throw new JsonLdError('Invalid JSON-LD syntax; "@direction" must be "ltr" or "rtl".',"jsonld.SyntaxError",{code:"invalid base direction",value:value})}}_addValue(expandedParent,"@direction",value,{propertyIsArray:options.isFrame});continue}if(expandedProperty==="@index"){if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:value})}_addValue(expandedParent,"@index",value);continue}if(expandedProperty==="@reverse"){if(!_isObject(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:value})}expandedValue=await api.expand({activeCtx:activeCtx,activeProperty:"@reverse",element:value,options:options,expansionMap:expansionMap});if("@reverse"in expandedValue){for(const property in expandedValue["@reverse"]){_addValue(expandedParent,property,expandedValue["@reverse"][property],{propertyIsArray:true})}}let reverseMap=expandedParent["@reverse"]||null;for(const property in expandedValue){if(property==="@reverse"){continue}if(reverseMap===null){reverseMap=expandedParent["@reverse"]={}}_addValue(reverseMap,property,[],{propertyIsArray:true});const items=expandedValue[property];for(let ii=0;ii<items.length;++ii){const item=items[ii];if(_isValue(item)||_isList(item)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must not be a '+"@value or an @list.","jsonld.SyntaxError",{code:"invalid reverse property value",value:expandedValue})}_addValue(reverseMap,property,item,{propertyIsArray:true})}}continue}if(expandedProperty==="@nest"){nests.push(key);continue}let termCtx=activeCtx;const ctx=_getContextValue(activeCtx,key,"@context");if(!_isUndefined(ctx)){termCtx=await _processContext({activeCtx:activeCtx,localCtx:ctx,propagate:true,overrideProtected:true,options:options})}const container=_getContextValue(termCtx,key,"@container")||[];if(container.includes("@language")&&_isObject(value)){const direction=_getContextValue(termCtx,key,"@direction");expandedValue=_expandLanguageMap(termCtx,value,direction,options)}else if(container.includes("@index")&&_isObject(value)){const asGraph=container.includes("@graph");const indexKey=_getContextValue(termCtx,key,"@index")||"@index";const propertyIndex=indexKey!=="@index"&&_expandIri(activeCtx,indexKey,{vocab:true},options);expandedValue=await _expandIndexMap({activeCtx:termCtx,options:options,activeProperty:key,value:value,expansionMap:expansionMap,asGraph:asGraph,indexKey:indexKey,propertyIndex:propertyIndex})}else if(container.includes("@id")&&_isObject(value)){const asGraph=container.includes("@graph");expandedValue=await _expandIndexMap({activeCtx:termCtx,options:options,activeProperty:key,value:value,expansionMap:expansionMap,asGraph:asGraph,indexKey:"@id"})}else if(container.includes("@type")&&_isObject(value)){expandedValue=await _expandIndexMap({activeCtx:termCtx.revertToPreviousContext(),options:options,activeProperty:key,value:value,expansionMap:expansionMap,asGraph:false,indexKey:"@type"})}else{const isList=expandedProperty==="@list";if(isList||expandedProperty==="@set"){let nextActiveProperty=activeProperty;if(isList&&expandedActiveProperty==="@graph"){nextActiveProperty=null}expandedValue=await api.expand({activeCtx:termCtx,activeProperty:nextActiveProperty,element:value,options:options,insideList:isList,expansionMap:expansionMap})}else if(_getContextValue(activeCtx,key,"@type")==="@json"){expandedValue={"@type":"@json","@value":value}}else{expandedValue=await api.expand({activeCtx:termCtx,activeProperty:key,element:value,options:options,insideList:false,expansionMap:expansionMap})}}if(expandedValue===null&&expandedProperty!=="@value"){expandedValue=expansionMap({unmappedValue:value,expandedProperty:expandedProperty,activeCtx:termCtx,activeProperty:activeProperty,parent:element,options:options,insideList:insideList,key:key,expandedParent:expandedParent});if(expandedValue===undefined){continue}}if(expandedProperty!=="@list"&&!_isList(expandedValue)&&container.includes("@list")){expandedValue={"@list":_asArray(expandedValue)}}if(container.includes("@graph")&&!container.some(key=>key==="@id"||key==="@index")){expandedValue=_asArray(expandedValue).map(v=>({"@graph":_asArray(v)}))}if(termCtx.mappings.has(key)&&termCtx.mappings.get(key).reverse){const reverseMap=expandedParent["@reverse"]=expandedParent["@reverse"]||{};expandedValue=_asArray(expandedValue);for(let ii=0;ii<expandedValue.length;++ii){const item=expandedValue[ii];if(_isValue(item)||_isList(item)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must not be a '+"@value or an @list.","jsonld.SyntaxError",{code:"invalid reverse property value",value:expandedValue})}_addValue(reverseMap,expandedProperty,item,{propertyIsArray:true})}continue}_addValue(expandedParent,expandedProperty,expandedValue,{propertyIsArray:true})}if("@value"in expandedParent){if(expandedParent["@type"]==="@json"&&_processingMode(activeCtx,1.1)){}else if((_isObject(unexpandedValue)||_isArray(unexpandedValue))&&!options.isFrame){throw new JsonLdError('Invalid JSON-LD syntax; "@value" value must not be an '+"object or an array.","jsonld.SyntaxError",{code:"invalid value object value",value:unexpandedValue})}}for(const key of nests){const nestedValues=_isArray(element[key])?element[key]:[element[key]];for(const nv of nestedValues){if(!_isObject(nv)||Object.keys(nv).some(k=>_expandIri(activeCtx,k,{vocab:true},options)==="@value")){throw new JsonLdError("Invalid JSON-LD syntax; nested value must be a node object.","jsonld.SyntaxError",{code:"invalid @nest value",value:nv})}await _expandObject({activeCtx:activeCtx,activeProperty:activeProperty,expandedActiveProperty:expandedActiveProperty,element:nv,expandedParent:expandedParent,options:options,insideList:insideList,typeScopedContext:typeScopedContext,typeKey:typeKey,expansionMap:expansionMap})}}}function _expandValue({activeCtx:activeCtx,activeProperty:activeProperty,value:value,options:options}){if(value===null||value===undefined){return null}const expandedProperty=_expandIri(activeCtx,activeProperty,{vocab:true},options);if(expandedProperty==="@id"){return _expandIri(activeCtx,value,{base:true},options)}else if(expandedProperty==="@type"){return _expandIri(activeCtx,value,{vocab:true,base:true},options)}const type=_getContextValue(activeCtx,activeProperty,"@type");if((type==="@id"||expandedProperty==="@graph")&&_isString(value)){return{"@id":_expandIri(activeCtx,value,{base:true},options)}}if(type==="@vocab"&&_isString(value)){return{"@id":_expandIri(activeCtx,value,{vocab:true,base:true},options)}}if(_isKeyword(expandedProperty)){return value}const rval={};if(type&&!["@id","@vocab","@none"].includes(type)){rval["@type"]=type}else if(_isString(value)){const language=_getContextValue(activeCtx,activeProperty,"@language");if(language!==null){rval["@language"]=language}const direction=_getContextValue(activeCtx,activeProperty,"@direction");if(direction!==null){rval["@direction"]=direction}}if(!["boolean","number","string"].includes(typeof value)){value=value.toString()}rval["@value"]=value;return rval}function _expandLanguageMap(activeCtx,languageMap,direction,options){const rval=[];const keys=Object.keys(languageMap).sort();for(const key of keys){const expandedKey=_expandIri(activeCtx,key,{vocab:true},options);let val=languageMap[key];if(!_isArray(val)){val=[val]}for(const item of val){if(item===null){continue}if(!_isString(item)){throw new JsonLdError("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:languageMap})}const val={"@value":item};if(expandedKey!=="@none"){val["@language"]=key.toLowerCase()}if(direction){val["@direction"]=direction}rval.push(val)}}return rval}async function _expandIndexMap({activeCtx:activeCtx,options:options,activeProperty:activeProperty,value:value,expansionMap:expansionMap,asGraph:asGraph,indexKey:indexKey,propertyIndex:propertyIndex}){const rval=[];const keys=Object.keys(value).sort();const isTypeIndex=indexKey==="@type";for(let key of keys){if(isTypeIndex){const ctx=_getContextValue(activeCtx,key,"@context");if(!_isUndefined(ctx)){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:ctx,propagate:false,options:options})}}let val=value[key];if(!_isArray(val)){val=[val]}val=await api.expand({activeCtx:activeCtx,activeProperty:activeProperty,element:val,options:options,insideList:false,insideIndex:true,expansionMap:expansionMap});let expandedKey;if(propertyIndex){if(key==="@none"){expandedKey="@none"}else{expandedKey=_expandValue({activeCtx:activeCtx,activeProperty:indexKey,value:key,options:options})}}else{expandedKey=_expandIri(activeCtx,key,{vocab:true},options)}if(indexKey==="@id"){key=_expandIri(activeCtx,key,{base:true},options)}else if(isTypeIndex){key=expandedKey}for(let item of val){if(asGraph&&!_isGraph(item)){item={"@graph":[item]}}if(indexKey==="@type"){if(expandedKey==="@none"){}else if(item["@type"]){item["@type"]=[key].concat(item["@type"])}else{item["@type"]=[key]}}else if(_isValue(item)&&!["@language","@type","@index"].includes(indexKey)){throw new JsonLdError("Invalid JSON-LD syntax; Attempt to add illegal key to value "+`object: "${indexKey}".`,"jsonld.SyntaxError",{code:"invalid value object",value:item})}else if(propertyIndex){if(expandedKey!=="@none"){_addValue(item,propertyIndex,expandedKey,{propertyIsArray:true,prependValue:true})}}else if(expandedKey!=="@none"&&!(indexKey in item)){item[indexKey]=key}rval.push(item)}}return rval}},{"./JsonLdError":50,"./context":58,"./graphTypes":65,"./types":69,"./url":70,"./util":71}],62:[function(require,module,exports){"use strict";const{isSubjectReference:_isSubjectReference}=require("./graphTypes");const{createMergedNodeMap:_createMergedNodeMap}=require("./nodeMap");const api={};module.exports=api;api.flatten=input=>{const defaultGraph=_createMergedNodeMap(input);const flattened=[];const keys=Object.keys(defaultGraph).sort();for(let ki=0;ki<keys.length;++ki){const node=defaultGraph[keys[ki]];if(!_isSubjectReference(node)){flattened.push(node)}}return flattened}},{"./graphTypes":65,"./nodeMap":67}],63:[function(require,module,exports){"use strict";const{isKeyword:isKeyword}=require("./context");const graphTypes=require("./graphTypes");const types=require("./types");const util=require("./util");const url=require("./url");const JsonLdError=require("./JsonLdError");const{createNodeMap:_createNodeMap,mergeNodeMapGraphs:_mergeNodeMapGraphs}=require("./nodeMap");const api={};module.exports=api;api.frameMergedOrDefault=(input,frame,options)=>{const state={options:options,embedded:false,graph:"@default",graphMap:{"@default":{}},subjectStack:[],link:{},bnodeMap:{}};const issuer=new util.IdentifierIssuer("_:b");_createNodeMap(input,state.graphMap,"@default",issuer);if(options.merged){state.graphMap["@merged"]=_mergeNodeMapGraphs(state.graphMap);state.graph="@merged"}state.subjects=state.graphMap[state.graph];const framed=[];api.frame(state,Object.keys(state.subjects).sort(),frame,framed);if(options.pruneBlankNodeIdentifiers){options.bnodesToClear=Object.keys(state.bnodeMap).filter(id=>state.bnodeMap[id].length===1)}
// remove @preserve from results
options.link={};return _cleanupPreserve(framed,options)};api.frame=(state,subjects,frame,parent,property=null)=>{_validateFrame(frame);frame=frame[0];const options=state.options;const flags={embed:_getFrameFlag(frame,options,"embed"),explicit:_getFrameFlag(frame,options,"explicit"),requireAll:_getFrameFlag(frame,options,"requireAll")};if(!state.link.hasOwnProperty(state.graph)){state.link[state.graph]={}}const link=state.link[state.graph];const matches=_filterSubjects(state,subjects,frame,flags);const ids=Object.keys(matches).sort();for(const id of ids){const subject=matches[id];if(property===null){state.uniqueEmbeds={[state.graph]:{}}}else{state.uniqueEmbeds[state.graph]=state.uniqueEmbeds[state.graph]||{}}if(flags.embed==="@link"&&id in link){_addFrameOutput(parent,property,link[id]);continue}const output={"@id":id};if(id.indexOf("_:")===0){util.addValue(state.bnodeMap,id,output,{propertyIsArray:true})}link[id]=output;if((flags.embed==="@first"||flags.embed==="@last")&&state.is11){throw new JsonLdError("Invalid JSON-LD syntax; invalid value of @embed.","jsonld.SyntaxError",{code:"invalid @embed value",frame:frame})}if(!state.embedded&&state.uniqueEmbeds[state.graph].hasOwnProperty(id)){continue}if(state.embedded&&(flags.embed==="@never"||_createsCircularReference(subject,state.graph,state.subjectStack))){_addFrameOutput(parent,property,output);continue}if(state.embedded&&(flags.embed=="@first"||flags.embed=="@once")&&state.uniqueEmbeds[state.graph].hasOwnProperty(id)){_addFrameOutput(parent,property,output);continue}if(flags.embed==="@last"){if(id in state.uniqueEmbeds[state.graph]){_removeEmbed(state,id)}}state.uniqueEmbeds[state.graph][id]={parent:parent,property:property};state.subjectStack.push({subject:subject,graph:state.graph});if(id in state.graphMap){let recurse=false;let subframe=null;if(!("@graph"in frame)){recurse=state.graph!=="@merged";subframe={}}else{subframe=frame["@graph"][0];recurse=!(id==="@merged"||id==="@default");if(!types.isObject(subframe)){subframe={}}}if(recurse){api.frame({...state,graph:id,embedded:false},Object.keys(state.graphMap[id]).sort(),[subframe],output,"@graph")}}if("@included"in frame){api.frame({...state,embedded:false},subjects,frame["@included"],output,"@included")}for(const prop of Object.keys(subject).sort()){if(isKeyword(prop)){output[prop]=util.clone(subject[prop]);if(prop==="@type"){for(const type of subject["@type"]){if(type.indexOf("_:")===0){util.addValue(state.bnodeMap,type,output,{propertyIsArray:true})}}}continue}if(flags.explicit&&!(prop in frame)){continue}for(const o of subject[prop]){const subframe=prop in frame?frame[prop]:_createImplicitFrame(flags);if(graphTypes.isList(o)){const subframe=frame[prop]&&frame[prop][0]&&frame[prop][0]["@list"]?frame[prop][0]["@list"]:_createImplicitFrame(flags);const list={"@list":[]};_addFrameOutput(output,prop,list);const src=o["@list"];for(const oo of src){if(graphTypes.isSubjectReference(oo)){api.frame({...state,embedded:true},[oo["@id"]],subframe,list,"@list")}else{_addFrameOutput(list,"@list",util.clone(oo))}}}else if(graphTypes.isSubjectReference(o)){api.frame({...state,embedded:true},[o["@id"]],subframe,output,prop)}else if(_valueMatch(subframe[0],o)){_addFrameOutput(output,prop,util.clone(o))}}}for(const prop of Object.keys(frame).sort()){if(prop==="@type"){if(!types.isObject(frame[prop][0])||!("@default"in frame[prop][0])){continue}}else if(isKeyword(prop)){continue}const next=frame[prop][0]||{};const omitDefaultOn=_getFrameFlag(next,options,"omitDefault");if(!omitDefaultOn&&!(prop in output)){let preserve="@null";if("@default"in next){preserve=util.clone(next["@default"])}if(!types.isArray(preserve)){preserve=[preserve]}output[prop]=[{"@preserve":preserve}]}}for(const reverseProp of Object.keys(frame["@reverse"]||{}).sort()){const subframe=frame["@reverse"][reverseProp];for(const subject of Object.keys(state.subjects)){const nodeValues=util.getValues(state.subjects[subject],reverseProp);if(nodeValues.some(v=>v["@id"]===id)){output["@reverse"]=output["@reverse"]||{};util.addValue(output["@reverse"],reverseProp,[],{propertyIsArray:true});api.frame({...state,embedded:true},[subject],subframe,output["@reverse"][reverseProp],property)}}}_addFrameOutput(parent,property,output);state.subjectStack.pop()}};api.cleanupNull=(input,options)=>{if(types.isArray(input)){const noNulls=input.map(v=>api.cleanupNull(v,options));return noNulls.filter(v=>v)}if(input==="@null"){return null}if(types.isObject(input)){if("@id"in input){const id=input["@id"];if(options.link.hasOwnProperty(id)){const idx=options.link[id].indexOf(input);if(idx!==-1){return options.link[id][idx]}options.link[id].push(input)}else{options.link[id]=[input]}}for(const key in input){input[key]=api.cleanupNull(input[key],options)}}return input};function _createImplicitFrame(flags){const frame={};for(const key in flags){if(flags[key]!==undefined){frame["@"+key]=[flags[key]]}}return[frame]}function _createsCircularReference(subjectToEmbed,graph,subjectStack){for(let i=subjectStack.length-1;i>=0;--i){const subject=subjectStack[i];if(subject.graph===graph&&subject.subject["@id"]===subjectToEmbed["@id"]){return true}}return false}function _getFrameFlag(frame,options,name){const flag="@"+name;let rval=flag in frame?frame[flag][0]:options[name];if(name==="embed"){if(rval===true){rval="@once"}else if(rval===false){rval="@never"}else if(rval!=="@always"&&rval!=="@never"&&rval!=="@link"&&rval!=="@first"&&rval!=="@last"&&rval!=="@once"){throw new JsonLdError("Invalid JSON-LD syntax; invalid value of @embed.","jsonld.SyntaxError",{code:"invalid @embed value",frame:frame})}}return rval}function _validateFrame(frame){if(!types.isArray(frame)||frame.length!==1||!types.isObject(frame[0])){throw new JsonLdError("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:frame})}if("@id"in frame[0]){for(const id of util.asArray(frame[0]["@id"])){if(!(types.isObject(id)||url.isAbsolute(id))||types.isString(id)&&id.indexOf("_:")===0){throw new JsonLdError("Invalid JSON-LD syntax; invalid @id in frame.","jsonld.SyntaxError",{code:"invalid frame",frame:frame})}}}if("@type"in frame[0]){for(const type of util.asArray(frame[0]["@type"])){if(!(types.isObject(type)||url.isAbsolute(type))||types.isString(type)&&type.indexOf("_:")===0){throw new JsonLdError("Invalid JSON-LD syntax; invalid @type in frame.","jsonld.SyntaxError",{code:"invalid frame",frame:frame})}}}}function _filterSubjects(state,subjects,frame,flags){const rval={};for(const id of subjects){const subject=state.graphMap[state.graph][id];if(_filterSubject(state,subject,frame,flags)){rval[id]=subject}}return rval}function _filterSubject(state,subject,frame,flags){let wildcard=true;let matchesSome=false;for(const key in frame){let matchThis=false;const nodeValues=util.getValues(subject,key);const isEmpty=util.getValues(frame,key).length===0;if(key==="@id"){if(types.isEmptyObject(frame["@id"][0]||{})){matchThis=true}else if(frame["@id"].length>=0){matchThis=frame["@id"].includes(nodeValues[0])}if(!flags.requireAll){return matchThis}}else if(key==="@type"){wildcard=false;if(isEmpty){if(nodeValues.length>0){return false}matchThis=true}else if(frame["@type"].length===1&&types.isEmptyObject(frame["@type"][0])){matchThis=nodeValues.length>0}else{for(const type of frame["@type"]){if(types.isObject(type)&&"@default"in type){matchThis=true}else{matchThis=matchThis||nodeValues.some(tt=>tt===type)}}}if(!flags.requireAll){return matchThis}}else if(isKeyword(key)){continue}else{const thisFrame=util.getValues(frame,key)[0];let hasDefault=false;if(thisFrame){_validateFrame([thisFrame]);hasDefault="@default"in thisFrame}wildcard=false;if(nodeValues.length===0&&hasDefault){continue}if(nodeValues.length>0&&isEmpty){return false}if(thisFrame===undefined){if(nodeValues.length>0){return false}matchThis=true}else{if(graphTypes.isList(thisFrame)){const listValue=thisFrame["@list"][0];if(graphTypes.isList(nodeValues[0])){const nodeListValues=nodeValues[0]["@list"];if(graphTypes.isValue(listValue)){matchThis=nodeListValues.some(lv=>_valueMatch(listValue,lv))}else if(graphTypes.isSubject(listValue)||graphTypes.isSubjectReference(listValue)){matchThis=nodeListValues.some(lv=>_nodeMatch(state,listValue,lv,flags))}}}else if(graphTypes.isValue(thisFrame)){matchThis=nodeValues.some(nv=>_valueMatch(thisFrame,nv))}else if(graphTypes.isSubjectReference(thisFrame)){matchThis=nodeValues.some(nv=>_nodeMatch(state,thisFrame,nv,flags))}else if(types.isObject(thisFrame)){matchThis=nodeValues.length>0}else{matchThis=false}}}if(!matchThis&&flags.requireAll){return false}matchesSome=matchesSome||matchThis}return wildcard||matchesSome}function _removeEmbed(state,id){const embeds=state.uniqueEmbeds[state.graph];const embed=embeds[id];const parent=embed.parent;const property=embed.property;const subject={"@id":id};if(types.isArray(parent)){for(let i=0;i<parent.length;++i){if(util.compareValues(parent[i],subject)){parent[i]=subject;break}}}else{const useArray=types.isArray(parent[property]);util.removeValue(parent,property,subject,{propertyIsArray:useArray});util.addValue(parent,property,subject,{propertyIsArray:useArray})}const removeDependents=id=>{const ids=Object.keys(embeds);for(const next of ids){if(next in embeds&&types.isObject(embeds[next].parent)&&embeds[next].parent["@id"]===id){delete embeds[next];removeDependents(next)}}};removeDependents(id)}
/**
 * Removes the @preserve keywords from expanded result of framing.
 *
 * @param input the framed, framed output.
 * @param options the framing options used.
 *
 * @return the resulting output.
 */function _cleanupPreserve(input,options){if(types.isArray(input)){return input.map(value=>_cleanupPreserve(value,options))}if(types.isObject(input)){
// remove @preserve
if("@preserve"in input){return input["@preserve"][0]}if(graphTypes.isValue(input)){return input}if(graphTypes.isList(input)){input["@list"]=_cleanupPreserve(input["@list"],options);return input}if("@id"in input){const id=input["@id"];if(options.link.hasOwnProperty(id)){const idx=options.link[id].indexOf(input);if(idx!==-1){return options.link[id][idx]}options.link[id].push(input)}else{options.link[id]=[input]}}for(const prop in input){if(prop==="@id"&&options.bnodesToClear.includes(input[prop])){delete input["@id"];continue}input[prop]=_cleanupPreserve(input[prop],options)}}return input}function _addFrameOutput(parent,property,output){if(types.isObject(parent)){util.addValue(parent,property,output,{propertyIsArray:true})}else{parent.push(output)}}function _nodeMatch(state,pattern,value,flags){if(!("@id"in value)){return false}const nodeObject=state.subjects[value["@id"]];return nodeObject&&_filterSubject(state,nodeObject,pattern,flags)}function _valueMatch(pattern,value){const v1=value["@value"];const t1=value["@type"];const l1=value["@language"];const v2=pattern["@value"]?types.isArray(pattern["@value"])?pattern["@value"]:[pattern["@value"]]:[];const t2=pattern["@type"]?types.isArray(pattern["@type"])?pattern["@type"]:[pattern["@type"]]:[];const l2=pattern["@language"]?types.isArray(pattern["@language"])?pattern["@language"]:[pattern["@language"]]:[];if(v2.length===0&&t2.length===0&&l2.length===0){return true}if(!(v2.includes(v1)||types.isEmptyObject(v2[0]))){return false}if(!(!t1&&t2.length===0||t2.includes(t1)||t1&&types.isEmptyObject(t2[0]))){return false}if(!(!l1&&l2.length===0||l2.includes(l1)||l1&&types.isEmptyObject(l2[0]))){return false}return true}},{"./JsonLdError":50,"./context":58,"./graphTypes":65,"./nodeMap":67,"./types":69,"./url":70,"./util":71}],64:[function(require,module,exports){"use strict";const JsonLdError=require("./JsonLdError");const graphTypes=require("./graphTypes");const types=require("./types");const util=require("./util");const{RDF_LIST:RDF_LIST,RDF_FIRST:RDF_FIRST,RDF_REST:RDF_REST,RDF_NIL:RDF_NIL,RDF_TYPE:RDF_TYPE,RDF_JSON_LITERAL:RDF_JSON_LITERAL,XSD_BOOLEAN:XSD_BOOLEAN,XSD_DOUBLE:XSD_DOUBLE,XSD_INTEGER:XSD_INTEGER,XSD_STRING:XSD_STRING}=require("./constants");const REGEX_BCP47=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/;const api={};module.exports=api;api.fromRDF=async(dataset,{useRdfType:useRdfType=false,useNativeTypes:useNativeTypes=false,rdfDirection:rdfDirection=null})=>{const defaultGraph={};const graphMap={"@default":defaultGraph};const referencedOnce={};for(const quad of dataset){const name=quad.graph.termType==="DefaultGraph"?"@default":quad.graph.value;if(!(name in graphMap)){graphMap[name]={}}if(name!=="@default"&&!(name in defaultGraph)){defaultGraph[name]={"@id":name}}const nodeMap=graphMap[name];const s=quad.subject.value;const p=quad.predicate.value;const o=quad.object;if(!(s in nodeMap)){nodeMap[s]={"@id":s}}const node=nodeMap[s];const objectIsNode=o.termType.endsWith("Node");if(objectIsNode&&!(o.value in nodeMap)){nodeMap[o.value]={"@id":o.value}}if(p===RDF_TYPE&&!useRdfType&&objectIsNode){util.addValue(node,"@type",o.value,{propertyIsArray:true});continue}const value=_RDFToObject(o,useNativeTypes,rdfDirection);util.addValue(node,p,value,{propertyIsArray:true});if(objectIsNode){if(o.value===RDF_NIL){const object=nodeMap[o.value];if(!("usages"in object)){object.usages=[]}object.usages.push({node:node,property:p,value:value})}else if(o.value in referencedOnce){referencedOnce[o.value]=false}else{referencedOnce[o.value]={node:node,property:p,value:value}}}}for(const name in graphMap){const graphObject=graphMap[name];if(!(RDF_NIL in graphObject)){continue}const nil=graphObject[RDF_NIL];if(!nil.usages){continue}for(let usage of nil.usages){let node=usage.node;let property=usage.property;let head=usage.value;const list=[];const listNodes=[];let nodeKeyCount=Object.keys(node).length;while(property===RDF_REST&&types.isObject(referencedOnce[node["@id"]])&&types.isArray(node[RDF_FIRST])&&node[RDF_FIRST].length===1&&types.isArray(node[RDF_REST])&&node[RDF_REST].length===1&&(nodeKeyCount===3||nodeKeyCount===4&&types.isArray(node["@type"])&&node["@type"].length===1&&node["@type"][0]===RDF_LIST)){list.push(node[RDF_FIRST][0]);listNodes.push(node["@id"]);usage=referencedOnce[node["@id"]];node=usage.node;property=usage.property;head=usage.value;nodeKeyCount=Object.keys(node).length;if(!graphTypes.isBlankNode(node)){break}}delete head["@id"];head["@list"]=list.reverse();for(const listNode of listNodes){delete graphObject[listNode]}}delete nil.usages}const result=[];const subjects=Object.keys(defaultGraph).sort();for(const subject of subjects){const node=defaultGraph[subject];if(subject in graphMap){const graph=node["@graph"]=[];const graphObject=graphMap[subject];const graphSubjects=Object.keys(graphObject).sort();for(const graphSubject of graphSubjects){const node=graphObject[graphSubject];if(!graphTypes.isSubjectReference(node)){graph.push(node)}}}if(!graphTypes.isSubjectReference(node)){result.push(node)}}return result};function _RDFToObject(o,useNativeTypes,rdfDirection){if(o.termType.endsWith("Node")){return{"@id":o.value}}const rval={"@value":o.value};if(o.language){rval["@language"]=o.language}else{let type=o.datatype.value;if(!type){type=XSD_STRING}if(type===RDF_JSON_LITERAL){type="@json";try{rval["@value"]=JSON.parse(rval["@value"])}catch(e){throw new JsonLdError("JSON literal could not be parsed.","jsonld.InvalidJsonLiteral",{code:"invalid JSON literal",value:rval["@value"],cause:e})}}if(useNativeTypes){if(type===XSD_BOOLEAN){if(rval["@value"]==="true"){rval["@value"]=true}else if(rval["@value"]==="false"){rval["@value"]=false}}else if(types.isNumeric(rval["@value"])){if(type===XSD_INTEGER){const i=parseInt(rval["@value"],10);if(i.toFixed(0)===rval["@value"]){rval["@value"]=i}}else if(type===XSD_DOUBLE){rval["@value"]=parseFloat(rval["@value"])}}if(![XSD_BOOLEAN,XSD_INTEGER,XSD_DOUBLE,XSD_STRING].includes(type)){rval["@type"]=type}}else if(rdfDirection==="i18n-datatype"&&type.startsWith("https://www.w3.org/ns/i18n#")){const[,language,direction]=type.split(/[#_]/);if(language.length>0){rval["@language"]=language;if(!language.match(REGEX_BCP47)){console.warn(`@language must be valid BCP47: ${language}`)}}rval["@direction"]=direction}else if(type!==XSD_STRING){rval["@type"]=type}}return rval}},{"./JsonLdError":50,"./constants":57,"./graphTypes":65,"./types":69,"./util":71}],65:[function(require,module,exports){"use strict";const types=require("./types");const api={};module.exports=api;api.isSubject=v=>{if(types.isObject(v)&&!("@value"in v||"@set"in v||"@list"in v)){const keyCount=Object.keys(v).length;return keyCount>1||!("@id"in v)}return false};api.isSubjectReference=v=>types.isObject(v)&&Object.keys(v).length===1&&"@id"in v;api.isValue=v=>types.isObject(v)&&"@value"in v;api.isList=v=>types.isObject(v)&&"@list"in v;api.isGraph=v=>types.isObject(v)&&"@graph"in v&&Object.keys(v).filter(key=>key!=="@id"&&key!=="@index").length===1;api.isSimpleGraph=v=>api.isGraph(v)&&!("@id"in v);api.isBlankNode=v=>{if(types.isObject(v)){if("@id"in v){return v["@id"].indexOf("_:")===0}return Object.keys(v).length===0||!("@value"in v||"@set"in v||"@list"in v)}return false}},{"./types":69}],66:[function(require,module,exports){(function(process,global){
/**
 * A JavaScript implementation of the JSON-LD API.
 *
 * @author Dave Longley
 *
 * @license BSD 3-Clause License
 * Copyright (c) 2011-2019 Digital Bazaar, Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice,
 * this list of conditions and the following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright
 * notice, this list of conditions and the following disclaimer in the
 * documentation and/or other materials provided with the distribution.
 *
 * Neither the name of the Digital Bazaar, Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
 * IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
 * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
 * PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
const canonize=require("rdf-canonize");const util=require("./util");const ContextResolver=require("./ContextResolver");const IdentifierIssuer=util.IdentifierIssuer;const JsonLdError=require("./JsonLdError");const LRU=require("lru-cache");const NQuads=require("./NQuads");const Rdfa=require("./Rdfa");const{expand:_expand}=require("./expand");const{flatten:_flatten}=require("./flatten");const{fromRDF:_fromRDF}=require("./fromRdf");const{toRDF:_toRDF}=require("./toRdf");const{frameMergedOrDefault:_frameMergedOrDefault,cleanupNull:_cleanupNull}=require("./frame");const{isArray:_isArray,isObject:_isObject,isString:_isString}=require("./types");const{isSubjectReference:_isSubjectReference}=require("./graphTypes");const{expandIri:_expandIri,getInitialContext:_getInitialContext,process:_processContext,processingMode:_processingMode}=require("./context");const{compact:_compact,compactIri:_compactIri}=require("./compact");const{createNodeMap:_createNodeMap,createMergedNodeMap:_createMergedNodeMap,mergeNodeMaps:_mergeNodeMaps}=require("./nodeMap");const _nodejs=typeof process!=="undefined"&&process.versions&&process.versions.node;const _browser=!_nodejs&&(typeof window!=="undefined"||typeof self!=="undefined");const wrapper=function(jsonld){const _rdfParsers={};const RESOLVED_CONTEXT_CACHE_MAX_SIZE=100;const _resolvedContextCache=new LRU({max:RESOLVED_CONTEXT_CACHE_MAX_SIZE});jsonld.compact=async function(input,ctx,options){if(arguments.length<2){throw new TypeError("Could not compact, too few arguments.")}if(ctx===null){throw new JsonLdError("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"})}if(input===null){return null}options=_setDefaults(options,{base:_isString(input)?input:"",compactArrays:true,compactToRelative:true,graph:false,skipExpansion:false,link:false,issuer:new IdentifierIssuer("_:b"),contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});if(options.link){options.skipExpansion=true}if(!options.compactToRelative){delete options.base}let expanded;if(options.skipExpansion){expanded=input}else{expanded=await jsonld.expand(input,options)}const activeCtx=await jsonld.processContext(_getInitialContext(options),ctx,options);let compacted=await _compact({activeCtx:activeCtx,element:expanded,options:options,compactionMap:options.compactionMap});if(options.compactArrays&&!options.graph&&_isArray(compacted)){if(compacted.length===1){compacted=compacted[0]}else if(compacted.length===0){compacted={}}}else if(options.graph&&_isObject(compacted)){compacted=[compacted]}if(_isObject(ctx)&&"@context"in ctx){ctx=ctx["@context"]}ctx=util.clone(ctx);if(!_isArray(ctx)){ctx=[ctx]}const tmp=ctx;ctx=[];for(let i=0;i<tmp.length;++i){if(!_isObject(tmp[i])||Object.keys(tmp[i]).length>0){ctx.push(tmp[i])}}const hasContext=ctx.length>0;if(ctx.length===1){ctx=ctx[0]}if(_isArray(compacted)){const graphAlias=_compactIri({activeCtx:activeCtx,iri:"@graph",relativeTo:{vocab:true}});const graph=compacted;compacted={};if(hasContext){compacted["@context"]=ctx}compacted[graphAlias]=graph}else if(_isObject(compacted)&&hasContext){const graph=compacted;compacted={"@context":ctx};for(const key in graph){compacted[key]=graph[key]}}return compacted};jsonld.expand=async function(input,options){if(arguments.length<1){throw new TypeError("Could not expand, too few arguments.")}options=_setDefaults(options,{keepFreeFloatingNodes:false,contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});if(options.expansionMap===false){options.expansionMap=undefined}const toResolve={};const contextsToProcess=[];if("expandContext"in options){const expandContext=util.clone(options.expandContext);if(_isObject(expandContext)&&"@context"in expandContext){toResolve.expandContext=expandContext}else{toResolve.expandContext={"@context":expandContext}}contextsToProcess.push(toResolve.expandContext)}let defaultBase;if(!_isString(input)){toResolve.input=util.clone(input)}else{const remoteDoc=await jsonld.get(input,options);defaultBase=remoteDoc.documentUrl;toResolve.input=remoteDoc.document;if(remoteDoc.contextUrl){toResolve.remoteContext={"@context":remoteDoc.contextUrl};contextsToProcess.push(toResolve.remoteContext)}}if(!("base"in options)){options.base=defaultBase||""}let activeCtx=_getInitialContext(options);for(const localCtx of contextsToProcess){activeCtx=await _processContext({activeCtx:activeCtx,localCtx:localCtx,options:options})}let expanded=await _expand({activeCtx:activeCtx,element:toResolve.input,options:options,expansionMap:options.expansionMap});if(_isObject(expanded)&&"@graph"in expanded&&Object.keys(expanded).length===1){expanded=expanded["@graph"]}else if(expanded===null){expanded=[]}if(!_isArray(expanded)){expanded=[expanded]}return expanded};jsonld.flatten=async function(input,ctx,options){if(arguments.length<1){return new TypeError("Could not flatten, too few arguments.")}if(typeof ctx==="function"){ctx=null}else{ctx=ctx||null}options=_setDefaults(options,{base:_isString(input)?input:"",contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});const expanded=await jsonld.expand(input,options);const flattened=_flatten(expanded);if(ctx===null){return flattened}options.graph=true;options.skipExpansion=true;const compacted=await jsonld.compact(flattened,ctx,options);return compacted};jsonld.frame=async function(input,frame,options){if(arguments.length<2){throw new TypeError("Could not frame, too few arguments.")}options=_setDefaults(options,{base:_isString(input)?input:"",embed:"@once",explicit:false,requireAll:false,omitDefault:false,bnodesToClear:[],contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});if(_isString(frame)){const remoteDoc=await jsonld.get(frame,options);frame=remoteDoc.document;if(remoteDoc.contextUrl){let ctx=frame["@context"];if(!ctx){ctx=remoteDoc.contextUrl}else if(_isArray(ctx)){ctx.push(remoteDoc.contextUrl)}else{ctx=[ctx,remoteDoc.contextUrl]}frame["@context"]=ctx}}const frameContext=frame?frame["@context"]||{}:{};const activeCtx=await jsonld.processContext(_getInitialContext(options),frameContext,options);if(!options.hasOwnProperty("omitGraph")){options.omitGraph=_processingMode(activeCtx,1.1)}if(!options.hasOwnProperty("pruneBlankNodeIdentifiers")){options.pruneBlankNodeIdentifiers=_processingMode(activeCtx,1.1)}const expanded=await jsonld.expand(input,options);const opts={...options};opts.isFrame=true;opts.keepFreeFloatingNodes=true;const expandedFrame=await jsonld.expand(frame,opts);const frameKeys=Object.keys(frame).map(key=>_expandIri(activeCtx,key,{vocab:true}));opts.merged=!frameKeys.includes("@graph");opts.is11=_processingMode(activeCtx,1.1);const framed=_frameMergedOrDefault(expanded,expandedFrame,opts);opts.graph=!options.omitGraph;opts.skipExpansion=true;opts.link={};opts.framing=true;let compacted=await jsonld.compact(framed,frameContext,opts);opts.link={};compacted=_cleanupNull(compacted,opts);return compacted};jsonld.link=async function(input,ctx,options){const frame={};if(ctx){frame["@context"]=ctx}frame["@embed"]="@link";return jsonld.frame(input,frame,options)};jsonld.normalize=jsonld.canonize=async function(input,options){if(arguments.length<1){throw new TypeError("Could not canonize, too few arguments.")}options=_setDefaults(options,{base:_isString(input)?input:"",algorithm:"URDNA2015",skipExpansion:false,contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});if("inputFormat"in options){if(options.inputFormat!=="application/n-quads"&&options.inputFormat!=="application/nquads"){throw new JsonLdError("Unknown canonicalization input format.","jsonld.CanonizeError")}const parsedInput=NQuads.parse(input);return canonize.canonize(parsedInput,options)}const opts={...options};delete opts.format;opts.produceGeneralizedRdf=false;const dataset=await jsonld.toRDF(input,opts);return canonize.canonize(dataset,options)};jsonld.fromRDF=async function(dataset,options){if(arguments.length<1){throw new TypeError("Could not convert from RDF, too few arguments.")}options=_setDefaults(options,{format:_isString(dataset)?"application/n-quads":undefined});const{format:format}=options;let{rdfParser:rdfParser}=options;if(format){rdfParser=rdfParser||_rdfParsers[format];if(!rdfParser){throw new JsonLdError("Unknown input format.","jsonld.UnknownFormat",{format:format})}}else{rdfParser=()=>dataset}const parsedDataset=await rdfParser(dataset);return _fromRDF(parsedDataset,options)};jsonld.toRDF=async function(input,options){if(arguments.length<1){throw new TypeError("Could not convert to RDF, too few arguments.")}options=_setDefaults(options,{base:_isString(input)?input:"",skipExpansion:false,contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});let expanded;if(options.skipExpansion){expanded=input}else{expanded=await jsonld.expand(input,options)}const dataset=_toRDF(expanded,options);if(options.format){if(options.format==="application/n-quads"||options.format==="application/nquads"){return await NQuads.serialize(dataset)}throw new JsonLdError("Unknown output format.","jsonld.UnknownFormat",{format:options.format})}return dataset};jsonld.createNodeMap=async function(input,options){if(arguments.length<1){throw new TypeError("Could not create node map, too few arguments.")}options=_setDefaults(options,{base:_isString(input)?input:"",contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});const expanded=await jsonld.expand(input,options);return _createMergedNodeMap(expanded,options)};jsonld.merge=async function(docs,ctx,options){if(arguments.length<1){throw new TypeError("Could not merge, too few arguments.")}if(!_isArray(docs)){throw new TypeError('Could not merge, "docs" must be an array.')}if(typeof ctx==="function"){ctx=null}else{ctx=ctx||null}options=_setDefaults(options,{contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});const expanded=await Promise.all(docs.map(doc=>{const opts={...options};return jsonld.expand(doc,opts)}));let mergeNodes=true;if("mergeNodes"in options){mergeNodes=options.mergeNodes}const issuer=options.issuer||new IdentifierIssuer("_:b");const graphs={"@default":{}};for(let i=0;i<expanded.length;++i){const doc=util.relabelBlankNodes(expanded[i],{issuer:new IdentifierIssuer("_:b"+i+"-")});const _graphs=mergeNodes||i===0?graphs:{"@default":{}};_createNodeMap(doc,_graphs,"@default",issuer);if(_graphs!==graphs){for(const graphName in _graphs){const _nodeMap=_graphs[graphName];if(!(graphName in graphs)){graphs[graphName]=_nodeMap;continue}const nodeMap=graphs[graphName];for(const key in _nodeMap){if(!(key in nodeMap)){nodeMap[key]=_nodeMap[key]}}}}}const defaultGraph=_mergeNodeMaps(graphs);const flattened=[];const keys=Object.keys(defaultGraph).sort();for(let ki=0;ki<keys.length;++ki){const node=defaultGraph[keys[ki]];if(!_isSubjectReference(node)){flattened.push(node)}}if(ctx===null){return flattened}options.graph=true;options.skipExpansion=true;const compacted=await jsonld.compact(flattened,ctx,options);return compacted};Object.defineProperty(jsonld,"documentLoader",{get:()=>jsonld._documentLoader,set:v=>jsonld._documentLoader=v});jsonld.documentLoader=async url=>{throw new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL "+"dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",url:url})};jsonld.get=async function(url,options){let load;if(typeof options.documentLoader==="function"){load=options.documentLoader}else{load=jsonld.documentLoader}const remoteDoc=await load(url);try{if(!remoteDoc.document){throw new JsonLdError("No remote document found at the given URL.","jsonld.NullRemoteDocument")}if(_isString(remoteDoc.document)){remoteDoc.document=JSON.parse(remoteDoc.document)}}catch(e){throw new JsonLdError("Could not retrieve a JSON-LD document from the URL.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:remoteDoc})}return remoteDoc};jsonld.processContext=async function(activeCtx,localCtx,options){options=_setDefaults(options,{base:"",contextResolver:new ContextResolver({sharedCache:_resolvedContextCache})});if(localCtx===null){return _getInitialContext(options)}localCtx=util.clone(localCtx);if(!(_isObject(localCtx)&&"@context"in localCtx)){localCtx={"@context":localCtx}}return _processContext({activeCtx:activeCtx,localCtx:localCtx,options:options})};jsonld.getContextValue=require("./context").getContextValue;jsonld.documentLoaders={};jsonld.documentLoaders.node=require("./documentLoaders/node");jsonld.documentLoaders.xhr=require("./documentLoaders/xhr");jsonld.useDocumentLoader=function(type){if(!(type in jsonld.documentLoaders)){throw new JsonLdError('Unknown document loader type: "'+type+'"',"jsonld.UnknownDocumentLoader",{type:type})}jsonld.documentLoader=jsonld.documentLoaders[type].apply(jsonld,Array.prototype.slice.call(arguments,1))};jsonld.registerRDFParser=function(contentType,parser){_rdfParsers[contentType]=parser};jsonld.unregisterRDFParser=function(contentType){delete _rdfParsers[contentType]};jsonld.registerRDFParser("application/n-quads",NQuads.parse);jsonld.registerRDFParser("application/nquads",NQuads.parse);jsonld.registerRDFParser("rdfa-api",Rdfa.parse);jsonld.url=require("./url");jsonld.util=util;Object.assign(jsonld,util);jsonld.promises=jsonld;jsonld.RequestQueue=require("./RequestQueue");jsonld.JsonLdProcessor=require("./JsonLdProcessor")(jsonld);if(_browser&&typeof global.JsonLdProcessor==="undefined"){Object.defineProperty(global,"JsonLdProcessor",{writable:true,enumerable:false,configurable:true,value:jsonld.JsonLdProcessor})}if(_nodejs){jsonld.useDocumentLoader("node")}else if(typeof XMLHttpRequest!=="undefined"){jsonld.useDocumentLoader("xhr")}function _setDefaults(options,{documentLoader:documentLoader=jsonld.documentLoader,...defaults}){return Object.assign({},{documentLoader:documentLoader},defaults,options)}return jsonld};const factory=function(){return wrapper((function(){return factory()}))};wrapper(factory);module.exports=factory}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ContextResolver":49,"./JsonLdError":50,"./JsonLdProcessor":51,"./NQuads":52,"./Rdfa":53,"./RequestQueue":54,"./compact":56,"./context":58,"./documentLoaders/node":59,"./documentLoaders/xhr":60,"./expand":61,"./flatten":62,"./frame":63,"./fromRdf":64,"./graphTypes":65,"./nodeMap":67,"./toRdf":68,"./types":69,"./url":70,"./util":71,_process:79,"lru-cache":72,"rdf-canonize":89}],67:[function(require,module,exports){"use strict";const{isKeyword:isKeyword}=require("./context");const graphTypes=require("./graphTypes");const types=require("./types");const util=require("./util");const JsonLdError=require("./JsonLdError");const api={};module.exports=api;api.createMergedNodeMap=(input,options)=>{options=options||{};const issuer=options.issuer||new util.IdentifierIssuer("_:b");const graphs={"@default":{}};api.createNodeMap(input,graphs,"@default",issuer);return api.mergeNodeMaps(graphs)};api.createNodeMap=(input,graphs,graph,issuer,name,list)=>{if(types.isArray(input)){for(const node of input){api.createNodeMap(node,graphs,graph,issuer,undefined,list)}return}if(!types.isObject(input)){if(list){list.push(input)}return}if(graphTypes.isValue(input)){if("@type"in input){let type=input["@type"];if(type.indexOf("_:")===0){input["@type"]=type=issuer.getId(type)}}if(list){list.push(input)}return}else if(list&&graphTypes.isList(input)){const _list=[];api.createNodeMap(input["@list"],graphs,graph,issuer,name,_list);list.push({"@list":_list});return}if("@type"in input){const types=input["@type"];for(const type of types){if(type.indexOf("_:")===0){issuer.getId(type)}}}if(types.isUndefined(name)){name=graphTypes.isBlankNode(input)?issuer.getId(input["@id"]):input["@id"]}if(list){list.push({"@id":name})}const subjects=graphs[graph];const subject=subjects[name]=subjects[name]||{};subject["@id"]=name;const properties=Object.keys(input).sort();for(let property of properties){if(property==="@id"){continue}if(property==="@reverse"){const referencedNode={"@id":name};const reverseMap=input["@reverse"];for(const reverseProperty in reverseMap){const items=reverseMap[reverseProperty];for(const item of items){let itemName=item["@id"];if(graphTypes.isBlankNode(item)){itemName=issuer.getId(itemName)}api.createNodeMap(item,graphs,graph,issuer,itemName);util.addValue(subjects[itemName],reverseProperty,referencedNode,{propertyIsArray:true,allowDuplicate:false})}}continue}if(property==="@graph"){if(!(name in graphs)){graphs[name]={}}api.createNodeMap(input[property],graphs,name,issuer);continue}if(property==="@included"){api.createNodeMap(input[property],graphs,graph,issuer);continue}if(property!=="@type"&&isKeyword(property)){if(property==="@index"&&property in subject&&(input[property]!==subject[property]||input[property]["@id"]!==subject[property]["@id"])){throw new JsonLdError("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:subject})}subject[property]=input[property];continue}const objects=input[property];if(property.indexOf("_:")===0){property=issuer.getId(property)}if(objects.length===0){util.addValue(subject,property,[],{propertyIsArray:true});continue}for(let o of objects){if(property==="@type"){o=o.indexOf("_:")===0?issuer.getId(o):o}if(graphTypes.isSubject(o)||graphTypes.isSubjectReference(o)){if("@id"in o&&!o["@id"]){continue}const id=graphTypes.isBlankNode(o)?issuer.getId(o["@id"]):o["@id"];util.addValue(subject,property,{"@id":id},{propertyIsArray:true,allowDuplicate:false});api.createNodeMap(o,graphs,graph,issuer,id)}else if(graphTypes.isValue(o)){util.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}else if(graphTypes.isList(o)){const _list=[];api.createNodeMap(o["@list"],graphs,graph,issuer,name,_list);o={"@list":_list};util.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}else{api.createNodeMap(o,graphs,graph,issuer,name);util.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}}}};api.mergeNodeMapGraphs=graphs=>{const merged={};for(const name of Object.keys(graphs).sort()){for(const id of Object.keys(graphs[name]).sort()){const node=graphs[name][id];if(!(id in merged)){merged[id]={"@id":id}}const mergedNode=merged[id];for(const property of Object.keys(node).sort()){if(isKeyword(property)&&property!=="@type"){mergedNode[property]=util.clone(node[property])}else{for(const value of node[property]){util.addValue(mergedNode,property,util.clone(value),{propertyIsArray:true,allowDuplicate:false})}}}}}return merged};api.mergeNodeMaps=graphs=>{const defaultGraph=graphs["@default"];const graphNames=Object.keys(graphs).sort();for(const graphName of graphNames){if(graphName==="@default"){continue}const nodeMap=graphs[graphName];let subject=defaultGraph[graphName];if(!subject){defaultGraph[graphName]=subject={"@id":graphName,"@graph":[]}}else if(!("@graph"in subject)){subject["@graph"]=[]}const graph=subject["@graph"];for(const id of Object.keys(nodeMap).sort()){const node=nodeMap[id];if(!graphTypes.isSubjectReference(node)){graph.push(node)}}}return defaultGraph}},{"./JsonLdError":50,"./context":58,"./graphTypes":65,"./types":69,"./util":71}],68:[function(require,module,exports){"use strict";const{createNodeMap:createNodeMap}=require("./nodeMap");const{isKeyword:isKeyword}=require("./context");const graphTypes=require("./graphTypes");const jsonCanonicalize=require("canonicalize");const types=require("./types");const util=require("./util");const{RDF_FIRST:RDF_FIRST,RDF_REST:RDF_REST,RDF_NIL:RDF_NIL,RDF_TYPE:RDF_TYPE,RDF_JSON_LITERAL:RDF_JSON_LITERAL,RDF_LANGSTRING:RDF_LANGSTRING,XSD_BOOLEAN:XSD_BOOLEAN,XSD_DOUBLE:XSD_DOUBLE,XSD_INTEGER:XSD_INTEGER,XSD_STRING:XSD_STRING}=require("./constants");const{isAbsolute:_isAbsoluteIri}=require("./url");const api={};module.exports=api;api.toRDF=(input,options)=>{const issuer=new util.IdentifierIssuer("_:b");const nodeMap={"@default":{}};createNodeMap(input,nodeMap,"@default",issuer);const dataset=[];const graphNames=Object.keys(nodeMap).sort();for(const graphName of graphNames){let graphTerm;if(graphName==="@default"){graphTerm={termType:"DefaultGraph",value:""}}else if(_isAbsoluteIri(graphName)){if(graphName.startsWith("_:")){graphTerm={termType:"BlankNode"}}else{graphTerm={termType:"NamedNode"}}graphTerm.value=graphName}else{continue}_graphToRDF(dataset,nodeMap[graphName],graphTerm,issuer,options)}return dataset};function _graphToRDF(dataset,graph,graphTerm,issuer,options){const ids=Object.keys(graph).sort();for(const id of ids){const node=graph[id];const properties=Object.keys(node).sort();for(let property of properties){const items=node[property];if(property==="@type"){property=RDF_TYPE}else if(isKeyword(property)){continue}for(const item of items){const subject={termType:id.startsWith("_:")?"BlankNode":"NamedNode",value:id};if(!_isAbsoluteIri(id)){continue}const predicate={termType:property.startsWith("_:")?"BlankNode":"NamedNode",value:property};if(!_isAbsoluteIri(property)){continue}if(predicate.termType==="BlankNode"&&!options.produceGeneralizedRdf){continue}const object=_objectToRDF(item,issuer,dataset,graphTerm,options.rdfDirection);if(object){dataset.push({subject:subject,predicate:predicate,object:object,graph:graphTerm})}}}}}function _listToRDF(list,issuer,dataset,graphTerm,rdfDirection){const first={termType:"NamedNode",value:RDF_FIRST};const rest={termType:"NamedNode",value:RDF_REST};const nil={termType:"NamedNode",value:RDF_NIL};const last=list.pop();const result=last?{termType:"BlankNode",value:issuer.getId()}:nil;let subject=result;for(const item of list){const object=_objectToRDF(item,issuer,dataset,graphTerm,rdfDirection);const next={termType:"BlankNode",value:issuer.getId()};dataset.push({subject:subject,predicate:first,object:object,graph:graphTerm});dataset.push({subject:subject,predicate:rest,object:next,graph:graphTerm});subject=next}if(last){const object=_objectToRDF(last,issuer,dataset,graphTerm,rdfDirection);dataset.push({subject:subject,predicate:first,object:object,graph:graphTerm});dataset.push({subject:subject,predicate:rest,object:nil,graph:graphTerm})}return result}function _objectToRDF(item,issuer,dataset,graphTerm,rdfDirection){const object={};if(graphTypes.isValue(item)){object.termType="Literal";object.value=undefined;object.datatype={termType:"NamedNode"};let value=item["@value"];const datatype=item["@type"]||null;if(datatype==="@json"){object.value=jsonCanonicalize(value);object.datatype.value=RDF_JSON_LITERAL}else if(types.isBoolean(value)){object.value=value.toString();object.datatype.value=datatype||XSD_BOOLEAN}else if(types.isDouble(value)||datatype===XSD_DOUBLE){if(!types.isDouble(value)){value=parseFloat(value)}object.value=value.toExponential(15).replace(/(\d)0*e\+?/,"$1E");object.datatype.value=datatype||XSD_DOUBLE}else if(types.isNumber(value)){object.value=value.toFixed(0);object.datatype.value=datatype||XSD_INTEGER}else if(rdfDirection==="i18n-datatype"&&"@direction"in item){const datatype="https://www.w3.org/ns/i18n#"+(item["@language"]||"")+`_${item["@direction"]}`;object.datatype.value=datatype;object.value=value}else if("@language"in item){object.value=value;object.datatype.value=datatype||RDF_LANGSTRING;object.language=item["@language"]}else{object.value=value;object.datatype.value=datatype||XSD_STRING}}else if(graphTypes.isList(item)){const _list=_listToRDF(item["@list"],issuer,dataset,graphTerm,rdfDirection);object.termType=_list.termType;object.value=_list.value}else{const id=types.isObject(item)?item["@id"]:item;object.termType=id.startsWith("_:")?"BlankNode":"NamedNode";object.value=id}if(object.termType==="NamedNode"&&!_isAbsoluteIri(object.value)){return null}return object}},{"./constants":57,"./context":58,"./graphTypes":65,"./nodeMap":67,"./types":69,"./url":70,"./util":71,canonicalize:45}],69:[function(require,module,exports){"use strict";const api={};module.exports=api;api.isArray=Array.isArray;api.isBoolean=v=>typeof v==="boolean"||Object.prototype.toString.call(v)==="[object Boolean]";api.isDouble=v=>api.isNumber(v)&&(String(v).indexOf(".")!==-1||Math.abs(v)>=1e21);api.isEmptyObject=v=>api.isObject(v)&&Object.keys(v).length===0;api.isNumber=v=>typeof v==="number"||Object.prototype.toString.call(v)==="[object Number]";api.isNumeric=v=>!isNaN(parseFloat(v))&&isFinite(v);api.isObject=v=>Object.prototype.toString.call(v)==="[object Object]";api.isString=v=>typeof v==="string"||Object.prototype.toString.call(v)==="[object String]";api.isUndefined=v=>typeof v==="undefined"},{}],70:[function(require,module,exports){"use strict";const types=require("./types");const api={};module.exports=api;api.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}};api.parse=(str,parser)=>{const parsed={};const o=api.parsers[parser||"full"];const m=o.regex.exec(str);let i=o.keys.length;while(i--){parsed[o.keys[i]]=m[i]===undefined?null:m[i]}if(parsed.scheme==="https"&&parsed.port==="443"||parsed.scheme==="http"&&parsed.port==="80"){parsed.href=parsed.href.replace(":"+parsed.port,"");parsed.authority=parsed.authority.replace(":"+parsed.port,"");parsed.port=null}parsed.normalizedPath=api.removeDotSegments(parsed.path);return parsed};api.prependBase=(base,iri)=>{if(base===null){return iri}if(api.isAbsolute(iri)){return iri}if(!base||types.isString(base)){base=api.parse(base||"")}const rel=api.parse(iri);const transform={protocol:base.protocol||""};if(rel.authority!==null){transform.authority=rel.authority;transform.path=rel.path;transform.query=rel.query}else{transform.authority=base.authority;if(rel.path===""){transform.path=base.path;if(rel.query!==null){transform.query=rel.query}else{transform.query=base.query}}else{if(rel.path.indexOf("/")===0){transform.path=rel.path}else{let path=base.path;path=path.substr(0,path.lastIndexOf("/")+1);if((path.length>0||base.authority)&&path.substr(-1)!=="/"){path+="/"}path+=rel.path;transform.path=path}transform.query=rel.query}}if(rel.path!==""){transform.path=api.removeDotSegments(transform.path)}let rval=transform.protocol;if(transform.authority!==null){rval+="//"+transform.authority}rval+=transform.path;if(transform.query!==null){rval+="?"+transform.query}if(rel.fragment!==null){rval+="#"+rel.fragment}if(rval===""){rval="./"}return rval};api.removeBase=(base,iri)=>{if(base===null){return iri}if(!base||types.isString(base)){base=api.parse(base||"")}let root="";if(base.href!==""){root+=(base.protocol||"")+"//"+(base.authority||"")}else if(iri.indexOf("//")){root+="//"}if(iri.indexOf(root)!==0){return iri}const rel=api.parse(iri.substr(root.length));const baseSegments=base.normalizedPath.split("/");const iriSegments=rel.normalizedPath.split("/");const last=rel.fragment||rel.query?0:1;while(baseSegments.length>0&&iriSegments.length>last){if(baseSegments[0]!==iriSegments[0]){break}baseSegments.shift();iriSegments.shift()}let rval="";if(baseSegments.length>0){baseSegments.pop();for(let i=0;i<baseSegments.length;++i){rval+="../"}}rval+=iriSegments.join("/");if(rel.query!==null){rval+="?"+rel.query}if(rel.fragment!==null){rval+="#"+rel.fragment}if(rval===""){rval="./"}return rval};api.removeDotSegments=path=>{if(path.length===0){return""}const input=path.split("/");const output=[];while(input.length>0){const next=input.shift();const done=input.length===0;if(next==="."){if(done){output.push("")}continue}if(next===".."){output.pop();if(done){output.push("")}continue}output.push(next)}if(path[0]==="/"&&output.length>0&&output[0]!==""){output.unshift("")}if(output.length===1&&output[0]===""){return"/"}return output.join("/")};const isAbsoluteRegex=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^\s]*$/;api.isAbsolute=v=>types.isString(v)&&isAbsoluteRegex.test(v);api.isRelative=v=>types.isString(v)},{"./types":69}],71:[function(require,module,exports){"use strict";const graphTypes=require("./graphTypes");const types=require("./types");const IdentifierIssuer=require("rdf-canonize").IdentifierIssuer;const JsonLdError=require("./JsonLdError");const REGEX_LINK_HEADERS=/(?:<[^>]*?>|"[^"]*?"|[^,])+/g;const REGEX_LINK_HEADER=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/;const REGEX_LINK_HEADER_PARAMS=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;const DEFAULTS={headers:{accept:"application/ld+json, application/json"}};const api={};module.exports=api;api.IdentifierIssuer=IdentifierIssuer;api.clone=function(value){if(value&&typeof value==="object"){let rval;if(types.isArray(value)){rval=[];for(let i=0;i<value.length;++i){rval[i]=api.clone(value[i])}}else if(value instanceof Map){rval=new Map;for(const[k,v]of value){rval.set(k,api.clone(v))}}else if(value instanceof Set){rval=new Set;for(const v of value){rval.add(api.clone(v))}}else if(types.isObject(value)){rval={};for(const key in value){rval[key]=api.clone(value[key])}}else{rval=value.toString()}return rval}return value};api.asArray=function(value){return Array.isArray(value)?value:[value]};api.buildHeaders=(headers={})=>{const hasAccept=Object.keys(headers).some(h=>h.toLowerCase()==="accept");if(hasAccept){throw new RangeError('Accept header may not be specified; only "'+DEFAULTS.headers.accept+'" is supported.')}return Object.assign({Accept:DEFAULTS.headers.accept},headers)};api.parseLinkHeader=header=>{const rval={};const entries=header.match(REGEX_LINK_HEADERS);for(let i=0;i<entries.length;++i){let match=entries[i].match(REGEX_LINK_HEADER);if(!match){continue}const result={target:match[1]};const params=match[2];while(match=REGEX_LINK_HEADER_PARAMS.exec(params)){result[match[1]]=match[2]===undefined?match[3]:match[2]}const rel=result["rel"]||"";if(Array.isArray(rval[rel])){rval[rel].push(result)}else if(rval.hasOwnProperty(rel)){rval[rel]=[rval[rel],result]}else{rval[rel]=result}}return rval};api.validateTypeValue=(v,isFrame)=>{if(types.isString(v)){return}if(types.isArray(v)&&v.every(vv=>types.isString(vv))){return}if(isFrame&&types.isObject(v)){switch(Object.keys(v).length){case 0:return;case 1:if("@default"in v&&api.asArray(v["@default"]).every(vv=>types.isString(vv))){return}}}throw new JsonLdError('Invalid JSON-LD syntax; "@type" value must a string, an array of '+"strings, an empty object, "+"or a default object.","jsonld.SyntaxError",{code:"invalid type value",value:v})};api.hasProperty=(subject,property)=>{if(subject.hasOwnProperty(property)){const value=subject[property];return!types.isArray(value)||value.length>0}return false};api.hasValue=(subject,property,value)=>{if(api.hasProperty(subject,property)){let val=subject[property];const isList=graphTypes.isList(val);if(types.isArray(val)||isList){if(isList){val=val["@list"]}for(let i=0;i<val.length;++i){if(api.compareValues(value,val[i])){return true}}}else if(!types.isArray(value)){return api.compareValues(value,val)}}return false};api.addValue=(subject,property,value,options)=>{options=options||{};if(!("propertyIsArray"in options)){options.propertyIsArray=false}if(!("valueIsArray"in options)){options.valueIsArray=false}if(!("allowDuplicate"in options)){options.allowDuplicate=true}if(!("prependValue"in options)){options.prependValue=false}if(options.valueIsArray){subject[property]=value}else if(types.isArray(value)){if(value.length===0&&options.propertyIsArray&&!subject.hasOwnProperty(property)){subject[property]=[]}if(options.prependValue){value=value.concat(subject[property]);subject[property]=[]}for(let i=0;i<value.length;++i){api.addValue(subject,property,value[i],options)}}else if(subject.hasOwnProperty(property)){const hasValue=!options.allowDuplicate&&api.hasValue(subject,property,value);if(!types.isArray(subject[property])&&(!hasValue||options.propertyIsArray)){subject[property]=[subject[property]]}if(!hasValue){if(options.prependValue){subject[property].unshift(value)}else{subject[property].push(value)}}}else{subject[property]=options.propertyIsArray?[value]:value}};api.getValues=(subject,property)=>[].concat(subject[property]||[]);api.removeProperty=(subject,property)=>{delete subject[property]};api.removeValue=(subject,property,value,options)=>{options=options||{};if(!("propertyIsArray"in options)){options.propertyIsArray=false}const values=api.getValues(subject,property).filter(e=>!api.compareValues(e,value));if(values.length===0){api.removeProperty(subject,property)}else if(values.length===1&&!options.propertyIsArray){subject[property]=values[0]}else{subject[property]=values}};api.relabelBlankNodes=(input,options)=>{options=options||{};const issuer=options.issuer||new IdentifierIssuer("_:b");return _labelBlankNodes(issuer,input)};api.compareValues=(v1,v2)=>{if(v1===v2){return true}if(graphTypes.isValue(v1)&&graphTypes.isValue(v2)&&v1["@value"]===v2["@value"]&&v1["@type"]===v2["@type"]&&v1["@language"]===v2["@language"]&&v1["@index"]===v2["@index"]){return true}if(types.isObject(v1)&&"@id"in v1&&types.isObject(v2)&&"@id"in v2){return v1["@id"]===v2["@id"]}return false};api.compareShortestLeast=(a,b)=>{if(a.length<b.length){return-1}if(b.length<a.length){return 1}if(a===b){return 0}return a<b?-1:1};function _labelBlankNodes(issuer,element){if(types.isArray(element)){for(let i=0;i<element.length;++i){element[i]=_labelBlankNodes(issuer,element[i])}}else if(graphTypes.isList(element)){element["@list"]=_labelBlankNodes(issuer,element["@list"])}else if(types.isObject(element)){if(graphTypes.isBlankNode(element)){element["@id"]=issuer.getId(element["@id"])}const keys=Object.keys(element).sort();for(let ki=0;ki<keys.length;++ki){const key=keys[ki];if(key!=="@id"){element[key]=_labelBlankNodes(issuer,element[key])}}}return element}},{"./JsonLdError":50,"./graphTypes":65,"./types":69,"rdf-canonize":89}],72:[function(require,module,exports){"use strict";const Yallist=require("yallist");const MAX=Symbol("max");const LENGTH=Symbol("length");const LENGTH_CALCULATOR=Symbol("lengthCalculator");const ALLOW_STALE=Symbol("allowStale");const MAX_AGE=Symbol("maxAge");const DISPOSE=Symbol("dispose");const NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet");const LRU_LIST=Symbol("lruList");const CACHE=Symbol("cache");const UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet");const naiveLength=()=>1;class LRUCache{constructor(options){if(typeof options==="number")options={max:options};if(!options)options={};if(options.max&&(typeof options.max!=="number"||options.max<0))throw new TypeError("max must be a non-negative number");const max=this[MAX]=options.max||Infinity;const lc=options.length||naiveLength;this[LENGTH_CALCULATOR]=typeof lc!=="function"?naiveLength:lc;this[ALLOW_STALE]=options.stale||false;if(options.maxAge&&typeof options.maxAge!=="number")throw new TypeError("maxAge must be a number");this[MAX_AGE]=options.maxAge||0;this[DISPOSE]=options.dispose;this[NO_DISPOSE_ON_SET]=options.noDisposeOnSet||false;this[UPDATE_AGE_ON_GET]=options.updateAgeOnGet||false;this.reset()}set max(mL){if(typeof mL!=="number"||mL<0)throw new TypeError("max must be a non-negative number");this[MAX]=mL||Infinity;trim(this)}get max(){return this[MAX]}set allowStale(allowStale){this[ALLOW_STALE]=!!allowStale}get allowStale(){return this[ALLOW_STALE]}set maxAge(mA){if(typeof mA!=="number")throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=mA;trim(this)}get maxAge(){return this[MAX_AGE]}set lengthCalculator(lC){if(typeof lC!=="function")lC=naiveLength;if(lC!==this[LENGTH_CALCULATOR]){this[LENGTH_CALCULATOR]=lC;this[LENGTH]=0;this[LRU_LIST].forEach(hit=>{hit.length=this[LENGTH_CALCULATOR](hit.value,hit.key);this[LENGTH]+=hit.length})}trim(this)}get lengthCalculator(){return this[LENGTH_CALCULATOR]}get length(){return this[LENGTH]}get itemCount(){return this[LRU_LIST].length}rforEach(fn,thisp){thisp=thisp||this;for(let walker=this[LRU_LIST].tail;walker!==null;){const prev=walker.prev;forEachStep(this,fn,walker,thisp);walker=prev}}forEach(fn,thisp){thisp=thisp||this;for(let walker=this[LRU_LIST].head;walker!==null;){const next=walker.next;forEachStep(this,fn,walker,thisp);walker=next}}keys(){return this[LRU_LIST].toArray().map(k=>k.key)}values(){return this[LRU_LIST].toArray().map(k=>k.value)}reset(){if(this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length){this[LRU_LIST].forEach(hit=>this[DISPOSE](hit.key,hit.value))}this[CACHE]=new Map;this[LRU_LIST]=new Yallist;this[LENGTH]=0}dump(){return this[LRU_LIST].map(hit=>isStale(this,hit)?false:{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)}).toArray().filter(h=>h)}dumpLru(){return this[LRU_LIST]}set(key,value,maxAge){maxAge=maxAge||this[MAX_AGE];if(maxAge&&typeof maxAge!=="number")throw new TypeError("maxAge must be a number");const now=maxAge?Date.now():0;const len=this[LENGTH_CALCULATOR](value,key);if(this[CACHE].has(key)){if(len>this[MAX]){del(this,this[CACHE].get(key));return false}const node=this[CACHE].get(key);const item=node.value;if(this[DISPOSE]){if(!this[NO_DISPOSE_ON_SET])this[DISPOSE](key,item.value)}item.now=now;item.maxAge=maxAge;item.value=value;this[LENGTH]+=len-item.length;item.length=len;this.get(key);trim(this);return true}const hit=new Entry(key,value,len,now,maxAge);if(hit.length>this[MAX]){if(this[DISPOSE])this[DISPOSE](key,value);return false}this[LENGTH]+=hit.length;this[LRU_LIST].unshift(hit);this[CACHE].set(key,this[LRU_LIST].head);trim(this);return true}has(key){if(!this[CACHE].has(key))return false;const hit=this[CACHE].get(key).value;return!isStale(this,hit)}get(key){return get(this,key,true)}peek(key){return get(this,key,false)}pop(){const node=this[LRU_LIST].tail;if(!node)return null;del(this,node);return node.value}del(key){del(this,this[CACHE].get(key))}load(arr){this.reset();const now=Date.now();for(let l=arr.length-1;l>=0;l--){const hit=arr[l];const expiresAt=hit.e||0;if(expiresAt===0)this.set(hit.k,hit.v);else{const maxAge=expiresAt-now;if(maxAge>0){this.set(hit.k,hit.v,maxAge)}}}}prune(){this[CACHE].forEach((value,key)=>get(this,key,false))}}const get=(self,key,doUse)=>{const node=self[CACHE].get(key);if(node){const hit=node.value;if(isStale(self,hit)){del(self,node);if(!self[ALLOW_STALE])return undefined}else{if(doUse){if(self[UPDATE_AGE_ON_GET])node.value.now=Date.now();self[LRU_LIST].unshiftNode(node)}}return hit.value}};const isStale=(self,hit)=>{if(!hit||!hit.maxAge&&!self[MAX_AGE])return false;const diff=Date.now()-hit.now;return hit.maxAge?diff>hit.maxAge:self[MAX_AGE]&&diff>self[MAX_AGE]};const trim=self=>{if(self[LENGTH]>self[MAX]){for(let walker=self[LRU_LIST].tail;self[LENGTH]>self[MAX]&&walker!==null;){const prev=walker.prev;del(self,walker);walker=prev}}};const del=(self,node)=>{if(node){const hit=node.value;if(self[DISPOSE])self[DISPOSE](hit.key,hit.value);self[LENGTH]-=hit.length;self[CACHE].delete(hit.key);self[LRU_LIST].removeNode(node)}};class Entry{constructor(key,value,length,now,maxAge){this.key=key;this.value=value;this.length=length;this.now=now;this.maxAge=maxAge||0}}const forEachStep=(self,fn,node,thisp)=>{let hit=node.value;if(isStale(self,hit)){del(self,node);if(!self[ALLOW_STALE])hit=undefined}if(hit)fn.call(thisp,hit.value,hit.key,self)};module.exports=LRUCache},{yallist:94}],73:[function(require,module,exports){(function(Buffer){var api={};module.exports=api;var _reverseAlphabets={};api.encode=function(input,alphabet,maxline){if(typeof alphabet!=="string"){throw new TypeError('"alphabet" must be a string.')}if(maxline!==undefined&&typeof maxline!=="number"){throw new TypeError('"maxline" must be a number.')}var output="";if(!(input instanceof Uint8Array)){output=_encodeWithByteBuffer(input,alphabet)}else{var i=0;var base=alphabet.length;var first=alphabet.charAt(0);var digits=[0];for(i=0;i<input.length;++i){for(var j=0,carry=input[i];j<digits.length;++j){carry+=digits[j]<<8;digits[j]=carry%base;carry=carry/base|0}while(carry>0){digits.push(carry%base);carry=carry/base|0}}for(i=0;input[i]===0&&i<input.length-1;++i){output+=first}for(i=digits.length-1;i>=0;--i){output+=alphabet[digits[i]]}}if(maxline){var regex=new RegExp(".{1,"+maxline+"}","g");output=output.match(regex).join("\r\n")}return output};api.decode=function(input,alphabet){if(typeof input!=="string"){throw new TypeError('"input" must be a string.')}if(typeof alphabet!=="string"){throw new TypeError('"alphabet" must be a string.')}var table=_reverseAlphabets[alphabet];if(!table){table=_reverseAlphabets[alphabet]=[];for(var i=0;i<alphabet.length;++i){table[alphabet.charCodeAt(i)]=i}}input=input.replace(/\s/g,"");var base=alphabet.length;var first=alphabet.charAt(0);var bytes=[0];for(var i=0;i<input.length;i++){var value=table[input.charCodeAt(i)];if(value===undefined){return}for(var j=0,carry=value;j<bytes.length;++j){carry+=bytes[j]*base;bytes[j]=carry&255;carry>>=8}while(carry>0){bytes.push(carry&255);carry>>=8}}for(var k=0;input[k]===first&&k<input.length-1;++k){bytes.push(0)}if(typeof Buffer!=="undefined"){return Buffer.from(bytes.reverse())}return new Uint8Array(bytes.reverse())};function _encodeWithByteBuffer(input,alphabet){var i=0;var base=alphabet.length;var first=alphabet.charAt(0);var digits=[0];for(i=0;i<input.length();++i){for(var j=0,carry=input.at(i);j<digits.length;++j){carry+=digits[j]<<8;digits[j]=carry%base;carry=carry/base|0}while(carry>0){digits.push(carry%base);carry=carry/base|0}}var output="";for(i=0;input.at(i)===0&&i<input.length()-1;++i){output+=first}for(i=digits.length-1;i>=0;--i){output+=alphabet[digits[i]]}return output}}).call(this,require("buffer").Buffer)},{buffer:44}],74:[function(require,module,exports){module.exports={options:{usePureJavaScript:false}}},{}],75:[function(require,module,exports){var forge=require("./forge");module.exports=forge.md=forge.md||{};forge.md.algorithms=forge.md.algorithms||{}},{"./forge":74}],76:[function(require,module,exports){var forge=require("./forge");require("./md");require("./util");var sha1=module.exports=forge.sha1=forge.sha1||{};forge.md.sha1=forge.md.algorithms.sha1=sha1;sha1.create=function(){if(!_initialized){_init()}var _state=null;var _input=forge.util.createBuffer();var _w=new Array(80);var md={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};md.start=function(){md.messageLength=0;md.fullMessageLength=md.messageLength64=[];var int32s=md.messageLengthSize/4;for(var i=0;i<int32s;++i){md.fullMessageLength.push(0)}_input=forge.util.createBuffer();_state={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520};return md};md.start();md.update=function(msg,encoding){if(encoding==="utf8"){msg=forge.util.encodeUtf8(msg)}var len=msg.length;md.messageLength+=len;len=[len/4294967296>>>0,len>>>0];for(var i=md.fullMessageLength.length-1;i>=0;--i){md.fullMessageLength[i]+=len[1];len[1]=len[0]+(md.fullMessageLength[i]/4294967296>>>0);md.fullMessageLength[i]=md.fullMessageLength[i]>>>0;len[0]=len[1]/4294967296>>>0}_input.putBytes(msg);_update(_state,_w,_input);if(_input.read>2048||_input.length()===0){_input.compact()}return md};md.digest=function(){var finalBlock=forge.util.createBuffer();finalBlock.putBytes(_input.bytes());var remaining=md.fullMessageLength[md.fullMessageLength.length-1]+md.messageLengthSize;var overflow=remaining&md.blockLength-1;finalBlock.putBytes(_padding.substr(0,md.blockLength-overflow));var next,carry;var bits=md.fullMessageLength[0]*8;for(var i=0;i<md.fullMessageLength.length-1;++i){next=md.fullMessageLength[i+1]*8;carry=next/4294967296>>>0;bits+=carry;finalBlock.putInt32(bits>>>0);bits=next>>>0}finalBlock.putInt32(bits);var s2={h0:_state.h0,h1:_state.h1,h2:_state.h2,h3:_state.h3,h4:_state.h4};_update(s2,_w,finalBlock);var rval=forge.util.createBuffer();rval.putInt32(s2.h0);rval.putInt32(s2.h1);rval.putInt32(s2.h2);rval.putInt32(s2.h3);rval.putInt32(s2.h4);return rval};return md};var _padding=null;var _initialized=false;function _init(){_padding=String.fromCharCode(128);_padding+=forge.util.fillString(String.fromCharCode(0),64);_initialized=true}function _update(s,w,bytes){var t,a,b,c,d,e,f,i;var len=bytes.length();while(len>=64){a=s.h0;b=s.h1;c=s.h2;d=s.h3;e=s.h4;for(i=0;i<16;++i){t=bytes.getInt32();w[i]=t;f=d^b&(c^d);t=(a<<5|a>>>27)+f+e+1518500249+t;e=d;d=c;c=(b<<30|b>>>2)>>>0;b=a;a=t}for(;i<20;++i){t=w[i-3]^w[i-8]^w[i-14]^w[i-16];t=t<<1|t>>>31;w[i]=t;f=d^b&(c^d);t=(a<<5|a>>>27)+f+e+1518500249+t;e=d;d=c;c=(b<<30|b>>>2)>>>0;b=a;a=t}for(;i<32;++i){t=w[i-3]^w[i-8]^w[i-14]^w[i-16];t=t<<1|t>>>31;w[i]=t;f=b^c^d;t=(a<<5|a>>>27)+f+e+1859775393+t;e=d;d=c;c=(b<<30|b>>>2)>>>0;b=a;a=t}for(;i<40;++i){t=w[i-6]^w[i-16]^w[i-28]^w[i-32];t=t<<2|t>>>30;w[i]=t;f=b^c^d;t=(a<<5|a>>>27)+f+e+1859775393+t;e=d;d=c;c=(b<<30|b>>>2)>>>0;b=a;a=t}for(;i<60;++i){t=w[i-6]^w[i-16]^w[i-28]^w[i-32];t=t<<2|t>>>30;w[i]=t;f=b&c|d&(b^c);t=(a<<5|a>>>27)+f+e+2400959708+t;e=d;d=c;c=(b<<30|b>>>2)>>>0;b=a;a=t}for(;i<80;++i){t=w[i-6]^w[i-16]^w[i-28]^w[i-32];t=t<<2|t>>>30;w[i]=t;f=b^c^d;t=(a<<5|a>>>27)+f+e+3395469782+t;e=d;d=c;c=(b<<30|b>>>2)>>>0;b=a;a=t}s.h0=s.h0+a|0;s.h1=s.h1+b|0;s.h2=s.h2+c|0;s.h3=s.h3+d|0;s.h4=s.h4+e|0;len-=64}}},{"./forge":74,"./md":75,"./util":78}],77:[function(require,module,exports){var forge=require("./forge");require("./md");require("./util");var sha256=module.exports=forge.sha256=forge.sha256||{};forge.md.sha256=forge.md.algorithms.sha256=sha256;sha256.create=function(){if(!_initialized){_init()}var _state=null;var _input=forge.util.createBuffer();var _w=new Array(64);var md={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};md.start=function(){md.messageLength=0;md.fullMessageLength=md.messageLength64=[];var int32s=md.messageLengthSize/4;for(var i=0;i<int32s;++i){md.fullMessageLength.push(0)}_input=forge.util.createBuffer();_state={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225};return md};md.start();md.update=function(msg,encoding){if(encoding==="utf8"){msg=forge.util.encodeUtf8(msg)}var len=msg.length;md.messageLength+=len;len=[len/4294967296>>>0,len>>>0];for(var i=md.fullMessageLength.length-1;i>=0;--i){md.fullMessageLength[i]+=len[1];len[1]=len[0]+(md.fullMessageLength[i]/4294967296>>>0);md.fullMessageLength[i]=md.fullMessageLength[i]>>>0;len[0]=len[1]/4294967296>>>0}_input.putBytes(msg);_update(_state,_w,_input);if(_input.read>2048||_input.length()===0){_input.compact()}return md};md.digest=function(){var finalBlock=forge.util.createBuffer();finalBlock.putBytes(_input.bytes());var remaining=md.fullMessageLength[md.fullMessageLength.length-1]+md.messageLengthSize;var overflow=remaining&md.blockLength-1;finalBlock.putBytes(_padding.substr(0,md.blockLength-overflow));var next,carry;var bits=md.fullMessageLength[0]*8;for(var i=0;i<md.fullMessageLength.length-1;++i){next=md.fullMessageLength[i+1]*8;carry=next/4294967296>>>0;bits+=carry;finalBlock.putInt32(bits>>>0);bits=next>>>0}finalBlock.putInt32(bits);var s2={h0:_state.h0,h1:_state.h1,h2:_state.h2,h3:_state.h3,h4:_state.h4,h5:_state.h5,h6:_state.h6,h7:_state.h7};_update(s2,_w,finalBlock);var rval=forge.util.createBuffer();rval.putInt32(s2.h0);rval.putInt32(s2.h1);rval.putInt32(s2.h2);rval.putInt32(s2.h3);rval.putInt32(s2.h4);rval.putInt32(s2.h5);rval.putInt32(s2.h6);rval.putInt32(s2.h7);return rval};return md};var _padding=null;var _initialized=false;var _k=null;function _init(){_padding=String.fromCharCode(128);_padding+=forge.util.fillString(String.fromCharCode(0),64);_k=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];_initialized=true}function _update(s,w,bytes){var t1,t2,s0,s1,ch,maj,i,a,b,c,d,e,f,g,h;var len=bytes.length();while(len>=64){for(i=0;i<16;++i){w[i]=bytes.getInt32()}for(;i<64;++i){t1=w[i-2];t1=(t1>>>17|t1<<15)^(t1>>>19|t1<<13)^t1>>>10;t2=w[i-15];t2=(t2>>>7|t2<<25)^(t2>>>18|t2<<14)^t2>>>3;w[i]=t1+w[i-7]+t2+w[i-16]|0}a=s.h0;b=s.h1;c=s.h2;d=s.h3;e=s.h4;f=s.h5;g=s.h6;h=s.h7;for(i=0;i<64;++i){s1=(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7);ch=g^e&(f^g);s0=(a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10);maj=a&b|c&(a^b);t1=h+s1+ch+_k[i]+w[i];t2=s0+maj;h=g;g=f;f=e;e=d+t1>>>0;d=c;c=b;b=a;a=t1+t2>>>0}s.h0=s.h0+a|0;s.h1=s.h1+b|0;s.h2=s.h2+c|0;s.h3=s.h3+d|0;s.h4=s.h4+e|0;s.h5=s.h5+f|0;s.h6=s.h6+g|0;s.h7=s.h7+h|0;len-=64}}},{"./forge":74,"./md":75,"./util":78}],78:[function(require,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,setImmediate){var forge=require("./forge");var baseN=require("./baseN");var util=module.exports=forge.util=forge.util||{};(function(){if(typeof process!=="undefined"&&process.nextTick&&!process.browser){util.nextTick=process.nextTick;if(typeof setImmediate==="function"){util.setImmediate=setImmediate}else{util.setImmediate=util.nextTick}return}if(typeof setImmediate==="function"){util.setImmediate=function(){return setImmediate.apply(undefined,arguments)};util.nextTick=function(callback){return setImmediate(callback)};return}util.setImmediate=function(callback){setTimeout(callback,0)};if(typeof window!=="undefined"&&typeof window.postMessage==="function"){var msg="forge.setImmediate";var callbacks=[];util.setImmediate=function(callback){callbacks.push(callback);if(callbacks.length===1){window.postMessage(msg,"*")}};function handler(event){if(event.source===window&&event.data===msg){event.stopPropagation();var copy=callbacks.slice();callbacks.length=0;copy.forEach((function(callback){callback()}))}}window.addEventListener("message",handler,true)}if(typeof MutationObserver!=="undefined"){var now=Date.now();var attr=true;var div=document.createElement("div");var callbacks=[];new MutationObserver((function(){var copy=callbacks.slice();callbacks.length=0;copy.forEach((function(callback){callback()}))})).observe(div,{attributes:true});var oldSetImmediate=util.setImmediate;util.setImmediate=function(callback){if(Date.now()-now>15){now=Date.now();oldSetImmediate(callback)}else{callbacks.push(callback);if(callbacks.length===1){div.setAttribute("a",attr=!attr)}}}}util.nextTick=util.setImmediate})();util.isNodejs=typeof process!=="undefined"&&process.versions&&process.versions.node;util.globalScope=function(){if(util.isNodejs){return global}return typeof self==="undefined"?window:self}();util.isArray=Array.isArray||function(x){return Object.prototype.toString.call(x)==="[object Array]"};util.isArrayBuffer=function(x){return typeof ArrayBuffer!=="undefined"&&x instanceof ArrayBuffer};util.isArrayBufferView=function(x){return x&&util.isArrayBuffer(x.buffer)&&x.byteLength!==undefined};function _checkBitsParam(n){if(!(n===8||n===16||n===24||n===32)){throw new Error("Only 8, 16, 24, or 32 bits supported: "+n)}}util.ByteBuffer=ByteStringBuffer;function ByteStringBuffer(b){this.data="";this.read=0;if(typeof b==="string"){this.data=b}else if(util.isArrayBuffer(b)||util.isArrayBufferView(b)){if(typeof Buffer!=="undefined"&&b instanceof Buffer){this.data=b.toString("binary")}else{var arr=new Uint8Array(b);try{this.data=String.fromCharCode.apply(null,arr)}catch(e){for(var i=0;i<arr.length;++i){this.putByte(arr[i])}}}}else if(b instanceof ByteStringBuffer||typeof b==="object"&&typeof b.data==="string"&&typeof b.read==="number"){this.data=b.data;this.read=b.read}this._constructedStringLength=0}util.ByteStringBuffer=ByteStringBuffer;var _MAX_CONSTRUCTED_STRING_LENGTH=4096;util.ByteStringBuffer.prototype._optimizeConstructedString=function(x){this._constructedStringLength+=x;if(this._constructedStringLength>_MAX_CONSTRUCTED_STRING_LENGTH){this.data.substr(0,1);this._constructedStringLength=0}};util.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};util.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};util.ByteStringBuffer.prototype.putByte=function(b){return this.putBytes(String.fromCharCode(b))};util.ByteStringBuffer.prototype.fillWithByte=function(b,n){b=String.fromCharCode(b);var d=this.data;while(n>0){if(n&1){d+=b}n>>>=1;if(n>0){b+=b}}this.data=d;this._optimizeConstructedString(n);return this};util.ByteStringBuffer.prototype.putBytes=function(bytes){this.data+=bytes;this._optimizeConstructedString(bytes.length);return this};util.ByteStringBuffer.prototype.putString=function(str){return this.putBytes(util.encodeUtf8(str))};util.ByteStringBuffer.prototype.putInt16=function(i){return this.putBytes(String.fromCharCode(i>>8&255)+String.fromCharCode(i&255))};util.ByteStringBuffer.prototype.putInt24=function(i){return this.putBytes(String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255))};util.ByteStringBuffer.prototype.putInt32=function(i){return this.putBytes(String.fromCharCode(i>>24&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255))};util.ByteStringBuffer.prototype.putInt16Le=function(i){return this.putBytes(String.fromCharCode(i&255)+String.fromCharCode(i>>8&255))};util.ByteStringBuffer.prototype.putInt24Le=function(i){return this.putBytes(String.fromCharCode(i&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i>>16&255))};util.ByteStringBuffer.prototype.putInt32Le=function(i){return this.putBytes(String.fromCharCode(i&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>24&255))};util.ByteStringBuffer.prototype.putInt=function(i,n){_checkBitsParam(n);var bytes="";do{n-=8;bytes+=String.fromCharCode(i>>n&255)}while(n>0);return this.putBytes(bytes)};util.ByteStringBuffer.prototype.putSignedInt=function(i,n){if(i<0){i+=2<<n-1}return this.putInt(i,n)};util.ByteStringBuffer.prototype.putBuffer=function(buffer){return this.putBytes(buffer.getBytes())};util.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};util.ByteStringBuffer.prototype.getInt16=function(){var rval=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);this.read+=2;return rval};util.ByteStringBuffer.prototype.getInt24=function(){var rval=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);this.read+=3;return rval};util.ByteStringBuffer.prototype.getInt32=function(){var rval=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);this.read+=4;return rval};util.ByteStringBuffer.prototype.getInt16Le=function(){var rval=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;this.read+=2;return rval};util.ByteStringBuffer.prototype.getInt24Le=function(){var rval=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;this.read+=3;return rval};util.ByteStringBuffer.prototype.getInt32Le=function(){var rval=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;this.read+=4;return rval};util.ByteStringBuffer.prototype.getInt=function(n){_checkBitsParam(n);var rval=0;do{rval=(rval<<8)+this.data.charCodeAt(this.read++);n-=8}while(n>0);return rval};util.ByteStringBuffer.prototype.getSignedInt=function(n){var x=this.getInt(n);var max=2<<n-2;if(x>=max){x-=max<<1}return x};util.ByteStringBuffer.prototype.getBytes=function(count){var rval;if(count){count=Math.min(this.length(),count);rval=this.data.slice(this.read,this.read+count);this.read+=count}else if(count===0){rval=""}else{rval=this.read===0?this.data:this.data.slice(this.read);this.clear()}return rval};util.ByteStringBuffer.prototype.bytes=function(count){return typeof count==="undefined"?this.data.slice(this.read):this.data.slice(this.read,this.read+count)};util.ByteStringBuffer.prototype.at=function(i){return this.data.charCodeAt(this.read+i)};util.ByteStringBuffer.prototype.setAt=function(i,b){this.data=this.data.substr(0,this.read+i)+String.fromCharCode(b)+this.data.substr(this.read+i+1);return this};util.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};util.ByteStringBuffer.prototype.copy=function(){var c=util.createBuffer(this.data);c.read=this.read;return c};util.ByteStringBuffer.prototype.compact=function(){if(this.read>0){this.data=this.data.slice(this.read);this.read=0}return this};util.ByteStringBuffer.prototype.clear=function(){this.data="";this.read=0;return this};util.ByteStringBuffer.prototype.truncate=function(count){var len=Math.max(0,this.length()-count);this.data=this.data.substr(this.read,len);this.read=0;return this};util.ByteStringBuffer.prototype.toHex=function(){var rval="";for(var i=this.read;i<this.data.length;++i){var b=this.data.charCodeAt(i);if(b<16){rval+="0"}rval+=b.toString(16)}return rval};util.ByteStringBuffer.prototype.toString=function(){return util.decodeUtf8(this.bytes())};function DataBuffer(b,options){options=options||{};this.read=options.readOffset||0;this.growSize=options.growSize||1024;var isArrayBuffer=util.isArrayBuffer(b);var isArrayBufferView=util.isArrayBufferView(b);if(isArrayBuffer||isArrayBufferView){if(isArrayBuffer){this.data=new DataView(b)}else{this.data=new DataView(b.buffer,b.byteOffset,b.byteLength)}this.write="writeOffset"in options?options.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0));this.write=0;if(b!==null&&b!==undefined){this.putBytes(b)}if("writeOffset"in options){this.write=options.writeOffset}}util.DataBuffer=DataBuffer;util.DataBuffer.prototype.length=function(){return this.write-this.read};util.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};util.DataBuffer.prototype.accommodate=function(amount,growSize){if(this.length()>=amount){return this}growSize=Math.max(growSize||this.growSize,amount);var src=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);var dst=new Uint8Array(this.length()+growSize);dst.set(src);this.data=new DataView(dst.buffer);return this};util.DataBuffer.prototype.putByte=function(b){this.accommodate(1);this.data.setUint8(this.write++,b);return this};util.DataBuffer.prototype.fillWithByte=function(b,n){this.accommodate(n);for(var i=0;i<n;++i){this.data.setUint8(b)}return this};util.DataBuffer.prototype.putBytes=function(bytes,encoding){if(util.isArrayBufferView(bytes)){var src=new Uint8Array(bytes.buffer,bytes.byteOffset,bytes.byteLength);var len=src.byteLength-src.byteOffset;this.accommodate(len);var dst=new Uint8Array(this.data.buffer,this.write);dst.set(src);this.write+=len;return this}if(util.isArrayBuffer(bytes)){var src=new Uint8Array(bytes);this.accommodate(src.byteLength);var dst=new Uint8Array(this.data.buffer);dst.set(src,this.write);this.write+=src.byteLength;return this}if(bytes instanceof util.DataBuffer||typeof bytes==="object"&&typeof bytes.read==="number"&&typeof bytes.write==="number"&&util.isArrayBufferView(bytes.data)){var src=new Uint8Array(bytes.data.byteLength,bytes.read,bytes.length());this.accommodate(src.byteLength);var dst=new Uint8Array(bytes.data.byteLength,this.write);dst.set(src);this.write+=src.byteLength;return this}if(bytes instanceof util.ByteStringBuffer){bytes=bytes.data;encoding="binary"}encoding=encoding||"binary";if(typeof bytes==="string"){var view;if(encoding==="hex"){this.accommodate(Math.ceil(bytes.length/2));view=new Uint8Array(this.data.buffer,this.write);this.write+=util.binary.hex.decode(bytes,view,this.write);return this}if(encoding==="base64"){this.accommodate(Math.ceil(bytes.length/4)*3);view=new Uint8Array(this.data.buffer,this.write);this.write+=util.binary.base64.decode(bytes,view,this.write);return this}if(encoding==="utf8"){bytes=util.encodeUtf8(bytes);encoding="binary"}if(encoding==="binary"||encoding==="raw"){this.accommodate(bytes.length);view=new Uint8Array(this.data.buffer,this.write);this.write+=util.binary.raw.decode(view);return this}if(encoding==="utf16"){this.accommodate(bytes.length*2);view=new Uint16Array(this.data.buffer,this.write);this.write+=util.text.utf16.encode(view);return this}throw new Error("Invalid encoding: "+encoding)}throw Error("Invalid parameter: "+bytes)};util.DataBuffer.prototype.putBuffer=function(buffer){this.putBytes(buffer);buffer.clear();return this};util.DataBuffer.prototype.putString=function(str){return this.putBytes(str,"utf16")};util.DataBuffer.prototype.putInt16=function(i){this.accommodate(2);this.data.setInt16(this.write,i);this.write+=2;return this};util.DataBuffer.prototype.putInt24=function(i){this.accommodate(3);this.data.setInt16(this.write,i>>8&65535);this.data.setInt8(this.write,i>>16&255);this.write+=3;return this};util.DataBuffer.prototype.putInt32=function(i){this.accommodate(4);this.data.setInt32(this.write,i);this.write+=4;return this};util.DataBuffer.prototype.putInt16Le=function(i){this.accommodate(2);this.data.setInt16(this.write,i,true);this.write+=2;return this};util.DataBuffer.prototype.putInt24Le=function(i){this.accommodate(3);this.data.setInt8(this.write,i>>16&255);this.data.setInt16(this.write,i>>8&65535,true);this.write+=3;return this};util.DataBuffer.prototype.putInt32Le=function(i){this.accommodate(4);this.data.setInt32(this.write,i,true);this.write+=4;return this};util.DataBuffer.prototype.putInt=function(i,n){_checkBitsParam(n);this.accommodate(n/8);do{n-=8;this.data.setInt8(this.write++,i>>n&255)}while(n>0);return this};util.DataBuffer.prototype.putSignedInt=function(i,n){_checkBitsParam(n);this.accommodate(n/8);if(i<0){i+=2<<n-1}return this.putInt(i,n)};util.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};util.DataBuffer.prototype.getInt16=function(){var rval=this.data.getInt16(this.read);this.read+=2;return rval};util.DataBuffer.prototype.getInt24=function(){var rval=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);this.read+=3;return rval};util.DataBuffer.prototype.getInt32=function(){var rval=this.data.getInt32(this.read);this.read+=4;return rval};util.DataBuffer.prototype.getInt16Le=function(){var rval=this.data.getInt16(this.read,true);this.read+=2;return rval};util.DataBuffer.prototype.getInt24Le=function(){var rval=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,true)<<8;this.read+=3;return rval};util.DataBuffer.prototype.getInt32Le=function(){var rval=this.data.getInt32(this.read,true);this.read+=4;return rval};util.DataBuffer.prototype.getInt=function(n){_checkBitsParam(n);var rval=0;do{rval=(rval<<8)+this.data.getInt8(this.read++);n-=8}while(n>0);return rval};util.DataBuffer.prototype.getSignedInt=function(n){var x=this.getInt(n);var max=2<<n-2;if(x>=max){x-=max<<1}return x};util.DataBuffer.prototype.getBytes=function(count){var rval;if(count){count=Math.min(this.length(),count);rval=this.data.slice(this.read,this.read+count);this.read+=count}else if(count===0){rval=""}else{rval=this.read===0?this.data:this.data.slice(this.read);this.clear()}return rval};util.DataBuffer.prototype.bytes=function(count){return typeof count==="undefined"?this.data.slice(this.read):this.data.slice(this.read,this.read+count)};util.DataBuffer.prototype.at=function(i){return this.data.getUint8(this.read+i)};util.DataBuffer.prototype.setAt=function(i,b){this.data.setUint8(i,b);return this};util.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};util.DataBuffer.prototype.copy=function(){return new util.DataBuffer(this)};util.DataBuffer.prototype.compact=function(){if(this.read>0){var src=new Uint8Array(this.data.buffer,this.read);var dst=new Uint8Array(src.byteLength);dst.set(src);this.data=new DataView(dst);this.write-=this.read;this.read=0}return this};util.DataBuffer.prototype.clear=function(){this.data=new DataView(new ArrayBuffer(0));this.read=this.write=0;return this};util.DataBuffer.prototype.truncate=function(count){this.write=Math.max(0,this.length()-count);this.read=Math.min(this.read,this.write);return this};util.DataBuffer.prototype.toHex=function(){var rval="";for(var i=this.read;i<this.data.byteLength;++i){var b=this.data.getUint8(i);if(b<16){rval+="0"}rval+=b.toString(16)}return rval};util.DataBuffer.prototype.toString=function(encoding){var view=new Uint8Array(this.data,this.read,this.length());encoding=encoding||"utf8";if(encoding==="binary"||encoding==="raw"){return util.binary.raw.encode(view)}if(encoding==="hex"){return util.binary.hex.encode(view)}if(encoding==="base64"){return util.binary.base64.encode(view)}if(encoding==="utf8"){return util.text.utf8.decode(view)}if(encoding==="utf16"){return util.text.utf16.decode(view)}throw new Error("Invalid encoding: "+encoding)};util.createBuffer=function(input,encoding){encoding=encoding||"raw";if(input!==undefined&&encoding==="utf8"){input=util.encodeUtf8(input)}return new util.ByteBuffer(input)};util.fillString=function(c,n){var s="";while(n>0){if(n&1){s+=c}n>>>=1;if(n>0){c+=c}}return s};util.xorBytes=function(s1,s2,n){var s3="";var b="";var t="";var i=0;var c=0;for(;n>0;--n,++i){b=s1.charCodeAt(i)^s2.charCodeAt(i);if(c>=10){s3+=t;t="";c=0}t+=String.fromCharCode(b);++c}s3+=t;return s3};util.hexToBytes=function(hex){var rval="";var i=0;if(hex.length&1==1){i=1;rval+=String.fromCharCode(parseInt(hex[0],16))}for(;i<hex.length;i+=2){rval+=String.fromCharCode(parseInt(hex.substr(i,2),16))}return rval};util.bytesToHex=function(bytes){return util.createBuffer(bytes).toHex()};util.int32ToBytes=function(i){return String.fromCharCode(i>>24&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255)};var _base64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var _base64Idx=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];var _base58="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";util.encode64=function(input,maxline){var line="";var output="";var chr1,chr2,chr3;var i=0;while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);line+=_base64.charAt(chr1>>2);line+=_base64.charAt((chr1&3)<<4|chr2>>4);if(isNaN(chr2)){line+="=="}else{line+=_base64.charAt((chr2&15)<<2|chr3>>6);line+=isNaN(chr3)?"=":_base64.charAt(chr3&63)}if(maxline&&line.length>maxline){output+=line.substr(0,maxline)+"\r\n";line=line.substr(maxline)}}output+=line;return output};util.decode64=function(input){input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");var output="";var enc1,enc2,enc3,enc4;var i=0;while(i<input.length){enc1=_base64Idx[input.charCodeAt(i++)-43];enc2=_base64Idx[input.charCodeAt(i++)-43];enc3=_base64Idx[input.charCodeAt(i++)-43];enc4=_base64Idx[input.charCodeAt(i++)-43];output+=String.fromCharCode(enc1<<2|enc2>>4);if(enc3!==64){output+=String.fromCharCode((enc2&15)<<4|enc3>>2);if(enc4!==64){output+=String.fromCharCode((enc3&3)<<6|enc4)}}}return output};util.encodeUtf8=function(str){return unescape(encodeURIComponent(str))};util.decodeUtf8=function(str){return decodeURIComponent(escape(str))};util.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:baseN.encode,decode:baseN.decode}};util.binary.raw.encode=function(bytes){return String.fromCharCode.apply(null,bytes)};util.binary.raw.decode=function(str,output,offset){var out=output;if(!out){out=new Uint8Array(str.length)}offset=offset||0;var j=offset;for(var i=0;i<str.length;++i){out[j++]=str.charCodeAt(i)}return output?j-offset:out};util.binary.hex.encode=util.bytesToHex;util.binary.hex.decode=function(hex,output,offset){var out=output;if(!out){out=new Uint8Array(Math.ceil(hex.length/2))}offset=offset||0;var i=0,j=offset;if(hex.length&1){i=1;out[j++]=parseInt(hex[0],16)}for(;i<hex.length;i+=2){out[j++]=parseInt(hex.substr(i,2),16)}return output?j-offset:out};util.binary.base64.encode=function(input,maxline){var line="";var output="";var chr1,chr2,chr3;var i=0;while(i<input.byteLength){chr1=input[i++];chr2=input[i++];chr3=input[i++];line+=_base64.charAt(chr1>>2);line+=_base64.charAt((chr1&3)<<4|chr2>>4);if(isNaN(chr2)){line+="=="}else{line+=_base64.charAt((chr2&15)<<2|chr3>>6);line+=isNaN(chr3)?"=":_base64.charAt(chr3&63)}if(maxline&&line.length>maxline){output+=line.substr(0,maxline)+"\r\n";line=line.substr(maxline)}}output+=line;return output};util.binary.base64.decode=function(input,output,offset){var out=output;if(!out){out=new Uint8Array(Math.ceil(input.length/4)*3)}input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");offset=offset||0;var enc1,enc2,enc3,enc4;var i=0,j=offset;while(i<input.length){enc1=_base64Idx[input.charCodeAt(i++)-43];enc2=_base64Idx[input.charCodeAt(i++)-43];enc3=_base64Idx[input.charCodeAt(i++)-43];enc4=_base64Idx[input.charCodeAt(i++)-43];out[j++]=enc1<<2|enc2>>4;if(enc3!==64){out[j++]=(enc2&15)<<4|enc3>>2;if(enc4!==64){out[j++]=(enc3&3)<<6|enc4}}}return output?j-offset:out.subarray(0,j)};util.binary.base58.encode=function(input,maxline){return util.binary.baseN.encode(input,_base58,maxline)};util.binary.base58.decode=function(input,maxline){return util.binary.baseN.decode(input,_base58,maxline)};util.text={utf8:{},utf16:{}};util.text.utf8.encode=function(str,output,offset){str=util.encodeUtf8(str);var out=output;if(!out){out=new Uint8Array(str.length)}offset=offset||0;var j=offset;for(var i=0;i<str.length;++i){out[j++]=str.charCodeAt(i)}return output?j-offset:out};util.text.utf8.decode=function(bytes){return util.decodeUtf8(String.fromCharCode.apply(null,bytes))};util.text.utf16.encode=function(str,output,offset){var out=output;if(!out){out=new Uint8Array(str.length*2)}var view=new Uint16Array(out.buffer);offset=offset||0;var j=offset;var k=offset;for(var i=0;i<str.length;++i){view[k++]=str.charCodeAt(i);j+=2}return output?j-offset:out};util.text.utf16.decode=function(bytes){return String.fromCharCode.apply(null,new Uint16Array(bytes.buffer))};util.deflate=function(api,bytes,raw){bytes=util.decode64(api.deflate(util.encode64(bytes)).rval);if(raw){var start=2;var flg=bytes.charCodeAt(1);if(flg&32){start=6}bytes=bytes.substring(start,bytes.length-4)}return bytes};util.inflate=function(api,bytes,raw){var rval=api.inflate(util.encode64(bytes)).rval;return rval===null?null:util.decode64(rval)};var _setStorageObject=function(api,id,obj){if(!api){throw new Error("WebStorage not available.")}var rval;if(obj===null){rval=api.removeItem(id)}else{obj=util.encode64(JSON.stringify(obj));rval=api.setItem(id,obj)}if(typeof rval!=="undefined"&&rval.rval!==true){var error=new Error(rval.error.message);error.id=rval.error.id;error.name=rval.error.name;throw error}};var _getStorageObject=function(api,id){if(!api){throw new Error("WebStorage not available.")}var rval=api.getItem(id);if(api.init){if(rval.rval===null){if(rval.error){var error=new Error(rval.error.message);error.id=rval.error.id;error.name=rval.error.name;throw error}rval=null}else{rval=rval.rval}}if(rval!==null){rval=JSON.parse(util.decode64(rval))}return rval};var _setItem=function(api,id,key,data){var obj=_getStorageObject(api,id);if(obj===null){obj={}}obj[key]=data;_setStorageObject(api,id,obj)};var _getItem=function(api,id,key){var rval=_getStorageObject(api,id);if(rval!==null){rval=key in rval?rval[key]:null}return rval};var _removeItem=function(api,id,key){var obj=_getStorageObject(api,id);if(obj!==null&&key in obj){delete obj[key];var empty=true;for(var prop in obj){empty=false;break}if(empty){obj=null}_setStorageObject(api,id,obj)}};var _clearItems=function(api,id){_setStorageObject(api,id,null)};var _callStorageFunction=function(func,args,location){var rval=null;if(typeof location==="undefined"){location=["web","flash"]}var type;var done=false;var exception=null;for(var idx in location){type=location[idx];try{if(type==="flash"||type==="both"){if(args[0]===null){throw new Error("Flash local storage not available.")}rval=func.apply(this,args);done=type==="flash"}if(type==="web"||type==="both"){args[0]=localStorage;rval=func.apply(this,args);done=true}}catch(ex){exception=ex}if(done){break}}if(!done){throw exception}return rval};util.setItem=function(api,id,key,data,location){_callStorageFunction(_setItem,arguments,location)};util.getItem=function(api,id,key,location){return _callStorageFunction(_getItem,arguments,location)};util.removeItem=function(api,id,key,location){_callStorageFunction(_removeItem,arguments,location)};util.clearItems=function(api,id,location){_callStorageFunction(_clearItems,arguments,location)};util.parseUrl=function(str){var regex=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;regex.lastIndex=0;var m=regex.exec(str);var url=m===null?null:{full:str,scheme:m[1],host:m[2],port:m[3],path:m[4]};if(url){url.fullHost=url.host;if(url.port){if(url.port!==80&&url.scheme==="http"){url.fullHost+=":"+url.port}else if(url.port!==443&&url.scheme==="https"){url.fullHost+=":"+url.port}}else if(url.scheme==="http"){url.port=80}else if(url.scheme==="https"){url.port=443}url.full=url.scheme+"://"+url.fullHost}return url};var _queryVariables=null;util.getQueryVariables=function(query){var parse=function(q){var rval={};var kvpairs=q.split("&");for(var i=0;i<kvpairs.length;i++){var pos=kvpairs[i].indexOf("=");var key;var val;if(pos>0){key=kvpairs[i].substring(0,pos);val=kvpairs[i].substring(pos+1)}else{key=kvpairs[i];val=null}if(!(key in rval)){rval[key]=[]}if(!(key in Object.prototype)&&val!==null){rval[key].push(unescape(val))}}return rval};var rval;if(typeof query==="undefined"){if(_queryVariables===null){if(typeof window!=="undefined"&&window.location&&window.location.search){_queryVariables=parse(window.location.search.substring(1))}else{_queryVariables={}}}rval=_queryVariables}else{rval=parse(query)}return rval};util.parseFragment=function(fragment){var fp=fragment;var fq="";var pos=fragment.indexOf("?");if(pos>0){fp=fragment.substring(0,pos);fq=fragment.substring(pos+1)}var path=fp.split("/");if(path.length>0&&path[0]===""){path.shift()}var query=fq===""?{}:util.getQueryVariables(fq);return{pathString:fp,queryString:fq,path:path,query:query}};util.makeRequest=function(reqString){var frag=util.parseFragment(reqString);var req={path:frag.pathString,query:frag.queryString,getPath:function(i){return typeof i==="undefined"?frag.path:frag.path[i]},getQuery:function(k,i){var rval;if(typeof k==="undefined"){rval=frag.query}else{rval=frag.query[k];if(rval&&typeof i!=="undefined"){rval=rval[i]}}return rval},getQueryLast:function(k,_default){var rval;var vals=req.getQuery(k);if(vals){rval=vals[vals.length-1]}else{rval=_default}return rval}};return req};util.makeLink=function(path,query,fragment){path=jQuery.isArray(path)?path.join("/"):path;var qstr=jQuery.param(query||{});fragment=fragment||"";return path+(qstr.length>0?"?"+qstr:"")+(fragment.length>0?"#"+fragment:"")};util.setPath=function(object,keys,value){if(typeof object==="object"&&object!==null){var i=0;var len=keys.length;while(i<len){var next=keys[i++];if(i==len){object[next]=value}else{var hasNext=next in object;if(!hasNext||hasNext&&typeof object[next]!=="object"||hasNext&&object[next]===null){object[next]={}}object=object[next]}}}};util.getPath=function(object,keys,_default){var i=0;var len=keys.length;var hasNext=true;while(hasNext&&i<len&&typeof object==="object"&&object!==null){var next=keys[i++];hasNext=next in object;if(hasNext){object=object[next]}}return hasNext?object:_default};util.deletePath=function(object,keys){if(typeof object==="object"&&object!==null){var i=0;var len=keys.length;while(i<len){var next=keys[i++];if(i==len){delete object[next]}else{if(!(next in object)||typeof object[next]!=="object"||object[next]===null){break}object=object[next]}}}};util.isEmpty=function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){return false}}return true};util.format=function(format){var re=/%./g;var match;var part;var argi=0;var parts=[];var last=0;while(match=re.exec(format)){part=format.substring(last,re.lastIndex-2);if(part.length>0){parts.push(part)}last=re.lastIndex;var code=match[0][1];switch(code){case"s":case"o":if(argi<arguments.length){parts.push(arguments[argi+++1])}else{parts.push("<?>")}break;case"%":parts.push("%");break;default:parts.push("<%"+code+"?>")}}parts.push(format.substring(last));return parts.join("")};util.formatNumber=function(number,decimals,dec_point,thousands_sep){var n=number,c=isNaN(decimals=Math.abs(decimals))?2:decimals;var d=dec_point===undefined?",":dec_point;var t=thousands_sep===undefined?".":thousands_sep,s=n<0?"-":"";var i=parseInt(n=Math.abs(+n||0).toFixed(c),10)+"";var j=i.length>3?i.length%3:0;return s+(j?i.substr(0,j)+t:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+t)+(c?d+Math.abs(n-i).toFixed(c).slice(2):"")};util.formatSize=function(size){if(size>=1073741824){size=util.formatNumber(size/1073741824,2,".","")+" GiB"}else if(size>=1048576){size=util.formatNumber(size/1048576,2,".","")+" MiB"}else if(size>=1024){size=util.formatNumber(size/1024,0)+" KiB"}else{size=util.formatNumber(size,0)+" bytes"}return size};util.bytesFromIP=function(ip){if(ip.indexOf(".")!==-1){return util.bytesFromIPv4(ip)}if(ip.indexOf(":")!==-1){return util.bytesFromIPv6(ip)}return null};util.bytesFromIPv4=function(ip){ip=ip.split(".");if(ip.length!==4){return null}var b=util.createBuffer();for(var i=0;i<ip.length;++i){var num=parseInt(ip[i],10);if(isNaN(num)){return null}b.putByte(num)}return b.getBytes()};util.bytesFromIPv6=function(ip){var blanks=0;ip=ip.split(":").filter((function(e){if(e.length===0)++blanks;return true}));var zeros=(8-ip.length+blanks)*2;var b=util.createBuffer();for(var i=0;i<8;++i){if(!ip[i]||ip[i].length===0){b.fillWithByte(0,zeros);zeros=0;continue}var bytes=util.hexToBytes(ip[i]);if(bytes.length<2){b.putByte(0)}b.putBytes(bytes)}return b.getBytes()};util.bytesToIP=function(bytes){if(bytes.length===4){return util.bytesToIPv4(bytes)}if(bytes.length===16){return util.bytesToIPv6(bytes)}return null};util.bytesToIPv4=function(bytes){if(bytes.length!==4){return null}var ip=[];for(var i=0;i<bytes.length;++i){ip.push(bytes.charCodeAt(i))}return ip.join(".")};util.bytesToIPv6=function(bytes){if(bytes.length!==16){return null}var ip=[];var zeroGroups=[];var zeroMaxGroup=0;for(var i=0;i<bytes.length;i+=2){var hex=util.bytesToHex(bytes[i]+bytes[i+1]);while(hex[0]==="0"&&hex!=="0"){hex=hex.substr(1)}if(hex==="0"){var last=zeroGroups[zeroGroups.length-1];var idx=ip.length;if(!last||idx!==last.end+1){zeroGroups.push({start:idx,end:idx})}else{last.end=idx;if(last.end-last.start>zeroGroups[zeroMaxGroup].end-zeroGroups[zeroMaxGroup].start){zeroMaxGroup=zeroGroups.length-1}}}ip.push(hex)}if(zeroGroups.length>0){var group=zeroGroups[zeroMaxGroup];if(group.end-group.start>0){ip.splice(group.start,group.end-group.start+1,"");if(group.start===0){ip.unshift("")}if(group.end===7){ip.push("")}}}return ip.join(":")};util.estimateCores=function(options,callback){if(typeof options==="function"){callback=options;options={}}options=options||{};if("cores"in util&&!options.update){return callback(null,util.cores)}if(typeof navigator!=="undefined"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0){util.cores=navigator.hardwareConcurrency;return callback(null,util.cores)}if(typeof Worker==="undefined"){util.cores=1;return callback(null,util.cores)}if(typeof Blob==="undefined"){util.cores=2;return callback(null,util.cores)}var blobUrl=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){var st=Date.now();var et=st+4;while(Date.now()<et);self.postMessage({st:st,et:et})}))}.toString(),")()"],{type:"application/javascript"}));sample([],5,16);function sample(max,samples,numWorkers){if(samples===0){var avg=Math.floor(max.reduce((function(avg,x){return avg+x}),0)/max.length);util.cores=Math.max(1,avg);URL.revokeObjectURL(blobUrl);return callback(null,util.cores)}map(numWorkers,(function(err,results){max.push(reduce(numWorkers,results));sample(max,samples-1,numWorkers)}))}function map(numWorkers,callback){var workers=[];var results=[];for(var i=0;i<numWorkers;++i){var worker=new Worker(blobUrl);worker.addEventListener("message",(function(e){results.push(e.data);if(results.length===numWorkers){for(var i=0;i<numWorkers;++i){workers[i].terminate()}callback(null,results)}}));workers.push(worker)}for(var i=0;i<numWorkers;++i){workers[i].postMessage(i)}}function reduce(numWorkers,results){var overlaps=[];for(var n=0;n<numWorkers;++n){var r1=results[n];var overlap=overlaps[n]=[];for(var i=0;i<numWorkers;++i){if(n===i){continue}var r2=results[i];if(r1.st>r2.st&&r1.st<r2.et||r2.st>r1.st&&r2.st<r1.et){overlap.push(i)}}}return overlaps.reduce((function(max,overlap){return Math.max(max,overlap.length)}),0)}}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],require("timers").setImmediate)},{"./baseN":73,"./forge":74,_process:79,buffer:44,timers:91}],79:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],80:[function(require,module,exports){"use strict";const util=require("./util");module.exports=class AsyncAlgorithm{constructor({maxCallStackDepth:maxCallStackDepth=500,maxTotalCallStackDepth:maxTotalCallStackDepth=4294967295,timeSlice:timeSlice=10}={}){this.schedule={};this.schedule.MAX_DEPTH=maxCallStackDepth;this.schedule.MAX_TOTAL_DEPTH=maxTotalCallStackDepth;this.schedule.depth=0;this.schedule.totalDepth=0;this.schedule.timeSlice=timeSlice}doWork(fn,callback){const schedule=this.schedule;if(schedule.totalDepth>=schedule.MAX_TOTAL_DEPTH){return callback(new Error("Maximum total call stack depth exceeded; canonicalization aborting."))}(function work(){if(schedule.depth===schedule.MAX_DEPTH){schedule.depth=0;schedule.running=false;return util.nextTick(work)}const now=Date.now();if(!schedule.running){schedule.start=Date.now();schedule.deadline=schedule.start+schedule.timeSlice}if(now<schedule.deadline){schedule.running=true;schedule.depth++;schedule.totalDepth++;return fn((err,result)=>{schedule.depth--;schedule.totalDepth--;callback(err,result)})}schedule.depth=0;schedule.running=false;util.setImmediate(work)})()}forEach(iterable,fn,callback){const self=this;let iterator;let idx=0;let length;if(Array.isArray(iterable)){length=iterable.length;iterator=()=>{if(idx===length){return false}iterator.value=iterable[idx++];iterator.key=idx;return true}}else{const keys=Object.keys(iterable);length=keys.length;iterator=()=>{if(idx===length){return false}iterator.key=keys[idx++];iterator.value=iterable[iterator.key];return true}}(function iterate(err){if(err){return callback(err)}if(iterator()){return self.doWork(()=>fn(iterator.value,iterator.key,iterate))}callback()})()}waterfall(fns,callback){const self=this;self.forEach(fns,(fn,idx,callback)=>self.doWork(fn,callback),callback)}whilst(condition,fn,callback){const self=this;(function loop(err){if(err){return callback(err)}if(!condition()){return callback()}self.doWork(fn,loop)})()}}},{"./util":90}],81:[function(require,module,exports){"use strict";const util=require("./util");module.exports=class IdentifierIssuer{constructor(prefix){this.prefix=prefix;this.counter=0;this.existing={}}clone(){const copy=new IdentifierIssuer(this.prefix);copy.counter=this.counter;copy.existing=util.clone(this.existing);return copy}getId(old){if(old&&old in this.existing){return this.existing[old]}const identifier=this.prefix+this.counter;this.counter+=1;if(old){this.existing[old]=identifier}return identifier}hasId(old){return old in this.existing}}},{"./util":90}],82:[function(require,module,exports){"use strict";const forge=require("node-forge/lib/forge");require("node-forge/lib/md");require("node-forge/lib/sha1");require("node-forge/lib/sha256");module.exports=class MessageDigest{constructor(algorithm){this.md=forge.md[algorithm].create()}update(msg){this.md.update(msg,"utf8")}digest(){return this.md.digest().toHex()}}},{"node-forge/lib/forge":74,"node-forge/lib/md":75,"node-forge/lib/sha1":76,"node-forge/lib/sha256":77}],83:[function(require,module,exports){"use strict";const TERMS=["subject","predicate","object","graph"];const RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";const RDF_LANGSTRING=RDF+"langString";const XSD_STRING="http://www.w3.org/2001/XMLSchema#string";const REGEX={};(()=>{const iri="(?:<([^:]+:[^>]*)>)";const PN_CHARS_BASE="A-Z"+"a-z"+"À-Ö"+"Ø-ö"+"ø-˿"+"Ͱ-ͽ"+"Ϳ-῿"+"‌-‍"+"⁰-↏"+"Ⰰ-⿯"+"、-퟿"+"豈-﷏"+"ﷰ-�";const PN_CHARS_U=PN_CHARS_BASE+"_";const PN_CHARS=PN_CHARS_U+"0-9"+"-"+"·"+"̀-ͯ"+"‿-⁀";const BLANK_NODE_LABEL="(_:"+"(?:["+PN_CHARS_U+"0-9])"+"(?:(?:["+PN_CHARS+".])*(?:["+PN_CHARS+"]))?"+")";const bnode=BLANK_NODE_LABEL;const plain='"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"';const datatype="(?:\\^\\^"+iri+")";const language="(?:@([a-zA-Z]+(?:-[a-zA-Z0-9]+)*))";const literal="(?:"+plain+"(?:"+datatype+"|"+language+")?)";const ws="[ \\t]+";const wso="[ \\t]*";const subject="(?:"+iri+"|"+bnode+")"+ws;const property=iri+ws;const object="(?:"+iri+"|"+bnode+"|"+literal+")"+wso;const graphName="(?:\\.|(?:(?:"+iri+"|"+bnode+")"+wso+"\\.))";REGEX.eoln=/(?:\r\n)|(?:\n)|(?:\r)/g;REGEX.empty=new RegExp("^"+wso+"$");REGEX.quad=new RegExp("^"+wso+subject+property+object+graphName+wso+"$")})();module.exports=class NQuads{static parse(input){const dataset=[];const graphs={};const lines=input.split(REGEX.eoln);let lineNumber=0;for(const line of lines){lineNumber++;if(REGEX.empty.test(line)){continue}const match=line.match(REGEX.quad);if(match===null){throw new Error("N-Quads parse error on line "+lineNumber+".")}const quad={};if(match[1]!==undefined){quad.subject={termType:"NamedNode",value:match[1]}}else{quad.subject={termType:"BlankNode",value:match[2]}}quad.predicate={termType:"NamedNode",value:match[3]};if(match[4]!==undefined){quad.object={termType:"NamedNode",value:match[4]}}else if(match[5]!==undefined){quad.object={termType:"BlankNode",value:match[5]}}else{quad.object={termType:"Literal",value:undefined,datatype:{termType:"NamedNode"}};if(match[7]!==undefined){quad.object.datatype.value=match[7]}else if(match[8]!==undefined){quad.object.datatype.value=RDF_LANGSTRING;quad.object.language=match[8]}else{quad.object.datatype.value=XSD_STRING}quad.object.value=_unescape(match[6])}if(match[9]!==undefined){quad.graph={termType:"NamedNode",value:match[9]}}else if(match[10]!==undefined){quad.graph={termType:"BlankNode",value:match[10]}}else{quad.graph={termType:"DefaultGraph",value:""}}if(!(quad.graph.value in graphs)){graphs[quad.graph.value]=[quad];dataset.push(quad)}else{let unique=true;const quads=graphs[quad.graph.value];for(const q of quads){if(_compareTriples(q,quad)){unique=false;break}}if(unique){quads.push(quad);dataset.push(quad)}}}return dataset}static serialize(dataset){if(!Array.isArray(dataset)){dataset=NQuads.legacyDatasetToQuads(dataset)}const quads=[];for(const quad of dataset){quads.push(NQuads.serializeQuad(quad))}return quads.sort().join("")}static serializeQuad(quad){const s=quad.subject;const p=quad.predicate;const o=quad.object;const g=quad.graph;let nquad="";[s,p].forEach(term=>{if(term.termType==="NamedNode"){nquad+="<"+term.value+">"}else{nquad+=term.value}nquad+=" "});if(o.termType==="NamedNode"){nquad+="<"+o.value+">"}else if(o.termType==="BlankNode"){nquad+=o.value}else{nquad+='"'+_escape(o.value)+'"';if(o.datatype.value===RDF_LANGSTRING){if(o.language){nquad+="@"+o.language}}else if(o.datatype.value!==XSD_STRING){nquad+="^^<"+o.datatype.value+">"}}if(g.termType==="NamedNode"){nquad+=" <"+g.value+">"}else if(g.termType==="BlankNode"){nquad+=" "+g.value}nquad+=" .\n";return nquad}static legacyDatasetToQuads(dataset){const quads=[];const termTypeMap={"blank node":"BlankNode",IRI:"NamedNode",literal:"Literal"};for(const graphName in dataset){const triples=dataset[graphName];triples.forEach(triple=>{const quad={};for(const componentName in triple){const oldComponent=triple[componentName];const newComponent={termType:termTypeMap[oldComponent.type],value:oldComponent.value};if(newComponent.termType==="Literal"){newComponent.datatype={termType:"NamedNode"};if("datatype"in oldComponent){newComponent.datatype.value=oldComponent.datatype}if("language"in oldComponent){if(!("datatype"in oldComponent)){newComponent.datatype.value=RDF_LANGSTRING}newComponent.language=oldComponent.language}else if(!("datatype"in oldComponent)){newComponent.datatype.value=XSD_STRING}}quad[componentName]=newComponent}if(graphName==="@default"){quad.graph={termType:"DefaultGraph",value:""}}else{quad.graph={termType:graphName.startsWith("_:")?"BlankNode":"NamedNode",value:graphName}}quads.push(quad)})}return quads}};function _compareTriples(t1,t2){for(const k in t1){if(t1[k].termType!==t2[k].termType||t1[k].value!==t2[k].value){return false}}if(t1.object.termType!=="Literal"){return true}return t1.object.datatype.termType===t2.object.datatype.termType&&t1.object.datatype.value===t2.object.datatype.value&&t1.object.language===t2.object.language}const _escapeRegex=/["\\\n\r]/g;function _escape(s){return s.replace(_escapeRegex,(function(match){switch(match){case'"':return'\\"';case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r"}}))}const _unescapeRegex=/(?:\\([tbnrf"'\\]))|(?:\\u([0-9A-Fa-f]{4}))|(?:\\U([0-9A-Fa-f]{8}))/g;function _unescape(s){return s.replace(_unescapeRegex,(function(match,code,u,U){if(code){switch(code){case"t":return"\t";case"b":return"\b";case"n":return"\n";case"r":return"\r";case"f":return"\f";case'"':return'"';case"'":return"'";case"\\":return"\\"}}if(u){return String.fromCharCode(parseInt(u,16))}if(U){throw new Error("Unsupported U escape")}}))}},{}],84:[function(require,module,exports){"use strict";module.exports=class Permutator{constructor(list){this.list=list.sort();this.done=false;this.left={};for(let i=0;i<list.length;++i){this.left[list[i]]=true}}hasNext(){return!this.done}next(){const rval=this.list.slice();let k=null;let pos=0;const length=this.list.length;for(let i=0;i<length;++i){const element=this.list[i];const left=this.left[element];if((k===null||element>k)&&(left&&i>0&&element>this.list[i-1]||!left&&i<length-1&&element>this.list[i+1])){k=element;pos=i}}if(k===null){this.done=true}else{const swap=this.left[k]?pos-1:pos+1;this.list[pos]=this.list[swap];this.list[swap]=k;for(let i=0;i<length;++i){if(this.list[i]>k){this.left[this.list[i]]=!this.left[this.list[i]]}}}return rval}}},{}],85:[function(require,module,exports){"use strict";const AsyncAlgorithm=require("./AsyncAlgorithm");const IdentifierIssuer=require("./IdentifierIssuer");const MessageDigest=require("./MessageDigest");const Permutator=require("./Permutator");const NQuads=require("./NQuads");const util=require("./util");const POSITIONS={subject:"s",object:"o",graph:"g"};module.exports=class URDNA2015 extends AsyncAlgorithm{constructor(options){options=options||{};super(options);this.name="URDNA2015";this.options=Object.assign({},options);this.blankNodeInfo={};this.hashToBlankNodes={};this.canonicalIssuer=new IdentifierIssuer("_:c14n");this.hashAlgorithm="sha256";this.quads}main(dataset,callback){const self=this;self.schedule.start=Date.now();let result;self.quads=dataset;const nonNormalized={};self.waterfall([callback=>{self.forEach(dataset,(quad,idx,callback)=>{self.forEachComponent(quad,component=>{if(component.termType!=="BlankNode"){return}const id=component.value;if(id in self.blankNodeInfo){self.blankNodeInfo[id].quads.push(quad)}else{nonNormalized[id]=true;self.blankNodeInfo[id]={quads:[quad]}}});callback()},callback)},callback=>{let simple=true;self.whilst(()=>simple,callback=>{simple=false;self.hashToBlankNodes={};self.waterfall([callback=>{self.forEach(nonNormalized,(value,id,callback)=>{self.hashFirstDegreeQuads(id,(err,hash)=>{if(err){return callback(err)}if(hash in self.hashToBlankNodes){self.hashToBlankNodes[hash].push(id)}else{self.hashToBlankNodes[hash]=[id]}callback()})},callback)},callback=>{const hashes=Object.keys(self.hashToBlankNodes).sort();self.forEach(hashes,(hash,i,callback)=>{const idList=self.hashToBlankNodes[hash];if(idList.length>1){return callback()}const id=idList[0];self.canonicalIssuer.getId(id);delete nonNormalized[id];delete self.hashToBlankNodes[hash];simple=true;callback()},callback)}],callback)},callback)},callback=>{const hashes=Object.keys(self.hashToBlankNodes).sort();self.forEach(hashes,(hash,idx,callback)=>{const hashPathList=[];const idList=self.hashToBlankNodes[hash];self.waterfall([callback=>{self.forEach(idList,(id,idx,callback)=>{if(self.canonicalIssuer.hasId(id)){return callback()}const issuer=new IdentifierIssuer("_:b");issuer.getId(id);self.hashNDegreeQuads(id,issuer,(err,result)=>{if(err){return callback(err)}hashPathList.push(result);callback()})},callback)},callback=>{hashPathList.sort((a,b)=>a.hash<b.hash?-1:a.hash>b.hash?1:0);self.forEach(hashPathList,(result,idx,callback)=>{for(const existing in result.issuer.existing){self.canonicalIssuer.getId(existing)}callback()},callback)}],callback)},callback)},callback=>{const normalized=[];self.waterfall([callback=>{self.forEach(self.quads,(quad,idx,callback)=>{self.forEachComponent(quad,component=>{if(component.termType==="BlankNode"&&!component.value.startsWith(self.canonicalIssuer.prefix)){component.value=self.canonicalIssuer.getId(component.value)}});normalized.push(NQuads.serializeQuad(quad));callback()},callback)},callback=>{normalized.sort();result=normalized.join("");return callback()}],callback)}],err=>callback(err,result))}hashFirstDegreeQuads(id,callback){const self=this;const info=self.blankNodeInfo[id];if("hash"in info){return callback(null,info.hash)}const nquads=[];const quads=info.quads;self.forEach(quads,(quad,idx,callback)=>{const copy={predicate:quad.predicate};self.forEachComponent(quad,(component,key)=>{copy[key]=self.modifyFirstDegreeComponent(id,component,key)});nquads.push(NQuads.serializeQuad(copy));callback()},err=>{if(err){return callback(err)}nquads.sort();const md=new MessageDigest(self.hashAlgorithm);for(let i=0;i<nquads.length;++i){md.update(nquads[i])}info.hash=md.digest();callback(null,info.hash)})}hashRelatedBlankNode(related,quad,issuer,position,callback){const self=this;let id;self.waterfall([callback=>{if(self.canonicalIssuer.hasId(related)){id=self.canonicalIssuer.getId(related);return callback()}if(issuer.hasId(related)){id=issuer.getId(related);return callback()}self.hashFirstDegreeQuads(related,(err,hash)=>{if(err){return callback(err)}id=hash;callback()})}],err=>{if(err){return callback(err)}const md=new MessageDigest(self.hashAlgorithm);md.update(position);if(position!=="g"){md.update(self.getRelatedPredicate(quad))}md.update(id);return callback(null,md.digest())})}hashNDegreeQuads(id,issuer,callback){const self=this;let hashToRelated;const md=new MessageDigest(self.hashAlgorithm);self.waterfall([callback=>self.createHashToRelated(id,issuer,(err,result)=>{if(err){return callback(err)}hashToRelated=result;callback()}),callback=>{const hashes=Object.keys(hashToRelated).sort();self.forEach(hashes,(hash,idx,callback)=>{md.update(hash);let chosenPath="";let chosenIssuer;const permutator=new Permutator(hashToRelated[hash]);self.whilst(()=>permutator.hasNext(),nextPermutation=>{const permutation=permutator.next();let issuerCopy=issuer.clone();let path="";const recursionList=[];self.waterfall([callback=>{self.forEach(permutation,(related,idx,callback)=>{if(self.canonicalIssuer.hasId(related)){path+=self.canonicalIssuer.getId(related)}else{if(!issuerCopy.hasId(related)){recursionList.push(related)}path+=issuerCopy.getId(related)}if(chosenPath.length!==0&&path>chosenPath){return nextPermutation()}callback()},callback)},callback=>{self.forEach(recursionList,(related,idx,callback)=>{self.hashNDegreeQuads(related,issuerCopy,(err,result)=>{if(err){return callback(err)}path+=issuerCopy.getId(related);path+="<"+result.hash+">";issuerCopy=result.issuer;if(chosenPath.length!==0&&path>chosenPath){return nextPermutation()}callback()})},callback)},callback=>{if(chosenPath.length===0||path<chosenPath){chosenPath=path;chosenIssuer=issuerCopy}callback()}],nextPermutation)},err=>{if(err){return callback(err)}md.update(chosenPath);issuer=chosenIssuer;callback()})},callback)}],err=>{callback(err,{hash:md.digest(),issuer:issuer})})}modifyFirstDegreeComponent(id,component){if(component.termType!=="BlankNode"){return component}component=util.clone(component);component.value=component.value===id?"_:a":"_:z";return component}getRelatedPredicate(quad){return"<"+quad.predicate.value+">"}createHashToRelated(id,issuer,callback){const self=this;const hashToRelated={};const quads=self.blankNodeInfo[id].quads;self.forEach(quads,(quad,idx,callback)=>{self.forEach(quad,(component,key,callback)=>{if(key==="predicate"||!(component.termType==="BlankNode"&&component.value!==id)){return callback()}const related=component.value;const position=POSITIONS[key];self.hashRelatedBlankNode(related,quad,issuer,position,(err,hash)=>{if(err){return callback(err)}if(hash in hashToRelated){hashToRelated[hash].push(related)}else{hashToRelated[hash]=[related]}callback()})},callback)},err=>callback(err,hashToRelated))}forEachComponent(quad,op){for(const key in quad){if(key==="predicate"){continue}op(quad[key],key,quad)}}}},{"./AsyncAlgorithm":80,"./IdentifierIssuer":81,"./MessageDigest":82,"./NQuads":83,"./Permutator":84,"./util":90}],86:[function(require,module,exports){"use strict";const IdentifierIssuer=require("./IdentifierIssuer");const MessageDigest=require("./MessageDigest");const Permutator=require("./Permutator");const NQuads=require("./NQuads");const util=require("./util");const POSITIONS={subject:"s",object:"o",graph:"g"};module.exports=class URDNA2015Sync{constructor(){this.name="URDNA2015";this.blankNodeInfo={};this.hashToBlankNodes={};this.canonicalIssuer=new IdentifierIssuer("_:c14n");this.hashAlgorithm="sha256";this.quads}main(dataset){const self=this;self.quads=dataset;const nonNormalized={};for(const quad of dataset){self.forEachComponent(quad,component=>{if(component.termType!=="BlankNode"){return}const id=component.value;if(id in self.blankNodeInfo){self.blankNodeInfo[id].quads.push(quad)}else{nonNormalized[id]=true;self.blankNodeInfo[id]={quads:[quad]}}})}let simple=true;while(simple){simple=false;self.hashToBlankNodes={};for(const id in nonNormalized){const hash=self.hashFirstDegreeQuads(id);if(hash in self.hashToBlankNodes){self.hashToBlankNodes[hash].push(id)}else{self.hashToBlankNodes[hash]=[id]}}const hashes=Object.keys(self.hashToBlankNodes).sort();for(let i=0;i<hashes.length;++i){const hash=hashes[i];const idList=self.hashToBlankNodes[hash];if(idList.length>1){continue}const id=idList[0];self.canonicalIssuer.getId(id);delete nonNormalized[id];delete self.hashToBlankNodes[hash];simple=true}}const hashes=Object.keys(self.hashToBlankNodes).sort();for(let i=0;i<hashes.length;++i){const hashPathList=[];const hash=hashes[i];const idList=self.hashToBlankNodes[hash];for(let j=0;j<idList.length;++j){const id=idList[j];if(self.canonicalIssuer.hasId(id)){continue}const issuer=new IdentifierIssuer("_:b");issuer.getId(id);const result=self.hashNDegreeQuads(id,issuer);hashPathList.push(result)}hashPathList.sort((a,b)=>a.hash<b.hash?-1:a.hash>b.hash?1:0);for(let j=0;j<hashPathList.length;++j){const result=hashPathList[j];for(const existing in result.issuer.existing){self.canonicalIssuer.getId(existing)}}}const normalized=[];for(let i=0;i<self.quads.length;++i){const quad=self.quads[i];self.forEachComponent(quad,component=>{if(component.termType==="BlankNode"&&!component.value.startsWith(self.canonicalIssuer.prefix)){component.value=self.canonicalIssuer.getId(component.value)}});normalized.push(NQuads.serializeQuad(quad))}normalized.sort();return normalized.join("")}hashFirstDegreeQuads(id){const self=this;const info=self.blankNodeInfo[id];if("hash"in info){return info.hash}const nquads=[];const quads=info.quads;for(let i=0;i<quads.length;++i){const quad=quads[i];const copy={predicate:quad.predicate};self.forEachComponent(quad,(component,key)=>{copy[key]=self.modifyFirstDegreeComponent(id,component,key)});nquads.push(NQuads.serializeQuad(copy))}nquads.sort();const md=new MessageDigest(self.hashAlgorithm);for(let i=0;i<nquads.length;++i){md.update(nquads[i])}info.hash=md.digest();return info.hash}hashRelatedBlankNode(related,quad,issuer,position){const self=this;let id;if(self.canonicalIssuer.hasId(related)){id=self.canonicalIssuer.getId(related)}else if(issuer.hasId(related)){id=issuer.getId(related)}else{id=self.hashFirstDegreeQuads(related)}const md=new MessageDigest(self.hashAlgorithm);md.update(position);if(position!=="g"){md.update(self.getRelatedPredicate(quad))}md.update(id);return md.digest()}hashNDegreeQuads(id,issuer){const self=this;const md=new MessageDigest(self.hashAlgorithm);const hashToRelated=self.createHashToRelated(id,issuer);const hashes=Object.keys(hashToRelated).sort();for(let i=0;i<hashes.length;++i){const hash=hashes[i];md.update(hash);let chosenPath="";let chosenIssuer;const permutator=new Permutator(hashToRelated[hash]);while(permutator.hasNext()){const permutation=permutator.next();let issuerCopy=issuer.clone();let path="";const recursionList=[];let nextPermutation=false;for(let j=0;j<permutation.length;++j){const related=permutation[j];if(self.canonicalIssuer.hasId(related)){path+=self.canonicalIssuer.getId(related)}else{if(!issuerCopy.hasId(related)){recursionList.push(related)}path+=issuerCopy.getId(related)}if(chosenPath.length!==0&&path>chosenPath){nextPermutation=true;break}}if(nextPermutation){continue}for(let j=0;j<recursionList.length;++j){const related=recursionList[j];const result=self.hashNDegreeQuads(related,issuerCopy);path+=issuerCopy.getId(related);path+="<"+result.hash+">";issuerCopy=result.issuer;if(chosenPath.length!==0&&path>chosenPath){nextPermutation=true;break}}if(nextPermutation){continue}if(chosenPath.length===0||path<chosenPath){chosenPath=path;chosenIssuer=issuerCopy}}md.update(chosenPath);issuer=chosenIssuer}return{hash:md.digest(),issuer:issuer}}modifyFirstDegreeComponent(id,component){if(component.termType!=="BlankNode"){return component}component=util.clone(component);component.value=component.value===id?"_:a":"_:z";return component}getRelatedPredicate(quad){return"<"+quad.predicate.value+">"}createHashToRelated(id,issuer){const self=this;const hashToRelated={};const quads=self.blankNodeInfo[id].quads;for(let i=0;i<quads.length;++i){const quad=quads[i];for(const key in quad){const component=quad[key];if(key==="predicate"||!(component.termType==="BlankNode"&&component.value!==id)){continue}const related=component.value;const position=POSITIONS[key];const hash=self.hashRelatedBlankNode(related,quad,issuer,position);if(hash in hashToRelated){hashToRelated[hash].push(related)}else{hashToRelated[hash]=[related]}}}return hashToRelated}forEachComponent(quad,op){for(const key in quad){if(key==="predicate"){continue}op(quad[key],key,quad)}}}},{"./IdentifierIssuer":81,"./MessageDigest":82,"./NQuads":83,"./Permutator":84,"./util":90}],87:[function(require,module,exports){"use strict";const URDNA2015=require("./URDNA2015");const util=require("./util");module.exports=class URDNA2012 extends URDNA2015{constructor(options){super(options);this.name="URGNA2012";this.hashAlgorithm="sha1"}modifyFirstDegreeComponent(id,component,key){if(component.termType!=="BlankNode"){return component}component=util.clone(component);if(key==="name"){component.value="_:g"}else{component.value=component.value===id?"_:a":"_:z"}return component}getRelatedPredicate(quad){return quad.predicate.value}createHashToRelated(id,issuer,callback){const self=this;const hashToRelated={};const quads=self.blankNodeInfo[id].quads;self.forEach(quads,(quad,idx,callback)=>{let position;let related;if(quad.subject.termType==="BlankNode"&&quad.subject.value!==id){related=quad.subject.value;position="p"}else if(quad.object.termType==="BlankNode"&&quad.object.value!==id){related=quad.object.value;position="r"}else{return callback()}self.hashRelatedBlankNode(related,quad,issuer,position,(err,hash)=>{if(err){return callback(err)}if(hash in hashToRelated){hashToRelated[hash].push(related)}else{hashToRelated[hash]=[related]}callback()})},err=>callback(err,hashToRelated))}}},{"./URDNA2015":85,"./util":90}],88:[function(require,module,exports){"use strict";const URDNA2015Sync=require("./URDNA2015Sync");const util=require("./util");module.exports=class URDNA2012Sync extends URDNA2015Sync{constructor(){super();this.name="URGNA2012";this.hashAlgorithm="sha1"}modifyFirstDegreeComponent(id,component,key){if(component.termType!=="BlankNode"){return component}component=util.clone(component);if(key==="name"){component.value="_:g"}else{component.value=component.value===id?"_:a":"_:z"}return component}getRelatedPredicate(quad){return quad.predicate.value}createHashToRelated(id,issuer){const self=this;const hashToRelated={};const quads=self.blankNodeInfo[id].quads;for(let i=0;i<quads.length;++i){const quad=quads[i];let position;let related;if(quad.subject.termType==="BlankNode"&&quad.subject.value!==id){related=quad.subject.value;position="p"}else if(quad.object.termType==="BlankNode"&&quad.object.value!==id){related=quad.object.value;position="r"}else{continue}const hash=self.hashRelatedBlankNode(related,quad,issuer,position);if(hash in hashToRelated){hashToRelated[hash].push(related)}else{hashToRelated[hash]=[related]}}return hashToRelated}}},{"./URDNA2015Sync":86,"./util":90}],89:[function(require,module,exports){"use strict";const util=require("./util");const URDNA2015=require("./URDNA2015");const URGNA2012=require("./URGNA2012");const URDNA2015Sync=require("./URDNA2015Sync");const URGNA2012Sync=require("./URGNA2012Sync");let rdfCanonizeNative;try{rdfCanonizeNative=require("rdf-canonize-native")}catch(e){}const api={};module.exports=api;api.NQuads=require("./NQuads");api.IdentifierIssuer=require("./IdentifierIssuer");api._rdfCanonizeNative=function(api){if(api){rdfCanonizeNative=api}return rdfCanonizeNative};api.canonize=util.callbackify((async function(dataset,options){let callback;const promise=new Promise((resolve,reject)=>{callback=(err,canonical)=>{if(err){return reject(err)}resolve(canonical)}});if(!Array.isArray(dataset)){dataset=api.NQuads.legacyDatasetToQuads(dataset)}if(options.useNative){if(rdfCanonizeNative){rdfCanonizeNative.canonize(dataset,options,callback)}else{throw new Error("rdf-canonize-native not available")}}else{if(options.algorithm==="URDNA2015"){new URDNA2015(options).main(dataset,callback)}else if(options.algorithm==="URGNA2012"){new URGNA2012(options).main(dataset,callback)}else if(!("algorithm"in options)){throw new Error("No RDF Dataset Canonicalization algorithm specified.")}else{throw new Error("Invalid RDF Dataset Canonicalization algorithm: "+options.algorithm)}}return promise}));api.canonizeSync=function(dataset,options){if(!Array.isArray(dataset)){dataset=api.NQuads.legacyDatasetToQuads(dataset)}if(options.useNative){if(rdfCanonizeNative){return rdfCanonizeNative.canonizeSync(dataset,options)}throw new Error("rdf-canonize-native not available")}if(options.algorithm==="URDNA2015"){return new URDNA2015Sync(options).main(dataset)}else if(options.algorithm==="URGNA2012"){return new URGNA2012Sync(options).main(dataset)}if(!("algorithm"in options)){throw new Error("No RDF Dataset Canonicalization algorithm specified.")}throw new Error("Invalid RDF Dataset Canonicalization algorithm: "+options.algorithm)}},{"./IdentifierIssuer":81,"./NQuads":83,"./URDNA2015":85,"./URDNA2015Sync":86,"./URGNA2012":87,"./URGNA2012Sync":88,"./util":90,"rdf-canonize-native":44}],90:[function(require,module,exports){(function(process,setImmediate){"use strict";const api={};module.exports=api;const _setImmediate=typeof setImmediate==="function"&&setImmediate;const _delay=_setImmediate?fn=>_setImmediate(fn):fn=>setTimeout(fn,0);if(typeof process==="object"&&typeof process.nextTick==="function"){api.nextTick=process.nextTick}else{api.nextTick=_delay}api.setImmediate=_setImmediate?_delay:api.nextTick;api.clone=function(value){if(value&&typeof value==="object"){let rval;if(Array.isArray(value)){rval=[];for(let i=0;i<value.length;++i){rval[i]=api.clone(value[i])}}else if(api.isObject(value)){rval={};for(const key in value){rval[key]=api.clone(value[key])}}else{rval=value.toString()}return rval}return value};api.isObject=v=>Object.prototype.toString.call(v)==="[object Object]";api.isUndefined=v=>typeof v==="undefined";api.callbackify=fn=>async function(...args){const callback=args[args.length-1];if(typeof callback==="function"){args.pop()}let result;try{result=await fn.apply(null,args)}catch(e){if(typeof callback==="function"){return _invokeCallback(callback,e)}throw e}if(typeof callback==="function"){return _invokeCallback(callback,null,result)}return result};function _invokeCallback(callback,err,result){try{return callback(err,result)}catch(unhandledError){process.nextTick(()=>{throw unhandledError})}}}).call(this,require("_process"),require("timers").setImmediate)},{_process:79,timers:91}],91:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout((function onTimeout(){if(item._onTimeout)item._onTimeout()}),msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick((function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}}));return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":79,timers:91}],92:[function(require,module,exports){
/** @license URI.js v4.2.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */
(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.URI=global.URI||{})})(this,(function(exports){"use strict";function merge(){for(var _len=arguments.length,sets=Array(_len),_key=0;_key<_len;_key++){sets[_key]=arguments[_key]}if(sets.length>1){sets[0]=sets[0].slice(0,-1);var xl=sets.length-1;for(var x=1;x<xl;++x){sets[x]=sets[x].slice(1,-1)}sets[xl]=sets[xl].slice(1);return sets.join("")}else{return sets[0]}}function subexp(str){return"(?:"+str+")"}function typeOf(o){return o===undefined?"undefined":o===null?"null":Object.prototype.toString.call(o).split(" ").pop().split("]").shift().toLowerCase()}function toUpperCase(str){return str.toUpperCase()}function toArray(obj){return obj!==undefined&&obj!==null?obj instanceof Array?obj:typeof obj.length!=="number"||obj.split||obj.setInterval||obj.call?[obj]:Array.prototype.slice.call(obj):[]}function assign(target,source){var obj=target;if(source){for(var key in source){obj[key]=source[key]}}return obj}function buildExps(isIRI){var ALPHA$$="[A-Za-z]",CR$="[\\x0D]",DIGIT$$="[0-9]",DQUOTE$$="[\\x22]",HEXDIG$$=merge(DIGIT$$,"[A-Fa-f]"),LF$$="[\\x0A]",SP$$="[\\x20]",PCT_ENCODED$=subexp(subexp("%[EFef]"+HEXDIG$$+"%"+HEXDIG$$+HEXDIG$$+"%"+HEXDIG$$+HEXDIG$$)+"|"+subexp("%[89A-Fa-f]"+HEXDIG$$+"%"+HEXDIG$$+HEXDIG$$)+"|"+subexp("%"+HEXDIG$$+HEXDIG$$)),GEN_DELIMS$$="[\\:\\/\\?\\#\\[\\]\\@]",SUB_DELIMS$$="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",RESERVED$$=merge(GEN_DELIMS$$,SUB_DELIMS$$),UCSCHAR$$=isIRI?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",IPRIVATE$$=isIRI?"[\\uE000-\\uF8FF]":"[]",UNRESERVED$$=merge(ALPHA$$,DIGIT$$,"[\\-\\.\\_\\~]",UCSCHAR$$),SCHEME$=subexp(ALPHA$$+merge(ALPHA$$,DIGIT$$,"[\\+\\-\\.]")+"*"),USERINFO$=subexp(subexp(PCT_ENCODED$+"|"+merge(UNRESERVED$$,SUB_DELIMS$$,"[\\:]"))+"*"),DEC_OCTET$=subexp(subexp("25[0-5]")+"|"+subexp("2[0-4]"+DIGIT$$)+"|"+subexp("1"+DIGIT$$+DIGIT$$)+"|"+subexp("[1-9]"+DIGIT$$)+"|"+DIGIT$$),DEC_OCTET_RELAXED$=subexp(subexp("25[0-5]")+"|"+subexp("2[0-4]"+DIGIT$$)+"|"+subexp("1"+DIGIT$$+DIGIT$$)+"|"+subexp("0?[1-9]"+DIGIT$$)+"|0?0?"+DIGIT$$),IPV4ADDRESS$=subexp(DEC_OCTET_RELAXED$+"\\."+DEC_OCTET_RELAXED$+"\\."+DEC_OCTET_RELAXED$+"\\."+DEC_OCTET_RELAXED$),H16$=subexp(HEXDIG$$+"{1,4}"),LS32$=subexp(subexp(H16$+"\\:"+H16$)+"|"+IPV4ADDRESS$),IPV6ADDRESS1$=subexp(subexp(H16$+"\\:")+"{6}"+LS32$),IPV6ADDRESS2$=subexp("\\:\\:"+subexp(H16$+"\\:")+"{5}"+LS32$),IPV6ADDRESS3$=subexp(subexp(H16$)+"?\\:\\:"+subexp(H16$+"\\:")+"{4}"+LS32$),IPV6ADDRESS4$=subexp(subexp(subexp(H16$+"\\:")+"{0,1}"+H16$)+"?\\:\\:"+subexp(H16$+"\\:")+"{3}"+LS32$),IPV6ADDRESS5$=subexp(subexp(subexp(H16$+"\\:")+"{0,2}"+H16$)+"?\\:\\:"+subexp(H16$+"\\:")+"{2}"+LS32$),IPV6ADDRESS6$=subexp(subexp(subexp(H16$+"\\:")+"{0,3}"+H16$)+"?\\:\\:"+H16$+"\\:"+LS32$),IPV6ADDRESS7$=subexp(subexp(subexp(H16$+"\\:")+"{0,4}"+H16$)+"?\\:\\:"+LS32$),IPV6ADDRESS8$=subexp(subexp(subexp(H16$+"\\:")+"{0,5}"+H16$)+"?\\:\\:"+H16$),IPV6ADDRESS9$=subexp(subexp(subexp(H16$+"\\:")+"{0,6}"+H16$)+"?\\:\\:"),IPV6ADDRESS$=subexp([IPV6ADDRESS1$,IPV6ADDRESS2$,IPV6ADDRESS3$,IPV6ADDRESS4$,IPV6ADDRESS5$,IPV6ADDRESS6$,IPV6ADDRESS7$,IPV6ADDRESS8$,IPV6ADDRESS9$].join("|")),ZONEID$=subexp(subexp(UNRESERVED$$+"|"+PCT_ENCODED$)+"+"),IPV6ADDRZ$=subexp(IPV6ADDRESS$+"\\%25"+ZONEID$),IPV6ADDRZ_RELAXED$=subexp(IPV6ADDRESS$+subexp("\\%25|\\%(?!"+HEXDIG$$+"{2})")+ZONEID$),IPVFUTURE$=subexp("[vV]"+HEXDIG$$+"+\\."+merge(UNRESERVED$$,SUB_DELIMS$$,"[\\:]")+"+"),IP_LITERAL$=subexp("\\["+subexp(IPV6ADDRZ_RELAXED$+"|"+IPV6ADDRESS$+"|"+IPVFUTURE$)+"\\]"),REG_NAME$=subexp(subexp(PCT_ENCODED$+"|"+merge(UNRESERVED$$,SUB_DELIMS$$))+"*"),HOST$=subexp(IP_LITERAL$+"|"+IPV4ADDRESS$+"(?!"+REG_NAME$+")"+"|"+REG_NAME$),PORT$=subexp(DIGIT$$+"*"),AUTHORITY$=subexp(subexp(USERINFO$+"@")+"?"+HOST$+subexp("\\:"+PORT$)+"?"),PCHAR$=subexp(PCT_ENCODED$+"|"+merge(UNRESERVED$$,SUB_DELIMS$$,"[\\:\\@]")),SEGMENT$=subexp(PCHAR$+"*"),SEGMENT_NZ$=subexp(PCHAR$+"+"),SEGMENT_NZ_NC$=subexp(subexp(PCT_ENCODED$+"|"+merge(UNRESERVED$$,SUB_DELIMS$$,"[\\@]"))+"+"),PATH_ABEMPTY$=subexp(subexp("\\/"+SEGMENT$)+"*"),PATH_ABSOLUTE$=subexp("\\/"+subexp(SEGMENT_NZ$+PATH_ABEMPTY$)+"?"),PATH_NOSCHEME$=subexp(SEGMENT_NZ_NC$+PATH_ABEMPTY$),PATH_ROOTLESS$=subexp(SEGMENT_NZ$+PATH_ABEMPTY$),PATH_EMPTY$="(?!"+PCHAR$+")",PATH$=subexp(PATH_ABEMPTY$+"|"+PATH_ABSOLUTE$+"|"+PATH_NOSCHEME$+"|"+PATH_ROOTLESS$+"|"+PATH_EMPTY$),QUERY$=subexp(subexp(PCHAR$+"|"+merge("[\\/\\?]",IPRIVATE$$))+"*"),FRAGMENT$=subexp(subexp(PCHAR$+"|[\\/\\?]")+"*"),HIER_PART$=subexp(subexp("\\/\\/"+AUTHORITY$+PATH_ABEMPTY$)+"|"+PATH_ABSOLUTE$+"|"+PATH_ROOTLESS$+"|"+PATH_EMPTY$),URI$=subexp(SCHEME$+"\\:"+HIER_PART$+subexp("\\?"+QUERY$)+"?"+subexp("\\#"+FRAGMENT$)+"?"),RELATIVE_PART$=subexp(subexp("\\/\\/"+AUTHORITY$+PATH_ABEMPTY$)+"|"+PATH_ABSOLUTE$+"|"+PATH_NOSCHEME$+"|"+PATH_EMPTY$),RELATIVE$=subexp(RELATIVE_PART$+subexp("\\?"+QUERY$)+"?"+subexp("\\#"+FRAGMENT$)+"?"),URI_REFERENCE$=subexp(URI$+"|"+RELATIVE$),ABSOLUTE_URI$=subexp(SCHEME$+"\\:"+HIER_PART$+subexp("\\?"+QUERY$)+"?"),GENERIC_REF$="^("+SCHEME$+")\\:"+subexp(subexp("\\/\\/("+subexp("("+USERINFO$+")@")+"?("+HOST$+")"+subexp("\\:("+PORT$+")")+"?)")+"?("+PATH_ABEMPTY$+"|"+PATH_ABSOLUTE$+"|"+PATH_ROOTLESS$+"|"+PATH_EMPTY$+")")+subexp("\\?("+QUERY$+")")+"?"+subexp("\\#("+FRAGMENT$+")")+"?$",RELATIVE_REF$="^(){0}"+subexp(subexp("\\/\\/("+subexp("("+USERINFO$+")@")+"?("+HOST$+")"+subexp("\\:("+PORT$+")")+"?)")+"?("+PATH_ABEMPTY$+"|"+PATH_ABSOLUTE$+"|"+PATH_NOSCHEME$+"|"+PATH_EMPTY$+")")+subexp("\\?("+QUERY$+")")+"?"+subexp("\\#("+FRAGMENT$+")")+"?$",ABSOLUTE_REF$="^("+SCHEME$+")\\:"+subexp(subexp("\\/\\/("+subexp("("+USERINFO$+")@")+"?("+HOST$+")"+subexp("\\:("+PORT$+")")+"?)")+"?("+PATH_ABEMPTY$+"|"+PATH_ABSOLUTE$+"|"+PATH_ROOTLESS$+"|"+PATH_EMPTY$+")")+subexp("\\?("+QUERY$+")")+"?$",SAMEDOC_REF$="^"+subexp("\\#("+FRAGMENT$+")")+"?$",AUTHORITY_REF$="^"+subexp("("+USERINFO$+")@")+"?("+HOST$+")"+subexp("\\:("+PORT$+")")+"?$";return{NOT_SCHEME:new RegExp(merge("[^]",ALPHA$$,DIGIT$$,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(merge("[^\\%\\:]",UNRESERVED$$,SUB_DELIMS$$),"g"),NOT_HOST:new RegExp(merge("[^\\%\\[\\]\\:]",UNRESERVED$$,SUB_DELIMS$$),"g"),NOT_PATH:new RegExp(merge("[^\\%\\/\\:\\@]",UNRESERVED$$,SUB_DELIMS$$),"g"),NOT_PATH_NOSCHEME:new RegExp(merge("[^\\%\\/\\@]",UNRESERVED$$,SUB_DELIMS$$),"g"),NOT_QUERY:new RegExp(merge("[^\\%]",UNRESERVED$$,SUB_DELIMS$$,"[\\:\\@\\/\\?]",IPRIVATE$$),"g"),NOT_FRAGMENT:new RegExp(merge("[^\\%]",UNRESERVED$$,SUB_DELIMS$$,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(merge("[^]",UNRESERVED$$,SUB_DELIMS$$),"g"),UNRESERVED:new RegExp(UNRESERVED$$,"g"),OTHER_CHARS:new RegExp(merge("[^\\%]",UNRESERVED$$,RESERVED$$),"g"),PCT_ENCODED:new RegExp(PCT_ENCODED$,"g"),IPV4ADDRESS:new RegExp("^("+IPV4ADDRESS$+")$"),IPV6ADDRESS:new RegExp("^\\[?("+IPV6ADDRESS$+")"+subexp(subexp("\\%25|\\%(?!"+HEXDIG$$+"{2})")+"("+ZONEID$+")")+"?\\]?$")}}var URI_PROTOCOL=buildExps(false);var IRI_PROTOCOL=buildExps(true);var slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var toConsumableArray=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}else{return Array.from(arr)}};var maxInt=2147483647;var base=36;var tMin=1;var tMax=26;var skew=38;var damp=700;var initialBias=72;var initialN=128;var delimiter="-";var regexPunycode=/^xn--/;var regexNonASCII=/[^\0-\x7E]/;var regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g;var errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"};var baseMinusTMin=base-tMin;var floor=Math.floor;var stringFromCharCode=String.fromCharCode;function error$1(type){throw new RangeError(errors[type])}function map(array,fn){var result=[];var length=array.length;while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[];var counter=0;var length=string.length;while(counter<length){var value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){var extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}var ucs2encode=function ucs2encode(array){return String.fromCodePoint.apply(String,toConsumableArray(array))};var basicToDigit=function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base};var digitToBasic=function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)};var adapt=function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))};var decode=function decode(input){var output=[];var inputLength=input.length;var i=0;var n=initialN;var bias=initialBias;var basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(var j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error$1("not-basic")}output.push(input.charCodeAt(j))}for(var index=basic>0?basic+1:0;index<inputLength;){var oldi=i;for(var w=1,k=base;;k+=base){if(index>=inputLength){error$1("invalid-input")}var digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error$1("overflow")}i+=digit*w;var t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}var baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error$1("overflow")}w*=baseMinusT}var out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error$1("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return String.fromCodePoint.apply(String,output)};var encode=function encode(input){var output=[];input=ucs2decode(input);var inputLength=input.length;var n=initialN;var delta=0;var bias=initialBias;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=input[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _currentValue2=_step.value;if(_currentValue2<128){output.push(stringFromCharCode(_currentValue2))}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var basicLength=output.length;var handledCPCount=basicLength;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){var m=maxInt;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=input[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var currentValue=_step2.value;if(currentValue>=n&&currentValue<m){m=currentValue}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error$1("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=input[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _currentValue=_step3.value;if(_currentValue<n&&++delta>maxInt){error$1("overflow")}if(_currentValue==n){var q=delta;for(var k=base;;k+=base){var t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}var qMinusT=q-t;var baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}++delta;++n}return output.join("")};var toUnicode=function toUnicode(input){return mapDomain(input,(function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string}))};var toASCII=function toASCII(input){return mapDomain(input,(function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string}))};var punycode={version:"2.1.0",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};var SCHEMES={};function pctEncChar(chr){var c=chr.charCodeAt(0);var e=void 0;if(c<16)e="%0"+c.toString(16).toUpperCase();else if(c<128)e="%"+c.toString(16).toUpperCase();else if(c<2048)e="%"+(c>>6|192).toString(16).toUpperCase()+"%"+(c&63|128).toString(16).toUpperCase();else e="%"+(c>>12|224).toString(16).toUpperCase()+"%"+(c>>6&63|128).toString(16).toUpperCase()+"%"+(c&63|128).toString(16).toUpperCase();return e}function pctDecChars(str){var newStr="";var i=0;var il=str.length;while(i<il){var c=parseInt(str.substr(i+1,2),16);if(c<128){newStr+=String.fromCharCode(c);i+=3}else if(c>=194&&c<224){if(il-i>=6){var c2=parseInt(str.substr(i+4,2),16);newStr+=String.fromCharCode((c&31)<<6|c2&63)}else{newStr+=str.substr(i,6)}i+=6}else if(c>=224){if(il-i>=9){var _c=parseInt(str.substr(i+4,2),16);var c3=parseInt(str.substr(i+7,2),16);newStr+=String.fromCharCode((c&15)<<12|(_c&63)<<6|c3&63)}else{newStr+=str.substr(i,9)}i+=9}else{newStr+=str.substr(i,3);i+=3}}return newStr}function _normalizeComponentEncoding(components,protocol){function decodeUnreserved(str){var decStr=pctDecChars(str);return!decStr.match(protocol.UNRESERVED)?str:decStr}if(components.scheme)components.scheme=String(components.scheme).replace(protocol.PCT_ENCODED,decodeUnreserved).toLowerCase().replace(protocol.NOT_SCHEME,"");if(components.userinfo!==undefined)components.userinfo=String(components.userinfo).replace(protocol.PCT_ENCODED,decodeUnreserved).replace(protocol.NOT_USERINFO,pctEncChar).replace(protocol.PCT_ENCODED,toUpperCase);if(components.host!==undefined)components.host=String(components.host).replace(protocol.PCT_ENCODED,decodeUnreserved).toLowerCase().replace(protocol.NOT_HOST,pctEncChar).replace(protocol.PCT_ENCODED,toUpperCase);if(components.path!==undefined)components.path=String(components.path).replace(protocol.PCT_ENCODED,decodeUnreserved).replace(components.scheme?protocol.NOT_PATH:protocol.NOT_PATH_NOSCHEME,pctEncChar).replace(protocol.PCT_ENCODED,toUpperCase);if(components.query!==undefined)components.query=String(components.query).replace(protocol.PCT_ENCODED,decodeUnreserved).replace(protocol.NOT_QUERY,pctEncChar).replace(protocol.PCT_ENCODED,toUpperCase);if(components.fragment!==undefined)components.fragment=String(components.fragment).replace(protocol.PCT_ENCODED,decodeUnreserved).replace(protocol.NOT_FRAGMENT,pctEncChar).replace(protocol.PCT_ENCODED,toUpperCase);return components}function _stripLeadingZeros(str){return str.replace(/^0*(.*)/,"$1")||"0"}function _normalizeIPv4(host,protocol){var matches=host.match(protocol.IPV4ADDRESS)||[];var _matches=slicedToArray(matches,2),address=_matches[1];if(address){return address.split(".").map(_stripLeadingZeros).join(".")}else{return host}}function _normalizeIPv6(host,protocol){var matches=host.match(protocol.IPV6ADDRESS)||[];var _matches2=slicedToArray(matches,3),address=_matches2[1],zone=_matches2[2];if(address){var _address$toLowerCase$=address.toLowerCase().split("::").reverse(),_address$toLowerCase$2=slicedToArray(_address$toLowerCase$,2),last=_address$toLowerCase$2[0],first=_address$toLowerCase$2[1];var firstFields=first?first.split(":").map(_stripLeadingZeros):[];var lastFields=last.split(":").map(_stripLeadingZeros);var isLastFieldIPv4Address=protocol.IPV4ADDRESS.test(lastFields[lastFields.length-1]);var fieldCount=isLastFieldIPv4Address?7:8;var lastFieldsStart=lastFields.length-fieldCount;var fields=Array(fieldCount);for(var x=0;x<fieldCount;++x){fields[x]=firstFields[x]||lastFields[lastFieldsStart+x]||""}if(isLastFieldIPv4Address){fields[fieldCount-1]=_normalizeIPv4(fields[fieldCount-1],protocol)}var allZeroFields=fields.reduce((function(acc,field,index){if(!field||field==="0"){var lastLongest=acc[acc.length-1];if(lastLongest&&lastLongest.index+lastLongest.length===index){lastLongest.length++}else{acc.push({index:index,length:1})}}return acc}),[]);var longestZeroFields=allZeroFields.sort((function(a,b){return b.length-a.length}))[0];var newHost=void 0;if(longestZeroFields&&longestZeroFields.length>1){var newFirst=fields.slice(0,longestZeroFields.index);var newLast=fields.slice(longestZeroFields.index+longestZeroFields.length);newHost=newFirst.join(":")+"::"+newLast.join(":")}else{newHost=fields.join(":")}if(zone){newHost+="%"+zone}return newHost}else{return host}}var URI_PARSE=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i;var NO_MATCH_IS_UNDEFINED="".match(/(){0}/)[1]===undefined;function parse(uriString){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var components={};var protocol=options.iri!==false?IRI_PROTOCOL:URI_PROTOCOL;if(options.reference==="suffix")uriString=(options.scheme?options.scheme+":":"")+"//"+uriString;var matches=uriString.match(URI_PARSE);if(matches){if(NO_MATCH_IS_UNDEFINED){components.scheme=matches[1];components.userinfo=matches[3];components.host=matches[4];components.port=parseInt(matches[5],10);components.path=matches[6]||"";components.query=matches[7];components.fragment=matches[8];if(isNaN(components.port)){components.port=matches[5]}}else{components.scheme=matches[1]||undefined;components.userinfo=uriString.indexOf("@")!==-1?matches[3]:undefined;components.host=uriString.indexOf("//")!==-1?matches[4]:undefined;components.port=parseInt(matches[5],10);components.path=matches[6]||"";components.query=uriString.indexOf("?")!==-1?matches[7]:undefined;components.fragment=uriString.indexOf("#")!==-1?matches[8]:undefined;if(isNaN(components.port)){components.port=uriString.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?matches[4]:undefined}}if(components.host){components.host=_normalizeIPv6(_normalizeIPv4(components.host,protocol),protocol)}if(components.scheme===undefined&&components.userinfo===undefined&&components.host===undefined&&components.port===undefined&&!components.path&&components.query===undefined){components.reference="same-document"}else if(components.scheme===undefined){components.reference="relative"}else if(components.fragment===undefined){components.reference="absolute"}else{components.reference="uri"}if(options.reference&&options.reference!=="suffix"&&options.reference!==components.reference){components.error=components.error||"URI is not a "+options.reference+" reference."}var schemeHandler=SCHEMES[(options.scheme||components.scheme||"").toLowerCase()];if(!options.unicodeSupport&&(!schemeHandler||!schemeHandler.unicodeSupport)){if(components.host&&(options.domainHost||schemeHandler&&schemeHandler.domainHost)){try{components.host=punycode.toASCII(components.host.replace(protocol.PCT_ENCODED,pctDecChars).toLowerCase())}catch(e){components.error=components.error||"Host's domain name can not be converted to ASCII via punycode: "+e}}_normalizeComponentEncoding(components,URI_PROTOCOL)}else{_normalizeComponentEncoding(components,protocol)}if(schemeHandler&&schemeHandler.parse){schemeHandler.parse(components,options)}}else{components.error=components.error||"URI can not be parsed."}return components}function _recomposeAuthority(components,options){var protocol=options.iri!==false?IRI_PROTOCOL:URI_PROTOCOL;var uriTokens=[];if(components.userinfo!==undefined){uriTokens.push(components.userinfo);uriTokens.push("@")}if(components.host!==undefined){uriTokens.push(_normalizeIPv6(_normalizeIPv4(String(components.host),protocol),protocol).replace(protocol.IPV6ADDRESS,(function(_,$1,$2){return"["+$1+($2?"%25"+$2:"")+"]"})))}if(typeof components.port==="number"){uriTokens.push(":");uriTokens.push(components.port.toString(10))}return uriTokens.length?uriTokens.join(""):undefined}var RDS1=/^\.\.?\//;var RDS2=/^\/\.(\/|$)/;var RDS3=/^\/\.\.(\/|$)/;var RDS5=/^\/?(?:.|\n)*?(?=\/|$)/;function removeDotSegments(input){var output=[];while(input.length){if(input.match(RDS1)){input=input.replace(RDS1,"")}else if(input.match(RDS2)){input=input.replace(RDS2,"/")}else if(input.match(RDS3)){input=input.replace(RDS3,"/");output.pop()}else if(input==="."||input===".."){input=""}else{var im=input.match(RDS5);if(im){var s=im[0];input=input.slice(s.length);output.push(s)}else{throw new Error("Unexpected dot segment condition")}}}return output.join("")}function serialize(components){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var protocol=options.iri?IRI_PROTOCOL:URI_PROTOCOL;var uriTokens=[];var schemeHandler=SCHEMES[(options.scheme||components.scheme||"").toLowerCase()];if(schemeHandler&&schemeHandler.serialize)schemeHandler.serialize(components,options);if(components.host){if(protocol.IPV6ADDRESS.test(components.host)){}else if(options.domainHost||schemeHandler&&schemeHandler.domainHost){try{components.host=!options.iri?punycode.toASCII(components.host.replace(protocol.PCT_ENCODED,pctDecChars).toLowerCase()):punycode.toUnicode(components.host)}catch(e){components.error=components.error||"Host's domain name can not be converted to "+(!options.iri?"ASCII":"Unicode")+" via punycode: "+e}}}_normalizeComponentEncoding(components,protocol);if(options.reference!=="suffix"&&components.scheme){uriTokens.push(components.scheme);uriTokens.push(":")}var authority=_recomposeAuthority(components,options);if(authority!==undefined){if(options.reference!=="suffix"){uriTokens.push("//")}uriTokens.push(authority);if(components.path&&components.path.charAt(0)!=="/"){uriTokens.push("/")}}if(components.path!==undefined){var s=components.path;if(!options.absolutePath&&(!schemeHandler||!schemeHandler.absolutePath)){s=removeDotSegments(s)}if(authority===undefined){s=s.replace(/^\/\//,"/%2F")}uriTokens.push(s)}if(components.query!==undefined){uriTokens.push("?");uriTokens.push(components.query)}if(components.fragment!==undefined){uriTokens.push("#");uriTokens.push(components.fragment)}return uriTokens.join("")}function resolveComponents(base,relative){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var skipNormalization=arguments[3];var target={};if(!skipNormalization){base=parse(serialize(base,options),options);relative=parse(serialize(relative,options),options)}options=options||{};if(!options.tolerant&&relative.scheme){target.scheme=relative.scheme;target.userinfo=relative.userinfo;target.host=relative.host;target.port=relative.port;target.path=removeDotSegments(relative.path||"");target.query=relative.query}else{if(relative.userinfo!==undefined||relative.host!==undefined||relative.port!==undefined){target.userinfo=relative.userinfo;target.host=relative.host;target.port=relative.port;target.path=removeDotSegments(relative.path||"");target.query=relative.query}else{if(!relative.path){target.path=base.path;if(relative.query!==undefined){target.query=relative.query}else{target.query=base.query}}else{if(relative.path.charAt(0)==="/"){target.path=removeDotSegments(relative.path)}else{if((base.userinfo!==undefined||base.host!==undefined||base.port!==undefined)&&!base.path){target.path="/"+relative.path}else if(!base.path){target.path=relative.path}else{target.path=base.path.slice(0,base.path.lastIndexOf("/")+1)+relative.path}target.path=removeDotSegments(target.path)}target.query=relative.query}target.userinfo=base.userinfo;target.host=base.host;target.port=base.port}target.scheme=base.scheme}target.fragment=relative.fragment;return target}function resolve(baseURI,relativeURI,options){var schemelessOptions=assign({scheme:"null"},options);return serialize(resolveComponents(parse(baseURI,schemelessOptions),parse(relativeURI,schemelessOptions),schemelessOptions,true),schemelessOptions)}function normalize(uri,options){if(typeof uri==="string"){uri=serialize(parse(uri,options),options)}else if(typeOf(uri)==="object"){uri=parse(serialize(uri,options),options)}return uri}function equal(uriA,uriB,options){if(typeof uriA==="string"){uriA=serialize(parse(uriA,options),options)}else if(typeOf(uriA)==="object"){uriA=serialize(uriA,options)}if(typeof uriB==="string"){uriB=serialize(parse(uriB,options),options)}else if(typeOf(uriB)==="object"){uriB=serialize(uriB,options)}return uriA===uriB}function escapeComponent(str,options){return str&&str.toString().replace(!options||!options.iri?URI_PROTOCOL.ESCAPE:IRI_PROTOCOL.ESCAPE,pctEncChar)}function unescapeComponent(str,options){return str&&str.toString().replace(!options||!options.iri?URI_PROTOCOL.PCT_ENCODED:IRI_PROTOCOL.PCT_ENCODED,pctDecChars)}var handler={scheme:"http",domainHost:true,parse:function parse(components,options){if(!components.host){components.error=components.error||"HTTP URIs must have a host."}return components},serialize:function serialize(components,options){if(components.port===(String(components.scheme).toLowerCase()!=="https"?80:443)||components.port===""){components.port=undefined}if(!components.path){components.path="/"}return components}};var handler$1={scheme:"https",domainHost:handler.domainHost,parse:handler.parse,serialize:handler.serialize};var O={};var isIRI=true;var UNRESERVED$$="[A-Za-z0-9\\-\\.\\_\\~"+(isIRI?"\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF":"")+"]";var HEXDIG$$="[0-9A-Fa-f]";var PCT_ENCODED$=subexp(subexp("%[EFef]"+HEXDIG$$+"%"+HEXDIG$$+HEXDIG$$+"%"+HEXDIG$$+HEXDIG$$)+"|"+subexp("%[89A-Fa-f]"+HEXDIG$$+"%"+HEXDIG$$+HEXDIG$$)+"|"+subexp("%"+HEXDIG$$+HEXDIG$$));var ATEXT$$="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]";var QTEXT$$="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]";var VCHAR$$=merge(QTEXT$$,'[\\"\\\\]');var SOME_DELIMS$$="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]";var UNRESERVED=new RegExp(UNRESERVED$$,"g");var PCT_ENCODED=new RegExp(PCT_ENCODED$,"g");var NOT_LOCAL_PART=new RegExp(merge("[^]",ATEXT$$,"[\\.]",'[\\"]',VCHAR$$),"g");var NOT_HFNAME=new RegExp(merge("[^]",UNRESERVED$$,SOME_DELIMS$$),"g");var NOT_HFVALUE=NOT_HFNAME;function decodeUnreserved(str){var decStr=pctDecChars(str);return!decStr.match(UNRESERVED)?str:decStr}var handler$2={scheme:"mailto",parse:function parse$$1(components,options){var mailtoComponents=components;var to=mailtoComponents.to=mailtoComponents.path?mailtoComponents.path.split(","):[];mailtoComponents.path=undefined;if(mailtoComponents.query){var unknownHeaders=false;var headers={};var hfields=mailtoComponents.query.split("&");for(var x=0,xl=hfields.length;x<xl;++x){var hfield=hfields[x].split("=");switch(hfield[0]){case"to":var toAddrs=hfield[1].split(",");for(var _x=0,_xl=toAddrs.length;_x<_xl;++_x){to.push(toAddrs[_x])}break;case"subject":mailtoComponents.subject=unescapeComponent(hfield[1],options);break;case"body":mailtoComponents.body=unescapeComponent(hfield[1],options);break;default:unknownHeaders=true;headers[unescapeComponent(hfield[0],options)]=unescapeComponent(hfield[1],options);break}}if(unknownHeaders)mailtoComponents.headers=headers}mailtoComponents.query=undefined;for(var _x2=0,_xl2=to.length;_x2<_xl2;++_x2){var addr=to[_x2].split("@");addr[0]=unescapeComponent(addr[0]);if(!options.unicodeSupport){try{addr[1]=punycode.toASCII(unescapeComponent(addr[1],options).toLowerCase())}catch(e){mailtoComponents.error=mailtoComponents.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}}else{addr[1]=unescapeComponent(addr[1],options).toLowerCase()}to[_x2]=addr.join("@")}return mailtoComponents},serialize:function serialize$$1(mailtoComponents,options){var components=mailtoComponents;var to=toArray(mailtoComponents.to);if(to){for(var x=0,xl=to.length;x<xl;++x){var toAddr=String(to[x]);var atIdx=toAddr.lastIndexOf("@");var localPart=toAddr.slice(0,atIdx).replace(PCT_ENCODED,decodeUnreserved).replace(PCT_ENCODED,toUpperCase).replace(NOT_LOCAL_PART,pctEncChar);var domain=toAddr.slice(atIdx+1);try{domain=!options.iri?punycode.toASCII(unescapeComponent(domain,options).toLowerCase()):punycode.toUnicode(domain)}catch(e){components.error=components.error||"Email address's domain name can not be converted to "+(!options.iri?"ASCII":"Unicode")+" via punycode: "+e}to[x]=localPart+"@"+domain}components.path=to.join(",")}var headers=mailtoComponents.headers=mailtoComponents.headers||{};if(mailtoComponents.subject)headers["subject"]=mailtoComponents.subject;if(mailtoComponents.body)headers["body"]=mailtoComponents.body;var fields=[];for(var name in headers){if(headers[name]!==O[name]){fields.push(name.replace(PCT_ENCODED,decodeUnreserved).replace(PCT_ENCODED,toUpperCase).replace(NOT_HFNAME,pctEncChar)+"="+headers[name].replace(PCT_ENCODED,decodeUnreserved).replace(PCT_ENCODED,toUpperCase).replace(NOT_HFVALUE,pctEncChar))}}if(fields.length){components.query=fields.join("&")}return components}};var URN_PARSE=/^([^\:]+)\:(.*)/;var handler$3={scheme:"urn",parse:function parse$$1(components,options){var matches=components.path&&components.path.match(URN_PARSE);var urnComponents=components;if(matches){var scheme=options.scheme||urnComponents.scheme||"urn";var nid=matches[1].toLowerCase();var nss=matches[2];var urnScheme=scheme+":"+(options.nid||nid);var schemeHandler=SCHEMES[urnScheme];urnComponents.nid=nid;urnComponents.nss=nss;urnComponents.path=undefined;if(schemeHandler){urnComponents=schemeHandler.parse(urnComponents,options)}}else{urnComponents.error=urnComponents.error||"URN can not be parsed."}return urnComponents},serialize:function serialize$$1(urnComponents,options){var scheme=options.scheme||urnComponents.scheme||"urn";var nid=urnComponents.nid;var urnScheme=scheme+":"+(options.nid||nid);var schemeHandler=SCHEMES[urnScheme];if(schemeHandler){urnComponents=schemeHandler.serialize(urnComponents,options)}var uriComponents=urnComponents;var nss=urnComponents.nss;uriComponents.path=(nid||options.nid)+":"+nss;return uriComponents}};var UUID=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/;var handler$4={scheme:"urn:uuid",parse:function parse(urnComponents,options){var uuidComponents=urnComponents;uuidComponents.uuid=uuidComponents.nss;uuidComponents.nss=undefined;if(!options.tolerant&&(!uuidComponents.uuid||!uuidComponents.uuid.match(UUID))){uuidComponents.error=uuidComponents.error||"UUID is not valid."}return uuidComponents},serialize:function serialize(uuidComponents,options){var urnComponents=uuidComponents;urnComponents.nss=(uuidComponents.uuid||"").toLowerCase();return urnComponents}};SCHEMES[handler.scheme]=handler;SCHEMES[handler$1.scheme]=handler$1;SCHEMES[handler$2.scheme]=handler$2;SCHEMES[handler$3.scheme]=handler$3;SCHEMES[handler$4.scheme]=handler$4;exports.SCHEMES=SCHEMES;exports.pctEncChar=pctEncChar;exports.pctDecChars=pctDecChars;exports.parse=parse;exports.removeDotSegments=removeDotSegments;exports.serialize=serialize;exports.resolveComponents=resolveComponents;exports.resolve=resolve;exports.normalize=normalize;exports.equal=equal;exports.escapeComponent=escapeComponent;exports.unescapeComponent=unescapeComponent;Object.defineProperty(exports,"__esModule",{value:true})}))},{}],93:[function(require,module,exports){"use strict";module.exports=function(Yallist){Yallist.prototype[Symbol.iterator]=function*(){for(let walker=this.head;walker;walker=walker.next){yield walker.value}}}},{}],94:[function(require,module,exports){"use strict";module.exports=Yallist;Yallist.Node=Node;Yallist.create=Yallist;function Yallist(list){var self=this;if(!(self instanceof Yallist)){self=new Yallist}self.tail=null;self.head=null;self.length=0;if(list&&typeof list.forEach==="function"){list.forEach((function(item){self.push(item)}))}else if(arguments.length>0){for(var i=0,l=arguments.length;i<l;i++){self.push(arguments[i])}}return self}Yallist.prototype.removeNode=function(node){if(node.list!==this){throw new Error("removing node which does not belong to this list")}var next=node.next;var prev=node.prev;if(next){next.prev=prev}if(prev){prev.next=next}if(node===this.head){this.head=next}if(node===this.tail){this.tail=prev}node.list.length--;node.next=null;node.prev=null;node.list=null;return next};Yallist.prototype.unshiftNode=function(node){if(node===this.head){return}if(node.list){node.list.removeNode(node)}var head=this.head;node.list=this;node.next=head;if(head){head.prev=node}this.head=node;if(!this.tail){this.tail=node}this.length++};Yallist.prototype.pushNode=function(node){if(node===this.tail){return}if(node.list){node.list.removeNode(node)}var tail=this.tail;node.list=this;node.prev=tail;if(tail){tail.next=node}this.tail=node;if(!this.head){this.head=node}this.length++};Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++){push(this,arguments[i])}return this.length};Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++){unshift(this,arguments[i])}return this.length};Yallist.prototype.pop=function(){if(!this.tail){return undefined}var res=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return res};Yallist.prototype.shift=function(){if(!this.head){return undefined}var res=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return res};Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;walker!==null;i++){fn.call(thisp,walker.value,i,this);walker=walker.next}};Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;walker!==null;i--){fn.call(thisp,walker.value,i,this);walker=walker.prev}};Yallist.prototype.get=function(n){for(var i=0,walker=this.head;walker!==null&&i<n;i++){walker=walker.next}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;walker!==null&&i<n;i++){walker=walker.prev}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.head;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.next}return res};Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.tail;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.prev}return res};Yallist.prototype.reduce=function(fn,initial){var acc;var walker=this.head;if(arguments.length>1){acc=initial}else if(this.head){walker=this.head.next;acc=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=0;walker!==null;i++){acc=fn(acc,walker.value,i);walker=walker.next}return acc};Yallist.prototype.reduceReverse=function(fn,initial){var acc;var walker=this.tail;if(arguments.length>1){acc=initial}else if(this.tail){walker=this.tail.prev;acc=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=this.length-1;walker!==null;i--){acc=fn(acc,walker.value,i);walker=walker.prev}return acc};Yallist.prototype.toArray=function(){var arr=new Array(this.length);for(var i=0,walker=this.head;walker!==null;i++){arr[i]=walker.value;walker=walker.next}return arr};Yallist.prototype.toArrayReverse=function(){var arr=new Array(this.length);for(var i=0,walker=this.tail;walker!==null;i++){arr[i]=walker.value;walker=walker.prev}return arr};Yallist.prototype.slice=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=0,walker=this.head;walker!==null&&i<from;i++){walker=walker.next}for(;walker!==null&&i<to;i++,walker=walker.next){ret.push(walker.value)}return ret};Yallist.prototype.sliceReverse=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=this.length,walker=this.tail;walker!==null&&i>to;i--){walker=walker.prev}for(;walker!==null&&i>from;i--,walker=walker.prev){ret.push(walker.value)}return ret};Yallist.prototype.splice=function(start,deleteCount){if(start>this.length){start=this.length-1}if(start<0){start=this.length+start}for(var i=0,walker=this.head;walker!==null&&i<start;i++){walker=walker.next}var ret=[];for(var i=0;walker&&i<deleteCount;i++){ret.push(walker.value);walker=this.removeNode(walker)}if(walker===null){walker=this.tail}if(walker!==this.head&&walker!==this.tail){walker=walker.prev}for(var i=2;i<arguments.length;i++){walker=insert(this,walker,arguments[i])}return ret};Yallist.prototype.reverse=function(){var head=this.head;var tail=this.tail;for(var walker=head;walker!==null;walker=walker.prev){var p=walker.prev;walker.prev=walker.next;walker.next=p}this.head=tail;this.tail=head;return this};function insert(self,node,value){var inserted=node===self.head?new Node(value,null,node,self):new Node(value,node,node.next,self);if(inserted.next===null){self.tail=inserted}if(inserted.prev===null){self.head=inserted}self.length++;return inserted}function push(self,item){self.tail=new Node(item,self.tail,null,self);if(!self.head){self.head=self.tail}self.length++}function unshift(self,item){self.head=new Node(item,null,self.head,self);if(!self.tail){self.tail=self.head}self.length++}function Node(value,prev,next,list){if(!(this instanceof Node)){return new Node(value,prev,next,list)}this.list=list;this.value=value;if(prev){prev.next=this;this.prev=prev}else{this.prev=null}if(next){next.prev=this;this.next=next}else{this.next=null}}try{require("./iterator.js")(Yallist)}catch(er){}},{"./iterator.js":93}]},{},[1])(1)}));